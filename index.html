<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
<head>
<!-- 2023-09-08 Fri 14:08 -->
<meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Emacs config</title>
<meta name="generator" content="Org mode" />
<meta name="author" content="Erick Navarro" />
<link rel="stylesheet" type="text/css" href="https://fniessen.github.io/org-html-themes/src/readtheorg_theme/css/htmlize.css"/>
<link rel="stylesheet" type="text/css" href="https://fniessen.github.io/org-html-themes/src/readtheorg_theme/css/readtheorg.css"/>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.4/js/bootstrap.min.js"></script>
<script type="text/javascript" src="https://fniessen.github.io/org-html-themes/src/lib/js/jquery.stickytableheaders.min.js"></script>
<script type="text/javascript" src="https://fniessen.github.io/org-html-themes/src/readtheorg_theme/js/readtheorg.js"></script>
<script type="text/javascript">
/*
@licstart  The following is the entire license notice for the
JavaScript code in this tag.

Copyright (C) 2012-2020 Free Software Foundation, Inc.

The JavaScript code in this tag is free software: you can
redistribute it and/or modify it under the terms of the GNU
General Public License (GNU GPL) as published by the Free Software
Foundation, either version 3 of the License, or (at your option)
any later version.  The code is distributed WITHOUT ANY WARRANTY;
without even the implied warranty of MERCHANTABILITY or FITNESS
FOR A PARTICULAR PURPOSE.  See the GNU GPL for more details.

As additional permission under GNU GPL version 3 section 7, you
may distribute non-source (e.g., minimized or compacted) forms of
that code without the copy of the GNU GPL normally required by
section 4, provided you include this license notice and a URL
through which recipients can access the Corresponding Source.


@licend  The above is the entire license notice
for the JavaScript code in this tag.
*/
<!--/*--><![CDATA[/*><!--*/
 function CodeHighlightOn(elem, id)
 {
   var target = document.getElementById(id);
   if(null != target) {
     elem.cacheClassElem = elem.className;
     elem.cacheClassTarget = target.className;
     target.className = "code-highlighted";
     elem.className   = "code-highlighted";
   }
 }
 function CodeHighlightOff(elem, id)
 {
   var target = document.getElementById(id);
   if(elem.cacheClassElem)
     elem.className = elem.cacheClassElem;
   if(elem.cacheClassTarget)
     target.className = elem.cacheClassTarget;
 }
/*]]>*///-->
</script>
</head>
<body>
<div id="content">
<h1 class="title">Emacs config</h1>
<div id="table-of-contents">
<h2>Table of Contents</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="#orge8dd676">1. Vanilla Emacs setup</a>
<ul>
<li><a href="#org93046d5">1.1. Ansi term</a></li>
<li><a href="#org7bf7cce">1.2. xref</a></li>
<li><a href="#org8852493">1.3. Compilation</a></li>
<li><a href="#org7a0568e">1.4. Narrowing</a></li>
</ul>
</li>
<li><a href="#org6a949b4">2. Theme and styles</a>
<ul>
<li><a href="#org9fe246f">2.1. Dracula</a></li>
<li><a href="#orgaae29e4">2.2. Doom modeline</a></li>
<li><a href="#org5bae2e7">2.3. Emoji support</a></li>
</ul>
</li>
<li><a href="#org668fffd">3. Dired</a>
<ul>
<li><a href="#org73b5bb6">3.1. Nerd icons dired</a></li>
<li><a href="#org9419170">3.2. Dired subtree</a></li>
</ul>
</li>
<li><a href="#org7379319">4. Editor enhancements</a>
<ul>
<li><a href="#org10ee668">4.1. Whitespace</a></li>
<li><a href="#org298cc00">4.2. Deactivate extended region in visual mode</a></li>
<li><a href="#orgfe9bdeb">4.3. Dark and transparent title bar in macOS</a></li>
<li><a href="#org252935f">4.4. Share clipoard with OS</a></li>
<li><a href="#org2d53038">4.5. Highlight TODO, FIXME, etc</a></li>
<li><a href="#org2972349">4.6. Auto fill mode</a></li>
<li><a href="#orga34468d">4.7. Load PATH environment</a></li>
<li><a href="#orge454ac7">4.8. Editorconfig</a></li>
<li><a href="#org5ad71e4">4.9. Snippets</a></li>
<li><a href="#org043894d">4.10. Wakatime</a></li>
<li><a href="#orgd2e9b52">4.11. Highlight thing</a></li>
<li><a href="#orgf0b3bb1">4.12. Various changes</a></li>
<li><a href="#org22bb16e">4.13. Reformatter</a></li>
<li><a href="#org8c115e3">4.14. Vterm</a></li>
<li><a href="#orge912649">4.15. Toggle terminal</a></li>
<li><a href="#org27e4fb5">4.16. iSpell</a></li>
<li><a href="#orgd4a2a33">4.17. Tree sitter</a></li>
</ul>
</li>
<li><a href="#orgd47be7d">5. Evil</a></li>
<li><a href="#orgf5c1d3e">6. Utils</a>
<ul>
<li><a href="#org865e734">6.1. Which-key</a></li>
<li><a href="#org3029a09">6.2. Autopair</a></li>
<li><a href="#org06deefb">6.3. Restclient</a></li>
<li><a href="#org07fe934">6.4. Rainbow delimiters</a></li>
<li><a href="#org6514db3">6.5. XML formatter</a></li>
<li><a href="#orgef03db3">6.6. SQL formatter</a></li>
<li><a href="#org5b223e9">6.7. SQL linter using sqlfluff</a></li>
</ul>
</li>
<li><a href="#org1971424">7. Common packages</a>
<ul>
<li><a href="#org3e6ba60">7.1. Company</a></li>
<li><a href="#orge26eeea">7.2. Flymake</a></li>
<li><a href="#org85eec4f">7.3. Direnv</a></li>
<li><a href="#org10c6408">7.4. Cloak mode</a></li>
<li><a href="#org20987c5">7.5. perspective.el</a></li>
<li><a href="#org27e83ae">7.6. Project.el</a></li>
<li><a href="#org3c28fed">7.7. Completion</a></li>
</ul>
</li>
<li><a href="#orgbdc2744">8. Emacs process list</a></li>
<li><a href="#org53138cd">9. Git backup</a></li>
<li><a href="#orgec226ae">10. Meme</a></li>
<li><a href="#org1715b42">11. Orgmode</a>
<ul>
<li><a href="#org6fa9a55">11.1. Org tree slide</a></li>
</ul>
</li>
<li><a href="#org7aa026b">12. Denote</a></li>
<li><a href="#org2832c2e">13. Latex</a></li>
<li><a href="#org67a2daf">14. Git</a>
<ul>
<li><a href="#org3cc112f">14.1. Git-link</a></li>
<li><a href="#org3eb797f">14.2. Git modes</a></li>
<li><a href="#orgd87d481">14.3. Magit</a></li>
<li><a href="#org1162cab">14.4. Magit delta</a></li>
<li><a href="#org055ae55">14.5. Forge</a></li>
<li><a href="#orgc227aa2">14.6. Git diff-hl</a></li>
<li><a href="#org65bbfe7">14.7. Timemachine</a></li>
<li><a href="#org1457775">14.8. Gist</a></li>
<li><a href="#orge0ed361">14.9. Linkode</a></li>
</ul>
</li>
<li><a href="#org3126dfc">15. Web</a>
<ul>
<li><a href="#org62f9757">15.1. Web mode</a></li>
<li><a href="#orgc420b69">15.2. Emmet</a></li>
<li><a href="#orge9b6d44">15.3. Sass</a></li>
<li><a href="#org3d56d08">15.4. Rainbow</a></li>
</ul>
</li>
<li><a href="#orgeaedb98">16. Miscellaneous</a></li>
<li><a href="#org1b33aac">17. LSP</a></li>
<li><a href="#orge3745d2">18. Programming languages</a>
<ul>
<li><a href="#org2616aa7">18.1. Shell scripts</a></li>
<li><a href="#orge28f803">18.2. C</a></li>
<li><a href="#org5ce5afd">18.3. Python</a></li>
<li><a href="#org7948bf6">18.4. Erlang</a></li>
<li><a href="#orgcfcc651">18.5. Elixir</a></li>
<li><a href="#orge472057">18.6. LFE</a></li>
<li><a href="#org4b1f7c3">18.7. Elm</a></li>
<li><a href="#orgf96592b">18.8. Haskell</a></li>
<li><a href="#org76d1bc4">18.9. Lua</a></li>
<li><a href="#org53f2dd3">18.10. Javascript</a>
<ul>
<li><a href="#orgcc28dfe">18.10.1. Formattter</a></li>
</ul>
</li>
<li><a href="#orgc1fd95c">18.11. Typescript</a></li>
<li><a href="#org68a34fa">18.12. Rust</a></li>
<li><a href="#org04172a0">18.13. Golang</a></li>
<li><a href="#orgcf71688">18.14. Common lisp</a></li>
<li><a href="#org724963d">18.15. Clojure</a></li>
<li><a href="#org867da39">18.16. Emacs lisp</a></li>
<li><a href="#org0a34a6e">18.17. OCaml</a></li>
<li><a href="#org287ea62">18.18. Dart</a>
<ul>
<li><a href="#org32adc6a">18.18.1. Flutter</a></li>
</ul>
</li>
<li><a href="#org7eddb6a">18.19. F-sharp</a></li>
</ul>
</li>
<li><a href="#org7fefa9f">19. Writing</a>
<ul>
<li><a href="#org3377975">19.1. Hugo</a></li>
</ul>
</li>
<li><a href="#orgb1d8a4d">20. Custom functions</a>
<ul>
<li><a href="#org934c0d4">20.1. MacOS</a></li>
</ul>
</li>
</ul>
</div>
</div>

<div id="outline-container-orge8dd676" class="outline-2">
<h2 id="orge8dd676"><span class="section-number-2">1</span> Vanilla Emacs setup</h2>
<div class="outline-text-2" id="text-1">
<div class="org-src-container">
<pre class="src src-emacs-lisp">
(<span class="org-keyword">setq</span> inhibit-startup-message t)
(<span class="org-keyword">setq</span> default-directory (expand-file-name <span class="org-string">"~/"</span>))

<span class="org-comment-delimiter">;; </span><span class="org-comment">Default font-family, this will used in all the function that manipulates font settings</span>
(<span class="org-keyword">defvar</span> <span class="org-variable-name">my/font-family</span> <span class="org-string">"Iosevka"</span>)

<span class="org-comment-delimiter">;; </span><span class="org-comment">Change backups directory to emacs folder</span>
<span class="org-comment-delimiter">;; </span><span class="org-comment">this avoid to save backup files in the same directory of the original files</span>
(<span class="org-keyword">setq</span> backup-directory-alist `((<span class="org-string">"."</span> . ,(concat user-emacs-directory
                                               <span class="org-string">"backups"</span>))))

<span class="org-comment-delimiter">;; </span><span class="org-comment">Revert dired and other buffers when there are changes on disk</span>
(<span class="org-keyword">setq</span> global-auto-revert-non-file-buffers t)

<span class="org-comment-delimiter">;; </span><span class="org-comment">Hide the bell in the center of screen</span>
(<span class="org-keyword">setq</span> ring-bell-function 'ignore)
(column-number-mode t)
(global-hl-line-mode 1)

(<span class="org-keyword">when</span> (member my/font-family (font-family-list))
  (set-frame-font (format <span class="org-string">"%s 13"</span> my/font-family)))

(global-set-key (kbd <span class="org-string">"C-x -"</span>) 'my/decrease-font-height)
(global-set-key (kbd <span class="org-string">"C-x ="</span>) 'my/increase-font-height)
(global-set-key (kbd <span class="org-string">"C-x +"</span>) 'my/increase-font-height)

<span class="org-comment-delimiter">;; </span><span class="org-comment">Navigate through buffers</span>
(global-set-key (kbd <span class="org-string">"M-["</span>) 'previous-buffer)
(global-set-key (kbd <span class="org-string">"M-]"</span>) 'next-buffer)

<span class="org-comment-delimiter">;; </span><span class="org-comment">Fix unicode errors</span>
(setenv <span class="org-string">"LANG"</span> <span class="org-string">"en_US.UTF-8"</span>)
(setenv <span class="org-string">"LC_ALL"</span> <span class="org-string">"en_US.UTF-8"</span>)
(setenv <span class="org-string">"LC_CTYPE"</span> <span class="org-string">"en_US.UTF-8"</span>)

<span class="org-comment-delimiter">;; </span><span class="org-comment">Fix size of scroll</span>
(<span class="org-keyword">setq</span> scroll-step 1
      scroll-conservatively  10000)

<span class="org-comment-delimiter">;; </span><span class="org-comment">Show a marker when the line has empty characters at the end</span>
(<span class="org-keyword">setq-default</span> show-trailing-whitespace t)

<span class="org-comment-delimiter">;; </span><span class="org-comment">disable `</span><span class="org-comment"><span class="org-constant">show-trailing-whitespace</span></span><span class="org-comment">' for modes based in comint-mode</span>
<span class="org-comment-delimiter">;; </span><span class="org-comment">make prompt readonly</span>
(add-hook 'comint-mode-hook #'(lambda ()
                                (<span class="org-keyword">setq-local</span> show-trailing-whitespace nil)
                                (<span class="org-keyword">setq-local</span> comint-prompt-read-only t)))

<span class="org-comment-delimiter">;; </span><span class="org-comment">Avoid close emacs by mistake</span>
(global-unset-key (kbd <span class="org-string">"C-x C-c"</span>))

(<span class="org-keyword">defalias</span> '<span class="org-function-name">yes-or-no-p</span> 'y-or-n-p)
(<span class="org-keyword">defalias</span> '<span class="org-function-name">run-elisp</span> 'ielm)

<span class="org-comment-delimiter">;; </span><span class="org-comment">place custom code generated for emacs in a separate file</span>
(<span class="org-keyword">defconst</span> <span class="org-variable-name">custom-file</span> (expand-file-name <span class="org-string">".customize.el"</span> user-emacs-directory))
(load custom-file <span class="org-builtin">:noerror</span>)

</pre>
</div>

<p>
Show a message with emacs startup time
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span class="org-keyword">defun</span> <span class="org-function-name">my/display-startup-time</span> ()
  (message <span class="org-string">"&#128640; Emacs loaded in %s with %d garbage collections."</span>
           (float-time (time-subtract after-init-time before-init-time))
           gcs-done))

(add-hook 'emacs-startup-hook #'my/display-startup-time)
</pre>
</div>

<p>
Setup fira code symbols mode.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">
(<span class="org-keyword">when</span> (member <span class="org-string">"Fira Code"</span> (font-family-list))
  (load-file (expand-file-name <span class="org-string">"~/.emacs.d/fira-code-mode.el"</span>))
  (<span class="org-keyword">require</span> '<span class="org-constant">fira-code-mode</span>)
  (add-hook 'prog-mode-hook 'fira-code-mode))

</pre>
</div>

<p>
Adjust font size to screen resolution, increase font size for 4K screens
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">
(<span class="org-keyword">when</span> (<span class="org-keyword">and</span> (display-graphic-p) (&gt;= (x-display-pixel-width) 3840))
  (set-frame-font (format <span class="org-string">"%s 16"</span> my/font-family)))

</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span class="org-keyword">define-minor-mode</span> <span class="org-function-name">big-font-mode</span>
  <span class="org-doc">"Switch between a regular font size and a presentation font size."</span>
  <span class="org-builtin">:init-value</span> nil
  <span class="org-builtin">:global</span> t
  (<span class="org-keyword">if</span> big-font-mode
      (<span class="org-keyword">progn</span>
        <span class="org-comment-delimiter">;; </span><span class="org-comment">save current font size in a temp variable to be able to restore it</span>
        <span class="org-comment-delimiter">;; </span><span class="org-comment">after this minor mode is disabled</span>
        (<span class="org-keyword">setq</span> big-font-mode--tmp (/ (face-attribute 'default <span class="org-builtin">:height</span>) 10))
        (set-frame-font (format <span class="org-string">"%s %d"</span> my/font-family 26)))
    (set-frame-font (format <span class="org-string">"%s %d"</span> my/font-family big-font-mode--tmp))))
</pre>
</div>

<p>
Parrot mode FTW!
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">
(<span class="org-keyword">defun</span> <span class="org-function-name">my/parrot-animate-when-compile-success</span> (buffer result)
  (<span class="org-keyword">if</span> (string-match <span class="org-string">"^finished"</span> result)
      (parrot-start-animation)))

(use-package parrot
  <span class="org-builtin">:ensure</span> t
  <span class="org-builtin">:config</span>
  (parrot-mode)
  (add-hook 'before-save-hook 'parrot-start-animation)
  (add-to-list 'compilation-finish-functions 'my/parrot-animate-when-compile-success))

</pre>
</div>

<p>
Open scratch buffer
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">
(<span class="org-keyword">defun</span> <span class="org-function-name">my/scratch-buffer</span>()
  <span class="org-doc">"Switch to scratch buffer."</span>
  (<span class="org-keyword">interactive</span>)
  (<span class="org-keyword">let</span> ((buffer (get-buffer <span class="org-string">"*scratch*"</span>)))
    (<span class="org-keyword">if</span> buffer
        (switch-to-buffer buffer)
      (switch-to-buffer (get-buffer-create <span class="org-string">"*scratch*"</span>))
      (insert (substitute-command-keys initial-scratch-message)))
    (lisp-interaction-mode)))

</pre>
</div>
</div>

<div id="outline-container-org93046d5" class="outline-3">
<h3 id="org93046d5"><span class="section-number-3">1.1</span> Ansi term</h3>
<div class="outline-text-3" id="text-1-1">
<p>
For some reason ansi-term doesn't respect the global keybinding for <code>M-]</code> so this have to be setup in <code>term-raw-map</code> as well.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">
(<span class="org-keyword">with-eval-after-load</span> 'term
  (define-key term-raw-map (kbd <span class="org-string">"M-]"</span>) 'next-buffer))

</pre>
</div>
</div>
</div>

<div id="outline-container-org7bf7cce" class="outline-3">
<h3 id="org7bf7cce"><span class="section-number-3">1.2</span> xref</h3>
<div class="outline-text-3" id="text-1-2">
<p>
Enable evil emacs state when entering a xref buffer
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span class="org-keyword">with-eval-after-load</span> 'xref
  (add-hook 'xref-after-update-hook #'(lambda () (evil-emacs-state))))
</pre>
</div>
</div>
</div>

<div id="outline-container-org8852493" class="outline-3">
<h3 id="org8852493"><span class="section-number-3">1.3</span> Compilation</h3>
<div class="outline-text-3" id="text-1-3">
<p>
Disable <code>h</code> key-binding, this has a conflict with evil-mode left navigation key-binding.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">
(<span class="org-keyword">with-eval-after-load</span> 'compile
  <span class="org-comment-delimiter">;; </span><span class="org-comment">set cursor to follow compilation output</span>
  (<span class="org-keyword">setq</span> compilation-scroll-output t)
  <span class="org-comment-delimiter">;; </span><span class="org-comment">for elixir testing output test filename use black color which makes it ineligible</span>
  (set-face-foreground 'ansi-color-bold <span class="org-string">"magenta"</span>)
  (define-key compilation-mode-map (kbd <span class="org-string">"g"</span>) nil)
  (define-key compilation-mode-map (kbd <span class="org-string">"r"</span>) 'recompile)
  (define-key compilation-mode-map (kbd <span class="org-string">"h"</span>) nil))

</pre>
</div>

<p>
Allow to show color characters in the compilation buffer.
</p>

<p>
copied from <a href="https://stackoverflow.com/questions/3072648/cucumbers-ansi-colors-messing-up-emacs-compilation-buffer/3072831#3072831">https://stackoverflow.com/questions/3072648/cucumbers-ansi-colors-messing-up-emacs-compilation-buffer/3072831#3072831</a>
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">
(<span class="org-keyword">require</span> '<span class="org-constant">ansi-color</span>)

(<span class="org-keyword">defun</span> <span class="org-function-name">colorize-compilation-buffer</span> ()
  (<span class="org-keyword">let</span> ((inhibit-read-only t))
    (ansi-color-apply-on-region (point-min) (point-max))))

(add-hook 'compilation-filter-hook 'colorize-compilation-buffer)

</pre>
</div>

<p>
Custom function to select a base directory before running compilation. <code>M-x compile</code> always use the base directory of the buffer from where it was called as <code>default-directory</code>, this is awful when you want to run a project compilation command from a nested file buffer.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span class="org-keyword">defun</span> <span class="org-function-name">my/compile</span> ()
  <span class="org-doc">"Run compilation process but ask for a `</span><span class="org-doc"><span class="org-constant">default-directory</span></span><span class="org-doc">' before."</span>
  (<span class="org-keyword">interactive</span>)
  (<span class="org-keyword">let</span> ((default-directory (read-directory-name <span class="org-string">"Base directory: "</span> (my/project-root)))
        (cmd (read-string <span class="org-string">"Compile command: "</span>)))
    <span class="org-comment-delimiter">;; </span><span class="org-comment">we need to "export" this variable to be able to re-run `</span><span class="org-comment"><span class="org-constant">compile</span></span><span class="org-comment">' command</span>
    (<span class="org-keyword">setq</span> compile-command cmd)
    (compile compile-command)))
</pre>
</div>
</div>
</div>

<div id="outline-container-org7a0568e" class="outline-3">
<h3 id="org7a0568e"><span class="section-number-3">1.4</span> Narrowing</h3>
<div class="outline-text-3" id="text-1-4">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span class="org-keyword">defun</span> <span class="org-function-name">my/toggle-narrowing</span> ()
  <span class="org-doc">"Toggle narrow on the selected region."</span>
  (<span class="org-keyword">interactive</span>)
  (<span class="org-keyword">if</span> (buffer-narrowed-p)
      (widen)
    (<span class="org-keyword">if</span> (region-active-p)
        (narrow-to-region (region-beginning) (region-end))
      (<span class="org-warning">user-error</span> <span class="org-string">"No active selection"</span>))))
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org6a949b4" class="outline-2">
<h2 id="org6a949b4"><span class="section-number-2">2</span> Theme and styles</h2>
<div class="outline-text-2" id="text-2">
</div>
<div id="outline-container-org9fe246f" class="outline-3">
<h3 id="org9fe246f"><span class="section-number-3">2.1</span> Dracula</h3>
<div class="outline-text-3" id="text-2-1">
<div class="org-src-container">
<pre class="src src-emacs-lisp">
(use-package dracula-theme
  <span class="org-builtin">:ensure</span> t
  <span class="org-builtin">:config</span>
  (load-theme 'dracula t)
  (set-face-foreground 'font-lock-variable-name-face <span class="org-string">"gray"</span>))

</pre>
</div>
</div>
</div>

<div id="outline-container-orgaae29e4" class="outline-3">
<h3 id="orgaae29e4"><span class="section-number-3">2.2</span> Doom modeline</h3>
<div class="outline-text-3" id="text-2-2">
<p>
Enable <code>display-battery-mode</code> after <code>doom-modeline</code> is loaded.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">
(use-package doom-modeline
  <span class="org-builtin">:ensure</span> t
  <span class="org-builtin">:defer</span> t
  <span class="org-builtin">:custom</span>
  (doom-modeline-modal-icon nil)
  (doom-modeline-buffer-file-name-style 'relative-from-project)
  <span class="org-builtin">:hook</span>
  (after-init . doom-modeline-mode)
  (doom-modeline-mode . display-battery-mode))

</pre>
</div>
</div>
</div>

<div id="outline-container-org5bae2e7" class="outline-3">
<h3 id="org5bae2e7"><span class="section-number-3">2.3</span> Emoji support</h3>
<div class="outline-text-3" id="text-2-3">
<div class="org-src-container">
<pre class="src src-emacs-lisp">
(use-package unicode-fonts
  <span class="org-builtin">:ensure</span> t
  <span class="org-builtin">:config</span>
  (unicode-fonts-setup))

</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org668fffd" class="outline-2">
<h2 id="org668fffd"><span class="section-number-2">3</span> Dired</h2>
<div class="outline-text-2" id="text-3">
<div class="org-src-container">
<pre class="src src-emacs-lisp">
(<span class="org-keyword">with-eval-after-load</span> <span class="org-string">"dired"</span>
  (define-key dired-mode-map (kbd <span class="org-string">"C-c C-e"</span>) 'wdired-change-to-wdired-mode))

</pre>
</div>
</div>

<div id="outline-container-org73b5bb6" class="outline-3">
<h3 id="org73b5bb6"><span class="section-number-3">3.1</span> Nerd icons dired</h3>
<div class="outline-text-3" id="text-3-1">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package nerd-icons-dired
  <span class="org-builtin">:ensure</span> t
  <span class="org-builtin">:defer</span> t
  <span class="org-builtin">:hook</span>
  (dired-mode . nerd-icons-dired-mode))
</pre>
</div>
</div>
</div>

<div id="outline-container-org9419170" class="outline-3">
<h3 id="org9419170"><span class="section-number-3">3.2</span> Dired subtree</h3>
<div class="outline-text-3" id="text-3-2">
<div class="org-src-container">
<pre class="src src-emacs-lisp">
(use-package dired-subtree
  <span class="org-builtin">:ensure</span> t
  <span class="org-builtin">:after</span> dired
  <span class="org-builtin">:config</span>
  (define-key dired-mode-map (kbd <span class="org-string">"&lt;tab&gt;"</span>) 'dired-subtree-toggle))

</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org7379319" class="outline-2">
<h2 id="org7379319"><span class="section-number-2">4</span> Editor enhancements</h2>
<div class="outline-text-2" id="text-4">
</div>
<div id="outline-container-org10ee668" class="outline-3">
<h3 id="org10ee668"><span class="section-number-3">4.1</span> Whitespace</h3>
<div class="outline-text-3" id="text-4-1">
<p>
Show special markers for tab and endline characters in <code>prog-mode</code>
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package whitespace-mode
  <span class="org-builtin">:custom</span>
  (whitespace-style '(tab-mark newline-mark))
  (whitespace-display-mappings '((newline-mark ?\n    [?&#172; ?\n]  [?$ ?\n])
                                 (tab-mark     ?\t    [?&#187; ?\t] [?\\ ?\t])))
  <span class="org-builtin">:hook</span>
  (prog-mode . whitespace-mode))
</pre>
</div>
</div>
</div>

<div id="outline-container-org298cc00" class="outline-3">
<h3 id="org298cc00"><span class="section-number-3">4.2</span> Deactivate extended region in visual mode</h3>
<div class="outline-text-3" id="text-4-2">
<p>
Allow to visual mode work more like vim visual highlighting.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(set-face-attribute 'region nil <span class="org-builtin">:extend</span> nil)
</pre>
</div>
</div>
</div>

<div id="outline-container-orgfe9bdeb" class="outline-3">
<h3 id="orgfe9bdeb"><span class="section-number-3">4.3</span> Dark and transparent title bar in macOS</h3>
<div class="outline-text-3" id="text-4-3">
<div class="org-src-container">
<pre class="src src-emacs-lisp">
(<span class="org-keyword">when</span> (memq window-system '(mac ns))
  (add-to-list 'default-frame-alist '(ns-transparent-titlebar . t))
  (add-to-list 'default-frame-alist '(ns-appearance . dark)))

</pre>
</div>
</div>
</div>

<div id="outline-container-org252935f" class="outline-3">
<h3 id="org252935f"><span class="section-number-3">4.4</span> Share clipoard with OS</h3>
<div class="outline-text-3" id="text-4-4">
<div class="org-src-container">
<pre class="src src-emacs-lisp">
(use-package pbcopy
  <span class="org-builtin">:ensure</span> t)

</pre>
</div>
</div>
</div>

<div id="outline-container-org2d53038" class="outline-3">
<h3 id="org2d53038"><span class="section-number-3">4.5</span> Highlight TODO, FIXME, etc</h3>
<div class="outline-text-3" id="text-4-5">
<div class="org-src-container">
<pre class="src src-emacs-lisp">
(<span class="org-keyword">defun</span> <span class="org-function-name">my/highlight-todo-like-words</span> ()
  (font-lock-add-keywords
   nil `((<span class="org-string">"\\&lt;</span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">(</span></span><span class="org-string">FIXME</span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">|</span></span><span class="org-string">TODO</span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">)</span></span><span class="org-string">"</span>
          1 font-lock-warning-face t))))

(add-hook 'prog-mode-hook 'my/highlight-todo-like-words)

</pre>
</div>
</div>
</div>

<div id="outline-container-org2972349" class="outline-3">
<h3 id="org2972349"><span class="section-number-3">4.6</span> Auto fill mode</h3>
<div class="outline-text-3" id="text-4-6">
<p>
Use <code>auto-fill-mode</code> only for comments and only with programming buffers
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span class="org-keyword">setq</span> comment-auto-fill-only-comments t)

(add-hook 'prog-mode-hook #'(lambda ()
                              (auto-fill-mode 1)))
</pre>
</div>
</div>
</div>

<div id="outline-container-orga34468d" class="outline-3">
<h3 id="orga34468d"><span class="section-number-3">4.7</span> Load PATH environment</h3>
<div class="outline-text-3" id="text-4-7">
<p>
<code>exec-path-from-shell</code> by default uses <code>("-l" "-i")</code> when starts a new shell to get the <code>PATH</code>, <code>-i</code> option was removed to open a non interactive shell so it can be faster at startup.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">
(use-package exec-path-from-shell
  <span class="org-builtin">:ensure</span> t
  <span class="org-builtin">:custom</span>
  (exec-path-from-shell-arguments '(<span class="org-string">"-l"</span>))
  (exec-path-from-shell-check-startup-files nil)
  <span class="org-builtin">:config</span>
  (<span class="org-keyword">when</span> (memq window-system '(mac ns))
    (exec-path-from-shell-initialize)))

</pre>
</div>
</div>
</div>

<div id="outline-container-orge454ac7" class="outline-3">
<h3 id="orge454ac7"><span class="section-number-3">4.8</span> Editorconfig</h3>
<div class="outline-text-3" id="text-4-8">
<div class="org-src-container">
<pre class="src src-emacs-lisp">
(use-package editorconfig
  <span class="org-builtin">:ensure</span> t
  <span class="org-builtin">:config</span>
  (editorconfig-mode 1))

</pre>
</div>
</div>
</div>

<div id="outline-container-org5ad71e4" class="outline-3">
<h3 id="org5ad71e4"><span class="section-number-3">4.9</span> Snippets</h3>
<div class="outline-text-3" id="text-4-9">
<div class="org-src-container">
<pre class="src src-emacs-lisp">
(use-package yasnippet
  <span class="org-builtin">:ensure</span> t
  <span class="org-builtin">:hook</span> ((prog-mode . yas-minor-mode)
         (conf-mode . yas-minor-mode)
         (text-mode . yas-minor-mode)
         (snippet-mode . yas-minor-mode)))

(use-package yasnippet-snippets
  <span class="org-builtin">:ensure</span> t
  <span class="org-builtin">:after</span> (yasnippet))

</pre>
</div>
</div>
</div>

<div id="outline-container-org043894d" class="outline-3">
<h3 id="org043894d"><span class="section-number-3">4.10</span> Wakatime</h3>
<div class="outline-text-3" id="text-4-10">
<div class="org-src-container">
<pre class="src src-emacs-lisp">
(use-package wakatime-mode
  <span class="org-builtin">:ensure</span> t
  <span class="org-builtin">:if</span> (executable-find <span class="org-string">"wakatime-cli"</span>)
  <span class="org-builtin">:init</span>
  (<span class="org-keyword">setq</span> wakatime-cli-path (executable-find <span class="org-string">"wakatime-cli"</span>))
  <span class="org-builtin">:config</span>
  (global-wakatime-mode))

</pre>
</div>
</div>
</div>

<div id="outline-container-orgd2e9b52" class="outline-3">
<h3 id="orgd2e9b52"><span class="section-number-3">4.11</span> Highlight thing</h3>
<div class="outline-text-3" id="text-4-11">
<div class="org-src-container">
<pre class="src src-emacs-lisp">
(use-package highlight-thing
  <span class="org-builtin">:ensure</span> t
  <span class="org-builtin">:hook</span>
  (prog-mode . highlight-thing-mode))

</pre>
</div>
</div>
</div>

<div id="outline-container-orgf0b3bb1" class="outline-3">
<h3 id="orgf0b3bb1"><span class="section-number-3">4.12</span> Various changes</h3>
<div class="outline-text-3" id="text-4-12">
<p>
Disable lock files
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">
(<span class="org-keyword">setq</span> create-lockfiles nil)

</pre>
</div>
</div>
</div>

<div id="outline-container-org22bb16e" class="outline-3">
<h3 id="org22bb16e"><span class="section-number-3">4.13</span> Reformatter</h3>
<div class="outline-text-3" id="text-4-13">
<div class="org-src-container">
<pre class="src src-emacs-lisp">
(use-package reformatter
  <span class="org-builtin">:ensure</span> t)

</pre>
</div>
</div>
</div>

<div id="outline-container-org8c115e3" class="outline-3">
<h3 id="org8c115e3"><span class="section-number-3">4.14</span> Vterm</h3>
<div class="outline-text-3" id="text-4-14">
<div class="org-src-container">
<pre class="src src-emacs-lisp">
(use-package vterm
  <span class="org-builtin">:ensure</span> t
  <span class="org-builtin">:defer</span> t
  <span class="org-builtin">:hook</span>
  (vterm-mode . (<span class="org-keyword">lambda</span> ()
                  (<span class="org-keyword">setq-local</span> show-trailing-whitespace nil)))
  <span class="org-builtin">:custom</span>
  (vterm-module-cmake-args <span class="org-string">"-DUSE_SYSTEM_LIBVTERM=yes"</span>)
  (vterm-always-compile-module t))

</pre>
</div>
</div>
</div>

<div id="outline-container-orge912649" class="outline-3">
<h3 id="orge912649"><span class="section-number-3">4.15</span> Toggle terminal</h3>
<div class="outline-text-3" id="text-4-15">
<p>
<code>'project</code> use always the same terminal per project, this way we avoid to create a new terminal for each call to <code>vterm-toggle</code>.
<code>'reset-window-configration</code> yes, it's suppose to be <code>configration</code>, for some reason it was defined like this instead of <code>configuration</code>
</p>

<p>
Also for easy access insert mode is activated right away after vterm is shown
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package vterm-toggle
  <span class="org-builtin">:ensure</span> t
  <span class="org-builtin">:custom</span>
  (vterm-toggle-scope 'project)
  (vterm-toggle-hide-method 'reset-window-configration)
  <span class="org-builtin">:hook</span>
  (vterm-toggle-show . evil-insert-state))
</pre>
</div>
</div>
</div>

<div id="outline-container-org27e4fb5" class="outline-3">
<h3 id="org27e4fb5"><span class="section-number-3">4.16</span> iSpell</h3>
<div class="outline-text-3" id="text-4-16">
<p>
Avoid check spelling in markdown code blocks
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">
(<span class="org-keyword">with-eval-after-load</span> 'ispell
  (<span class="org-keyword">setq</span> ispell-program-name <span class="org-string">"aspell"</span>)
  (add-to-list 'ispell-skip-region-alist
               '(<span class="org-string">"^```"</span> . <span class="org-string">"^```"</span>)))

</pre>
</div>

<p>
When editing a commit message <code>ispell</code> should ignore lines that start with <code>#</code>, these lines are diff details about the commit.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span class="org-keyword">defun</span> <span class="org-function-name">my/setup-ispell-for-commit-message</span> ()
  <span class="org-doc">"Setup `</span><span class="org-doc"><span class="org-constant">ispell-skip-region-alist</span></span><span class="org-doc">' to avoid lines starting with #.</span>
<span class="org-doc">  This way diff code will be ignored when ispell run."</span>
  (<span class="org-keyword">setq-local</span> ispell-skip-region-alist (cons '(<span class="org-string">"^#"</span> . <span class="org-string">"$"</span>) ispell-skip-region-alist)))
</pre>
</div>
</div>
</div>

<div id="outline-container-orgd4a2a33" class="outline-3">
<h3 id="orgd4a2a33"><span class="section-number-3">4.17</span> Tree sitter</h3>
<div class="outline-text-3" id="text-4-17">
<p>
Incremental code parsing for better syntax highlighting
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">
(use-package tree-sitter
  <span class="org-builtin">:ensure</span> t
  <span class="org-builtin">:hook</span>
  (tree-sitter-after-on . tree-sitter-hl-mode)
  <span class="org-builtin">:config</span>
  (global-tree-sitter-mode))

(use-package tree-sitter-langs
  <span class="org-builtin">:ensure</span> t)

</pre>
</div>

<p>
Run ispell in text nodes
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package tree-sitter-ispell
  <span class="org-builtin">:ensure</span> t
  <span class="org-builtin">:defer</span> t
  <span class="org-builtin">:bind</span> ((<span class="org-string">"C-x C-s"</span> . tree-sitter-ispell-run-at-point)))
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-orgd47be7d" class="outline-2">
<h2 id="orgd47be7d"><span class="section-number-2">5</span> Evil</h2>
<div class="outline-text-2" id="text-5">
<div class="org-src-container">
<pre class="src src-emacs-lisp">
(<span class="org-keyword">defun</span> <span class="org-function-name">my/find-file-under-cursor</span> ()
  <span class="org-doc">"Check it the filepath under cursor is an absolute path otherwise open `</span><span class="org-doc"><span class="org-constant">project-find-file</span></span><span class="org-doc">' and insert the filepath."</span>
  (<span class="org-keyword">interactive</span>)
  (<span class="org-keyword">let</span> ((file-path (thing-at-point 'filename t)))
    (<span class="org-keyword">if</span> (file-name-absolute-p file-path)
        (find-file-at-point file-path)
      (<span class="org-keyword">minibuffer-with-setup-hook</span> #'(lambda () (insert file-path))
        (project-find-file)))))

</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">
(use-package evil
  <span class="org-builtin">:ensure</span> t
  <span class="org-builtin">:init</span>
  (<span class="org-keyword">setq</span> evil-emacs-state-cursor '(<span class="org-string">"white"</span> box)
        evil-normal-state-cursor '(<span class="org-string">"green"</span> box)
        evil-visual-state-cursor '(<span class="org-string">"orange"</span> box)
        evil-insert-state-cursor '(<span class="org-string">"red"</span> bar)
        <span class="org-comment-delimiter">;; </span><span class="org-comment">use emacs-28 undo system</span>
        evil-undo-system 'undo-redo)
  <span class="org-builtin">:config</span>
  (evil-mode 1)
  (modify-syntax-entry ?_ <span class="org-string">"w"</span>)
  (define-key evil-normal-state-map (kbd <span class="org-string">"C-p"</span>) 'diff-hl-previous-hunk)
  (define-key evil-normal-state-map (kbd <span class="org-string">"C-n"</span>) 'diff-hl-next-hunk)
  (define-key evil-normal-state-map <span class="org-string">"gf"</span> 'my/find-file-under-cursor)
  (add-hook 'prog-mode-hook #'(lambda ()
                                (modify-syntax-entry ?_ <span class="org-string">"w"</span>)))

  (face-spec-set
   'evil-ex-substitute-matches
   '((t <span class="org-builtin">:foreground</span> <span class="org-string">"red"</span>
        <span class="org-builtin">:strike-through</span> t
        <span class="org-builtin">:weight</span> bold)))

  (face-spec-set
   'evil-ex-substitute-replacement
   '((t
      <span class="org-builtin">:foreground</span> <span class="org-string">"green"</span>
      <span class="org-builtin">:weight</span> bold))))

(use-package evil-nerd-commenter
  <span class="org-builtin">:ensure</span> t
  <span class="org-builtin">:after</span> (evil)
  <span class="org-builtin">:config</span>
  (evilnc-default-hotkeys)
  (global-set-key (kbd <span class="org-string">"C-</span><span class="org-string"><span class="org-warning">\</span></span><span class="org-string">-"</span>) 'evilnc-comment-operator)
  <span class="org-comment-delimiter">;; </span><span class="org-comment">avoid to auto-setup of keybindings</span>
  (<span class="org-keyword">setq</span> evilnc-use-comment-object-setup nil))

(use-package evil-surround
  <span class="org-builtin">:ensure</span> t
  <span class="org-builtin">:after</span> (evil)
  <span class="org-builtin">:config</span>
  (global-evil-surround-mode 1))

(<span class="org-keyword">defun</span> <span class="org-function-name">my/replace-at-point-or-region</span> ()
  <span class="org-doc">"Setup buffer replace string for word at point or active region using evil ex mode."</span>
  (<span class="org-keyword">interactive</span>)
  (<span class="org-keyword">let</span> ((text (<span class="org-keyword">if</span> (region-active-p)
                  (buffer-substring-no-properties (region-beginning) (region-end))
                (word-at-point))))
    (evil-ex (concat <span class="org-string">"%s/"</span> text <span class="org-string">"/"</span>))))

(use-package evil-leader
  <span class="org-builtin">:ensure</span> t
  <span class="org-builtin">:after</span> (evil)
  <span class="org-builtin">:config</span>
  (global-evil-leader-mode)
  (evil-leader/set-key
    <span class="org-string">"SPC"</span> '(lambda ()
             (<span class="org-keyword">interactive</span>)
             (call-interactively #'execute-extended-command))
    <span class="org-string">"a"</span> '(lambda ()
           (<span class="org-keyword">interactive</span>)
           (message <span class="org-string">"THING: %s"</span> (thing-at-point 'symbol))
           (my/grep-in-project (thing-at-point 'symbol)))
    <span class="org-string">"A"</span> 'my/grep-in-project
    <span class="org-string">"ba"</span> 'my/add-bookmark
    <span class="org-string">"bb"</span> 'my/bookmark-switch
    <span class="org-string">"B"</span> '(lambda ()
           (<span class="org-keyword">interactive</span>)
           (call-interactively #'switch-to-buffer))
    <span class="org-string">"c"</span> 'vterm-toggle
    <span class="org-string">"e"</span> 'my/find-file-in-project
    <span class="org-string">"f"</span> 'find-file
    <span class="org-string">"g"</span> 'magit-status
    <span class="org-string">"G"</span> 'magit-file-dispatch
    <span class="org-string">"i"</span> 'imenu
    <span class="org-string">"hs"</span> 'diff-hl-stage-current-hunk
    <span class="org-string">"hk"</span> 'diff-hl-revert-hunk
    <span class="org-string">"k"</span> 'kill-buffer
    <span class="org-string">"l"</span> 'display-line-numbers-mode
    <span class="org-string">"n"</span> 'evil-buffer-new
    <span class="org-string">"N"</span> 'my/toggle-narrowing
    <span class="org-string">"pa"</span> 'my/copy-abs-path
    <span class="org-string">"pr"</span> 'my/copy-relative-path
    <span class="org-string">"q"</span> 'consult-line
    <span class="org-string">"r"</span> 'my/replace-at-point-or-region
    <span class="org-string">"R"</span> 'recompile
    <span class="org-string">"s"</span> 'my/toggle-spanish-characters
    <span class="org-string">"t"</span> 'persp-switch
    <span class="org-string">"w"</span> 'my/toggle-maximize
    <span class="org-string">"x"</span> 'my/resize-window
    <span class="org-string">"y"</span> 'consult-yank-from-kill-ring))

(use-package evil-matchit
  <span class="org-builtin">:ensure</span> t
  <span class="org-builtin">:config</span> (global-evil-matchit-mode 1))

</pre>
</div>
</div>
</div>

<div id="outline-container-orgf5c1d3e" class="outline-2">
<h2 id="orgf5c1d3e"><span class="section-number-2">6</span> Utils</h2>
<div class="outline-text-2" id="text-6">
</div>
<div id="outline-container-org865e734" class="outline-3">
<h3 id="org865e734"><span class="section-number-3">6.1</span> Which-key</h3>
<div class="outline-text-3" id="text-6-1">
<div class="org-src-container">
<pre class="src src-emacs-lisp">
(use-package which-key
  <span class="org-builtin">:ensure</span> t
  <span class="org-builtin">:config</span>
  (which-key-mode)
  (which-key-setup-minibuffer))

</pre>
</div>
</div>
</div>

<div id="outline-container-org3029a09" class="outline-3">
<h3 id="org3029a09"><span class="section-number-3">6.2</span> Autopair</h3>
<div class="outline-text-3" id="text-6-2">
<div class="org-src-container">
<pre class="src src-emacs-lisp">
(use-package autopair
  <span class="org-builtin">:ensure</span> t
  <span class="org-builtin">:config</span>
  (autopair-global-mode))

</pre>
</div>
</div>
</div>

<div id="outline-container-org06deefb" class="outline-3">
<h3 id="org06deefb"><span class="section-number-3">6.3</span> Restclient</h3>
<div class="outline-text-3" id="text-6-3">
<div class="org-src-container">
<pre class="src src-emacs-lisp">
(use-package restclient
  <span class="org-builtin">:ensure</span> t
  <span class="org-builtin">:defer</span> t
  <span class="org-builtin">:mode</span> ((<span class="org-string">"\\.http\\'"</span> . restclient-mode))
  <span class="org-builtin">:bind</span> (<span class="org-builtin">:map</span> restclient-mode-map
              (<span class="org-string">"C-c C-h"</span> . 'cloak-mode)
              (<span class="org-string">"C-c C-f"</span> . 'json-pretty-print))) <span class="org-comment-delimiter">;</span><span class="org-comment">TODO: change to only apply json formatting when the content-type is application/json</span>

(use-package company-restclient
  <span class="org-builtin">:ensure</span> t
  <span class="org-builtin">:after</span> (restclient)
  <span class="org-builtin">:config</span>
  (add-to-list 'company-backends 'company-restclient))

</pre>
</div>
</div>
</div>

<div id="outline-container-org07fe934" class="outline-3">
<h3 id="org07fe934"><span class="section-number-3">6.4</span> Rainbow delimiters</h3>
<div class="outline-text-3" id="text-6-4">
<div class="org-src-container">
<pre class="src src-emacs-lisp">
(use-package rainbow-delimiters
  <span class="org-builtin">:ensure</span> t
  <span class="org-builtin">:hook</span>
  (prog-mode . rainbow-delimiters-mode))

</pre>
</div>
</div>
</div>

<div id="outline-container-org6514db3" class="outline-3">
<h3 id="org6514db3"><span class="section-number-3">6.5</span> XML formatter</h3>
<div class="outline-text-3" id="text-6-5">
<div class="org-src-container">
<pre class="src src-emacs-lisp">
(reformatter-define xml-format
  <span class="org-builtin">:program</span> <span class="org-string">"xmlformat"</span>
  <span class="org-builtin">:group</span> 'xml)

(<span class="org-keyword">with-eval-after-load</span> 'nxml-mode
  (define-key nxml-mode-map (kbd <span class="org-string">"C-c C-f"</span>) 'xml-format-buffer))

</pre>
</div>
</div>
</div>

<div id="outline-container-orgef03db3" class="outline-3">
<h3 id="orgef03db3"><span class="section-number-3">6.6</span> SQL formatter</h3>
<div class="outline-text-3" id="text-6-6">
<p>
Install <code>pgformatter</code> using homebrew <code>brew install pgformatter</code>
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">
(reformatter-define sql-format
  <span class="org-builtin">:program</span> <span class="org-string">"pg_format"</span>)

(<span class="org-keyword">defun</span> <span class="org-function-name">my/format-sql</span> ()
  <span class="org-doc">"Format active region otherwise format the entire buffer."</span>
  (<span class="org-keyword">interactive</span>)
  (<span class="org-keyword">if</span> (region-active-p)
      (sql-format-region (region-beginning) (region-end))
    (sql-format-buffer)))

(<span class="org-keyword">with-eval-after-load</span> 'sql
  (add-hook 'sql-mode-hook 'flymake-sqlfluff-load)
  (add-hook 'sql-mode-hook 'flymake-mode)
  (define-key sql-mode-map (kbd <span class="org-string">"C-c C-f"</span>) 'my/format-sql))

</pre>
</div>
</div>
</div>

<div id="outline-container-org5b223e9" class="outline-3">
<h3 id="org5b223e9"><span class="section-number-3">6.7</span> SQL linter using <a href="https://www.sqlfluff.com">sqlfluff</a></h3>
<div class="outline-text-3" id="text-6-7">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package flymake-sqlfluff
  <span class="org-builtin">:ensure</span> t)
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org1971424" class="outline-2">
<h2 id="org1971424"><span class="section-number-2">7</span> Common packages</h2>
<div class="outline-text-2" id="text-7">
<p>
Used in every major mode
</p>
</div>

<div id="outline-container-org3e6ba60" class="outline-3">
<h3 id="org3e6ba60"><span class="section-number-3">7.1</span> Company</h3>
<div class="outline-text-3" id="text-7-1">
<div class="org-src-container">
<pre class="src src-emacs-lisp">
(use-package company
  <span class="org-builtin">:ensure</span> t
  <span class="org-builtin">:init</span>
  (<span class="org-keyword">setq</span> company-idle-delay 0.1
        company-tooltip-limit 10
        company-minimum-prefix-length 3)
  <span class="org-builtin">:hook</span> (after-init . global-company-mode)
  <span class="org-builtin">:config</span>
  (define-key company-active-map (kbd <span class="org-string">"C-n"</span>) 'company-select-next)
  (define-key company-active-map (kbd <span class="org-string">"C-p"</span>) 'company-select-previous))

</pre>
</div>
</div>
</div>

<div id="outline-container-orge26eeea" class="outline-3">
<h3 id="orge26eeea"><span class="section-number-3">7.2</span> Flymake</h3>
<div class="outline-text-3" id="text-7-2">
<p>
Only activate <code>flymake</code> for actual projects and for <code>prog-mode</code>
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span class="org-keyword">defun</span> <span class="org-function-name">my/setup-flymake</span> ()
  <span class="org-doc">"Activate flymake only if we are inside a project."</span>
  (<span class="org-keyword">when</span> (functionp 'my/project-p)
    (flymake-mode 1)))

(add-hook 'prog-mode-hook 'my/setup-flymake)

(<span class="org-keyword">with-eval-after-load</span> <span class="org-string">"flymake"</span>
  (define-key flymake-mode-map (kbd <span class="org-string">"M-n"</span>) 'flymake-goto-next-error)
  (define-key flymake-mode-map (kbd <span class="org-string">"M-p"</span>) 'flymake-goto-prev-error))
</pre>
</div>
</div>
</div>

<div id="outline-container-org85eec4f" class="outline-3">
<h3 id="org85eec4f"><span class="section-number-3">7.3</span> Direnv</h3>
<div class="outline-text-3" id="text-7-3">
<p>
Handle environment variables per buffer usiong a <code>.envrc</code> file.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package envrc
  <span class="org-builtin">:ensure</span> t
  <span class="org-builtin">:config</span>
  (envrc-global-mode)
  <span class="org-builtin">:bind</span> (<span class="org-builtin">:map</span> envrc-mode-map
              (<span class="org-string">"C-c C-h"</span> . 'cloak-mode)))
</pre>
</div>
</div>
</div>

<div id="outline-container-org10c6408" class="outline-3">
<h3 id="org10c6408"><span class="section-number-3">7.4</span> Cloak mode</h3>
<div class="outline-text-3" id="text-7-4">
<p>
Hide values that match regex patterns in <code>.envrc</code> and <code>restclient</code> files
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package cloak-mode
 <span class="org-builtin">:ensure</span> t
 <span class="org-builtin">:custom</span>
 (cloak-mode-patterns '((envrc-file-mode . <span class="org-string">"[a-zA-Z0-9_]+[ \t]*=[ \t]*</span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">(</span></span><span class="org-string">.*+</span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">)</span></span><span class="org-string">$"</span>)
                        (restclient-mode . <span class="org-string">"^:[</span><span class="org-string"><span class="org-negation-char">^</span></span><span class="org-string">: ]+[ \t]*=[ \t]*</span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">(</span></span><span class="org-string">.+?</span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">)</span></span><span class="org-string">$"</span>)))
 (cloak-mode-mask <span class="org-string">"&#128584;&#128584;&#128584;"</span>)
 <span class="org-builtin">:config</span>
 (global-cloak-mode))
</pre>
</div>
</div>
</div>

<div id="outline-container-org20987c5" class="outline-3">
<h3 id="org20987c5"><span class="section-number-3">7.5</span> perspective.el</h3>
<div class="outline-text-3" id="text-7-5">
<div class="org-src-container">
<pre class="src src-emacs-lisp">
(use-package perspective
  <span class="org-builtin">:ensure</span> t
  <span class="org-builtin">:config</span>
  (persp-mode)
  <span class="org-comment-delimiter">;; </span><span class="org-comment">change default font-face color to be aligned with doom-mode-line</span>
  (set-face-foreground 'persp-selected-face <span class="org-string">"green"</span>)
  <span class="org-comment-delimiter">;; </span><span class="org-comment">setup vim tab like key-bindings</span>
  (define-key evil-normal-state-map (kbd <span class="org-string">"gt"</span>) 'persp-next)
  (define-key evil-normal-state-map (kbd <span class="org-string">"gT"</span>) 'persp-prev))

</pre>
</div>
</div>
</div>

<div id="outline-container-org27e83ae" class="outline-3">
<h3 id="org27e83ae"><span class="section-number-3">7.6</span> Project.el</h3>
<div class="outline-text-3" id="text-7-6">
<p>
<code>project.el</code> default prefix is <code>C-x</code>
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span class="org-keyword">defun</span> <span class="org-function-name">my/project-edit-dir-locals</span> ()
  <span class="org-doc">"Edit .dir-locals.el file in project root."</span>
  (<span class="org-keyword">interactive</span>)
  (find-file (expand-file-name <span class="org-string">".dir-locals.el"</span> (my/project-root))))

(<span class="org-keyword">defun</span> <span class="org-function-name">my/project-edit-direnv</span> ()
  <span class="org-doc">"Edit .envrc file in project root."</span>
  (<span class="org-keyword">interactive</span>)
  (find-file (expand-file-name <span class="org-string">".envrc"</span> (my/project-root))))

(use-package project
  <span class="org-builtin">:straight</span> (<span class="org-builtin">:type</span> built-in)
  <span class="org-builtin">:bind</span> (<span class="org-builtin">:map</span> project-prefix-map
              (<span class="org-string">"D"</span> . 'my/project-edit-direnv)
              (<span class="org-string">"d"</span> . 'project-dired)
              (<span class="org-string">"e"</span> . 'my/project-edit-dir-locals)
              (<span class="org-string">"k"</span> . 'my/project-kill-buffers)
              (<span class="org-string">"n"</span> . 'my/project-open-new-project)
              (<span class="org-string">"p"</span> . 'my/project-switch)))
</pre>
</div>

<p>
Define helper functions to be used by other packages
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span class="org-keyword">defun</span> <span class="org-function-name">my/project-root</span> ()
  <span class="org-doc">"Return project root path."</span>
  (project-current)
  <span class="org-comment-delimiter">;; </span><span class="org-comment">We need to extract third element because `</span><span class="org-comment"><span class="org-constant">project-current</span></span><span class="org-comment">'</span>
  <span class="org-comment-delimiter">;; </span><span class="org-comment">returns project's information as a list of 3 element,</span>
  <span class="org-comment-delimiter">;; </span><span class="org-comment">for example (vc Git "project-path")</span>
  (nth 2 (project-current)))

(<span class="org-keyword">defun</span> <span class="org-function-name">my/project-p</span> ()
  (project-current))

(<span class="org-keyword">defun</span> <span class="org-function-name">my/project-name</span> ()
  <span class="org-doc">"Get project name extracting latest part of project path."</span>
  (<span class="org-keyword">if</span> (my/project-p)
      (second (reverse (split-string (my/project-root) <span class="org-string">"/"</span>)))
    nil))
</pre>
</div>

<p>
<code>perspective.el</code> integration, a new perspective should be "attached" to a project so it's easy to switch between them.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span class="org-keyword">defun</span> <span class="org-function-name">my/project-switch</span> ()
  <span class="org-doc">"Switch to a project and trigger switch action."</span>
  (<span class="org-keyword">interactive</span>)
  <span class="org-comment-delimiter">;; </span><span class="org-comment">make sure all the projects list is available to be used</span>
  (project--ensure-read-project-list)
  (<span class="org-keyword">let*</span> ((projects (mapcar 'car project--list))
         (choice (completing-read <span class="org-string">"Switch to project: "</span> projects))
         (default-directory choice))
    <span class="org-comment-delimiter">;; </span><span class="org-comment">`</span><span class="org-comment"><span class="org-constant">default-directory</span></span><span class="org-comment">' must be defined so `</span><span class="org-comment"><span class="org-constant">project.el</span></span><span class="org-comment">' can know is in a new project</span>
    (my/project-switch-action)))

(<span class="org-keyword">defun</span> <span class="org-function-name">my/project-switch-action</span> ()
  <span class="org-doc">"Switch to a new perspective which name is project's name and open `</span><span class="org-doc"><span class="org-constant">project-find-file</span></span><span class="org-doc">'."</span>
  (<span class="org-keyword">interactive</span>)
  (persp-switch (my/project-name))
  (project-find-file))

(<span class="org-keyword">defun</span> <span class="org-function-name">my/project-kill-buffers</span> ()
  <span class="org-doc">"Kill all the related buffers to the current project and delete its perspective as well."</span>
  (<span class="org-keyword">interactive</span>)
  (<span class="org-keyword">let*</span> ((project-name (my/project-name))
         (project (project-current))
         (buffers-to-kill (project--buffers-to-kill project)))
    (<span class="org-keyword">when</span> (yes-or-no-p (format <span class="org-string">"Kill %d buffers in %s?"</span> (length buffers-to-kill) (my/project-root)))
      <span class="org-comment-delimiter">;; </span><span class="org-comment">in case we're using eglot we shutdown its server</span>
      (<span class="org-keyword">if</span> (<span class="org-keyword">and</span> (<span class="org-keyword">featurep</span> '<span class="org-constant">eglot</span>) (eglot-managed-p))
          (eglot-shutdown (eglot-current-server)))
      (mapc #'kill-buffer buffers-to-kill)
      (persp-kill project-name))))

(<span class="org-keyword">defun</span> <span class="org-function-name">my/project-open-new-project</span> ()
  <span class="org-doc">"Open a project for the first time and add it to `</span><span class="org-doc"><span class="org-constant">project.el</span></span><span class="org-doc">' projects list."</span>
  (<span class="org-keyword">interactive</span>)
  (<span class="org-keyword">let*</span> ((project-path-abs (read-directory-name <span class="org-string">"Enter project root: "</span>))
         <span class="org-comment-delimiter">;; </span><span class="org-comment">we need to define `</span><span class="org-comment"><span class="org-constant">default-directory</span></span><span class="org-comment">' to be able to get the new project when `</span><span class="org-comment"><span class="org-constant">project-current</span></span><span class="org-comment">' is called</span>
         (default-directory (replace-regexp-in-string (expand-file-name <span class="org-string">"~"</span>) <span class="org-string">"~"</span> project-path-abs)))
    (project-remember-project (project-current))
    (my/project-switch-action)))
</pre>
</div>
</div>
</div>

<div id="outline-container-org3c28fed" class="outline-3">
<h3 id="org3c28fed"><span class="section-number-3">7.7</span> Completion</h3>
<div class="outline-text-3" id="text-7-7">
<p>
UI for completion
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package vertico
  <span class="org-builtin">:ensure</span> t
  <span class="org-builtin">:init</span>
  (vertico-mode)
  <span class="org-builtin">:custom</span>
  <span class="org-comment-delimiter">;; </span><span class="org-comment">fixed height</span>
  (vertico-resize nil)
  <span class="org-comment-delimiter">;; </span><span class="org-comment">show max 15 elements</span>
  (vertico-count 15))
</pre>
</div>

<p>
Add annotations to results shown by vertico
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package marginalia
  <span class="org-builtin">:ensure</span>
  <span class="org-builtin">:init</span>
  (marginalia-mode))
</pre>
</div>

<p>
Icons support
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package nerd-icons-completion
  <span class="org-builtin">:ensure</span> t
  <span class="org-builtin">:after</span> marginalia
  <span class="org-builtin">:config</span>
  (nerd-icons-completion-mode)
  (add-hook 'marginalia-mode-hook #'nerd-icons-completion-marginalia-setup))
</pre>
</div>

<p>
Enable better completion styles
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package orderless
  <span class="org-builtin">:ensure</span> t
  <span class="org-builtin">:config</span>
  (<span class="org-keyword">setq</span> completion-styles '(orderless basic)
        completion-category-overrides '((file (styles basic partial-completion)))))
</pre>
</div>

<p>
Disable orderless completion style in company to keep previous behaviour which I like, this was copied from <code>orderless</code> documentation.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp"><span class="org-comment-delimiter">;; </span><span class="org-comment">We follow a suggestion by company maintainer u/hvis:</span>
<span class="org-comment-delimiter">;; </span><span class="org-comment">https://www.reddit.com/r/emacs/comments/nichkl/comment/gz1jr3s/</span>
(<span class="org-keyword">defun</span> <span class="org-function-name">company-completion-styles</span> (capf-fn <span class="org-type">&amp;rest</span> args)
  (<span class="org-keyword">let</span> ((completion-styles '(basic partial-completion)))
    (apply capf-fn args)))

(advice-add 'company-capf <span class="org-builtin">:around</span> #'company-completion-styles)
</pre>
</div>

<p>
Search into project source
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package consult
  <span class="org-builtin">:ensure</span> t)
</pre>
</div>

<p>
Helpers to search term at point and general search into project
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span class="org-keyword">defun</span> <span class="org-function-name">my/grep-in-project</span> (<span class="org-type">&amp;optional</span> term)
  <span class="org-doc">"Run grep in current project.</span>
<span class="org-doc">If TERM is not nil it will be used as initial value."</span>
  (<span class="org-keyword">interactive</span>)
  (<span class="org-keyword">let*</span> ((pattern (read-string <span class="org-string">"Pattern: "</span> (<span class="org-keyword">or</span> term <span class="org-string">""</span>)))
         <span class="org-comment-delimiter">;; </span><span class="org-comment">add an extra space to be able to start typing more filters</span>
         (pattern (concat pattern <span class="org-string">" "</span>)))
    (call-interactively #'(lambda ()
                            (<span class="org-keyword">interactive</span>)
                            (consult-ripgrep (my/project-root) pattern)))))
</pre>
</div>

<p>
Integration with <code>embark</code>
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package embark
  <span class="org-builtin">:ensure</span> t
  <span class="org-builtin">:bind</span>
  (<span class="org-string">"C-;"</span> . embark-act)
  <span class="org-builtin">:config</span>
  <span class="org-comment-delimiter">;; </span><span class="org-comment">grep exported data can have a lot of white spaces so we don't want</span>
  <span class="org-comment-delimiter">;; </span><span class="org-comment">them to be shown while editing their content</span>
  (setq-mode-local embark-collect-mode show-trailing-whitespace nil))

(use-package embark-consult
  <span class="org-builtin">:ensure</span> t
  <span class="org-builtin">:defer</span> t)

(<span class="org-keyword">defun</span> <span class="org-function-name">my/edit-completing-results</span> ()
  <span class="org-doc">"Use results origin to execute an action after export them with `</span><span class="org-doc"><span class="org-constant">embark-export</span></span><span class="org-doc">'."</span>
  (<span class="org-keyword">interactive</span>)
  <span class="org-comment-delimiter">;; </span><span class="org-comment">call of `</span><span class="org-comment"><span class="org-constant">project-find-file</span></span><span class="org-comment">'</span>
  (<span class="org-keyword">when</span> (cl-search <span class="org-string">"Find file in"</span> (buffer-string))
    (run-at-time 0 nil #'embark-export)
    (run-at-time 0 nil #'wdired-change-to-wdired-mode)
    (run-at-time 0 nil #'evil-normal-state))
  <span class="org-comment-delimiter">;; </span><span class="org-comment">call of `</span><span class="org-comment"><span class="org-constant">consult-ripgrep</span></span><span class="org-comment">'</span>
  (<span class="org-keyword">when</span> (cl-search <span class="org-string">"Ripgrep"</span> (buffer-string))
    <span class="org-comment-delimiter">;; </span><span class="org-comment">we use `</span><span class="org-comment"><span class="org-constant">run-at-time</span></span><span class="org-comment">' to ensure all of these steps</span>
    <span class="org-comment-delimiter">;; </span><span class="org-comment">will be executed in order</span>
    (run-at-time 0 nil #'embark-export)
    (run-at-time 0 nil #'wgrep-change-to-wgrep-mode)
    (run-at-time 0 nil #'evil-normal-state)))

(define-key minibuffer-mode-map (kbd <span class="org-string">"C-c C-e"</span>) #'my/edit-completing-results)
</pre>
</div>

<p>
Edit grep buffer
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package wgrep
  <span class="org-builtin">:ensure</span> t
  <span class="org-builtin">:custom</span>
  (wgrep-auto-save-buffer t)
  <span class="org-builtin">:bind</span>
  (<span class="org-string">"C-c C-c"</span> . 'wgrep-finish-edit)
  (<span class="org-string">"C-c C-k"</span> . 'wgrep-abort-changes))
</pre>
</div>
</div>
</div>
</div>


<div id="outline-container-orgbdc2744" class="outline-2">
<h2 id="orgbdc2744"><span class="section-number-2">8</span> Emacs process list</h2>
<div class="outline-text-2" id="text-8">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span class="org-keyword">defun</span> <span class="org-function-name">my/kill-emacs-process</span> ()
  <span class="org-doc">"Show a list of current Emacs processes and kill the selected one."</span>
  (<span class="org-keyword">interactive</span>)
  (<span class="org-keyword">let*</span> ((names (mapcar #'process-name (process-list)))
         (process-name (completing-read <span class="org-string">"Choose process: "</span> names)))
    (delete-process (get-process process-name))
    (message <span class="org-string">"%s process killed"</span> (propertize process-name 'face '(<span class="org-builtin">:foreground</span> <span class="org-string">"magenta"</span>)))))

(global-set-key (kbd <span class="org-string">"C-x c p"</span>) 'my/kill-emacs-process)
</pre>
</div>
</div>
</div>

<div id="outline-container-org53138cd" class="outline-2">
<h2 id="org53138cd"><span class="section-number-2">9</span> Git backup</h2>
<div class="outline-text-2" id="text-9">
<p>
Save a backup on every save, also allow to recover any version of a file
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span class="org-keyword">defvar</span> <span class="org-variable-name">my/backup-dir</span> (expand-file-name <span class="org-string">"~/.git-backup"</span>))

(<span class="org-keyword">defun</span> <span class="org-function-name">my/git-backup-versioning</span> ()
  <span class="org-doc">"Save a version of the current file."</span>
  (<span class="org-keyword">unless</span> (<span class="org-keyword">featurep</span> '<span class="org-constant">git-backup</span>)
    (<span class="org-keyword">require</span> '<span class="org-constant">git-backup</span>))
  (git-backup-version-file (executable-find <span class="org-string">"git"</span>) my/backup-dir '() (buffer-file-name)))

(<span class="org-keyword">defun</span> <span class="org-function-name">my/git-backup-run-action</span> (command commit-hash)
  <span class="org-doc">"Execute COMMAND with COMMIT-HASH using another defaults arguments."</span>
  (apply command `(,(executable-find <span class="org-string">"git"</span>) ,my/backup-dir ,commit-hash ,(buffer-file-name))))

<span class="org-comment-delimiter">;</span><span class="org-comment">TODO: fix order in results</span>
(<span class="org-keyword">defun</span> <span class="org-function-name">my/git-backup</span> ()
  <span class="org-doc">"Navigate in versions of the current file."</span>
  (<span class="org-keyword">interactive</span>)
  (<span class="org-keyword">unless</span> (<span class="org-keyword">featurep</span> '<span class="org-constant">git-backup</span>)
    (<span class="org-keyword">require</span> '<span class="org-constant">git-backup</span>))
  <span class="org-comment-delimiter">;; </span><span class="org-comment">for some reason an extra space after `</span><span class="org-comment"><span class="org-constant">%h|</span></span><span class="org-comment">' is required to avoid an error when</span>
  <span class="org-comment-delimiter">;; </span><span class="org-comment">the shell command is executed</span>
  (<span class="org-keyword">let*</span> ((candidates (git-backup-list-file-change-time (executable-find <span class="org-string">"git"</span>) my/backup-dir <span class="org-string">"%cI|%h| %ar"</span> (buffer-file-name)))
         (selection (completing-read <span class="org-string">"Pick revision: "</span> candidates))
         (commit-hash (nth 1 (string-split selection <span class="org-string">"|"</span>)))
         (action (completing-read <span class="org-string">"Choose action: "</span> '(<span class="org-string">"diff"</span> <span class="org-string">"new buffer"</span> <span class="org-string">"replace current buffer"</span>))))
    (<span class="org-keyword">cond</span> ((string-equal action <span class="org-string">"diff"</span>) (my/git-backup-run-action 'git-backup-create-ediff commit-hash))
          ((string-equal action <span class="org-string">"new buffer"</span>) (my/git-backup-run-action 'git-backup-open-in-new-buffer commit-hash))
          ((string-equal action <span class="org-string">"replace current buffer"</span>) (my/git-backup-run-action 'git-backup-replace-current-buffer commit-hash))
          (t (message <span class="org-string">"Not valid option"</span>)))))

(use-package git-backup
  <span class="org-builtin">:ensure</span> t
  <span class="org-builtin">:hook</span> (after-save . my/git-backup-versioning))
</pre>
</div>
</div>
</div>

<div id="outline-container-orgec226ae" class="outline-2">
<h2 id="orgec226ae"><span class="section-number-2">10</span> Meme</h2>
<div class="outline-text-2" id="text-10">
<p>
This package requires to have svg support in emacs, this feature relies on <code>librsvg</code> at compilation time
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">
(<span class="org-keyword">defun</span> <span class="org-function-name">my/meme-from-clipboard</span> ()
  <span class="org-doc">"Create a meme using an image from clipboard"</span>
  (<span class="org-keyword">interactive</span>)
  (<span class="org-keyword">unless</span> (executable-find <span class="org-string">"pngpaste"</span>)
    (<span class="org-warning">user-error</span> <span class="org-string">"please install pngpaste"</span>))

  (<span class="org-keyword">let*</span> ((filepath (make-temp-file <span class="org-string">"clipboard"</span> nil <span class="org-string">".png"</span>))
         (command (format <span class="org-string">"pngpaste %s"</span> filepath))
         (command-stdout (shell-command-to-string command)))
    <span class="org-comment-delimiter">;; </span><span class="org-comment">pngpaste returns "" when found a valid image in the clipboard</span>
    (<span class="org-keyword">unless</span> (string-equal command-stdout <span class="org-string">""</span>)
      (<span class="org-warning">user-error</span> (string-trim command-stdout)))

    (switch-to-buffer (get-buffer-create <span class="org-string">"*meme*"</span>))
    (meme-mode)
    (meme--setup-image filepath)))

</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">
(use-package imgur
  <span class="org-builtin">:ensure</span> t
  <span class="org-builtin">:defer</span> t
  <span class="org-builtin">:straight</span> (imgur
             <span class="org-builtin">:type</span> git
             <span class="org-builtin">:host</span> github
             <span class="org-builtin">:repo</span> <span class="org-string">"myuhe/imgur.el"</span>))

(use-package meme
  <span class="org-builtin">:ensure</span> t
  <span class="org-builtin">:defer</span> t
  <span class="org-builtin">:commands</span> (meme-mode meme)
  <span class="org-builtin">:straight</span> (meme
             <span class="org-builtin">:type</span> git
             <span class="org-builtin">:host</span> github
             <span class="org-builtin">:repo</span> <span class="org-string">"larsmagne/meme"</span>)
  <span class="org-builtin">:config</span>
  <span class="org-comment-delimiter">;; </span><span class="org-comment">fix to be able to read images, straight.el put files in a different directory so we have to</span>
  <span class="org-comment-delimiter">;; </span><span class="org-comment">move them to the right one</span>
  (<span class="org-keyword">let</span> ((images-dest-dir (concat user-emacs-directory <span class="org-string">"straight/build/meme/images"</span>))
        (images-source-dir (concat user-emacs-directory <span class="org-string">"straight/repos/meme/images"</span>)))
    (<span class="org-keyword">unless</span> (file-directory-p images-dest-dir)
      (shell-command (format <span class="org-string">"cp -r %s %s"</span> images-source-dir images-dest-dir)))))

</pre>
</div>
</div>
</div>

<div id="outline-container-org1715b42" class="outline-2">
<h2 id="org1715b42"><span class="section-number-2">11</span> Orgmode</h2>
<div class="outline-text-2" id="text-11">
<p>
Configured variables:
</p>

<ul class="org-ul">
<li><code>org-latex-caption-above</code> puts table captions at the bottom</li>
<li><code>org-clock-persist</code> persists time even if emacs is closed</li>
<li><code>org-src-fontify-natively</code> enables syntax highlighting for code blocks</li>
<li><code>org-log-done</code> saves the timestamp when a task is done</li>
<li><code>org-src-preserve-indentation</code> when is <code>t</code> avoid to insert a left indentation in source blocks</li>
</ul>

<div class="org-src-container">
<pre class="src src-emacs-lisp">
(<span class="org-keyword">defun</span> <span class="org-function-name">my/org-insert-image-from-clipboard</span> ()
  <span class="org-doc">"Insert image from clipboard using an org tag"</span>
  (<span class="org-keyword">interactive</span>)
  (<span class="org-keyword">let*</span> ((image-name (read-string <span class="org-string">"Filename: "</span> <span class="org-string">"image.png"</span>))
         (images-folder <span class="org-string">"./images"</span>)
         (image-path (format <span class="org-string">"%s/%s"</span> images-folder image-name)))
    (<span class="org-keyword">unless</span> (file-directory-p images-folder)
      (shell-command (format <span class="org-string">"mkdir -p %s"</span> images-folder)))
    (shell-command (format <span class="org-string">"pngpaste %s"</span> image-path))
    (insert (format <span class="org-string">"[[file:%s]]"</span> image-path))))

(evil-leader/set-key-for-mode 'org-mode <span class="org-string">"mii"</span> 'my/org-insert-image-from-clipboard)

</pre>
</div>

<p>
When I read books on Apple Books and I want to insert some quote Apple Books insert some text I don't want in my notes, this function delete that and just insert the meaning part using org quote syntax.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">
(<span class="org-keyword">defun</span> <span class="org-function-name">my/org-insert-quote-from-apple-books</span> ()
  <span class="org-doc">"Take quote from clipboard and remove all the unnecesary text and insert</span>
<span class="org-doc">    an org quote in the current position"</span>
  (<span class="org-keyword">interactive</span>)
  (<span class="org-keyword">let*</span> ((raw-value (current-kill 0 t))
         (tmp (second (split-string raw-value <span class="org-string">"&#8220;"</span>)))
         (quote-value (car (split-string tmp <span class="org-string">"&#8221;"</span>))))
    (insert <span class="org-string">"#+begin_quote\n"</span>)
    (insert (concat quote-value <span class="org-string">"\n"</span>))
    (insert <span class="org-string">"#+end_quote\n"</span>)))

</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">
(<span class="org-keyword">defvar</span> <span class="org-variable-name">my/org-src-block-tmp-window-configuration</span> nil)

(<span class="org-keyword">defun</span> <span class="org-function-name">my/org-edit-special</span> (<span class="org-type">&amp;optional</span> arg)
  <span class="org-doc">"Save current window configuration before a org-edit buffer is open."</span>
  (<span class="org-keyword">setq</span> my/org-src-block-tmp-window-configuration (current-window-configuration)))

(<span class="org-keyword">defun</span> <span class="org-function-name">my/org-edit-src-exit</span> ()
  <span class="org-doc">"Restore the window configuration that was saved before org-edit-special was called."</span>
  (set-window-configuration my/org-src-block-tmp-window-configuration))

(<span class="org-keyword">with-eval-after-load</span> 'org
  (<span class="org-keyword">setq</span> org-latex-caption-above nil
        org-clock-persist 'history
        org-src-fontify-natively t
        org-src-preserve-indentation t
        org-log-done t)
  (org-clock-persistence-insinuate)

  (add-hook 'org-mode-hook #'(lambda ()
                               <span class="org-comment-delimiter">;; </span><span class="org-comment">Since emacs 27 this is needed to use shortcuts like &lt;s to create source blocks</span>
                               (<span class="org-keyword">unless</span> (<span class="org-keyword">featurep</span> '<span class="org-constant">org-tempo</span>)
                                 (<span class="org-keyword">require</span> '<span class="org-constant">org-tempo</span>))
                               (org-indent-mode t)
                               (autopair-mode -1)))

  (advice-add 'org-edit-special <span class="org-builtin">:before</span> 'my/org-edit-special)
  (advice-add 'org-edit-src-exit <span class="org-builtin">:after</span> 'my/org-edit-src-exit)

  (org-babel-do-load-languages 'org-babel-load-languages
                               '((python . t)
                                 (shell . t)
                                 (lisp . t)
                                 (sql . t)
                                 (dot . t)
                                 (plantuml . t)
                                 (emacs-lisp . t))))

(use-package htmlize
  <span class="org-builtin">:ensure</span> t
  <span class="org-builtin">:after</span> (org))

</pre>
</div>

<p>
Fix error with <code>TAB</code> in <code>evil-mode</code> in <code>org-mode</code> with org elements.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span class="org-keyword">defun</span> <span class="org-function-name">my/org-tab</span> ()
  <span class="org-doc">"Run `</span><span class="org-doc"><span class="org-constant">org-cycle</span></span><span class="org-doc">' only at point of an org element."</span>
  (<span class="org-keyword">interactive</span>)
  (<span class="org-keyword">if</span> (org-element-at-point)
      (org-cycle)
    (evil-jump-forward)))

(<span class="org-keyword">with-eval-after-load</span> 'org
  (define-key org-mode-map (kbd <span class="org-string">"&lt;tab&gt;"</span>) 'my/org-tab))
</pre>
</div>
</div>

<div id="outline-container-org6fa9a55" class="outline-3">
<h3 id="org6fa9a55"><span class="section-number-3">11.1</span> Org tree slide</h3>
<div class="outline-text-3" id="text-11-1">
<p>
A tool to show org file as an slideshow
</p>

<p>
<code>hide-mode-line</code> hide the modeline to allow to have a clean screen while using <code>org-tree-slide-mode</code>
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">
(use-package hide-mode-line
  <span class="org-builtin">:ensure</span> t)

</pre>
</div>

<p>
Some tweaks to have a better looking while presenting slides
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">
(<span class="org-keyword">defun</span> <span class="org-function-name">my/org-tree-slide-setup</span> ()
  (org-display-inline-images)
  (hide-mode-line-mode 1))

(<span class="org-keyword">defun</span> <span class="org-function-name">my/org-tree-slide-end</span> ()
  (org-display-inline-images)
  (hide-mode-line-mode 0))

(use-package org-tree-slide
  <span class="org-builtin">:ensure</span> t
  <span class="org-builtin">:defer</span> t
  <span class="org-builtin">:custom</span>
  (org-image-actual-width nil)
  (org-tree-slide-activate-message <span class="org-string">"Presentation started!"</span>)
  (org-tree-slide-deactivate-message <span class="org-string">"Presentation finished!"</span>)
  <span class="org-builtin">:hook</span> ((org-tree-slide-play . my/org-tree-slide-setup)
         (org-tree-slide-stop . my/org-tree-slide-end))
  <span class="org-builtin">:bind</span> (<span class="org-builtin">:map</span> org-tree-slide-mode-map
              (<span class="org-string">"C-&lt;"</span> . org-tree-slide-move-previous-tree)
              (<span class="org-string">"C-&gt;"</span> . org-tree-slide-move-next-tree)))

</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org7aa026b" class="outline-2">
<h2 id="org7aa026b"><span class="section-number-2">12</span> Denote</h2>
<div class="outline-text-2" id="text-12">
<p>
Note taking using <code>denote</code>
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package denote
  <span class="org-builtin">:ensure</span> t
  <span class="org-builtin">:custom</span> (denote-directory <span class="org-string">"~/Documents/wiki"</span>)
  <span class="org-builtin">:hook</span> ((dired-mode . denote-dired-mode)))

(<span class="org-keyword">defun</span> <span class="org-function-name">my/wiki</span> ()
  <span class="org-doc">"Open personal wiki and launch Dired."</span>
  (<span class="org-keyword">interactive</span>)
  (dired (expand-file-name <span class="org-string">"~/Documents/wiki"</span>))
  (dired-hide-details-mode t))
</pre>
</div>
</div>
</div>

<div id="outline-container-org2832c2e" class="outline-2">
<h2 id="org2832c2e"><span class="section-number-2">13</span> Latex</h2>
<div class="outline-text-2" id="text-13">
<div class="org-src-container">
<pre class="src src-emacs-lisp">
(use-package auctex
  <span class="org-builtin">:ensure</span> t
  <span class="org-builtin">:defer</span> t)

(use-package latex-preview-pane
  <span class="org-builtin">:ensure</span> t
  <span class="org-builtin">:defer</span> t)

</pre>
</div>
</div>
</div>

<div id="outline-container-org67a2daf" class="outline-2">
<h2 id="org67a2daf"><span class="section-number-2">14</span> Git</h2>
<div class="outline-text-2" id="text-14">
</div>
<div id="outline-container-org3cc112f" class="outline-3">
<h3 id="org3cc112f"><span class="section-number-3">14.1</span> Git-link</h3>
<div class="outline-text-3" id="text-14-1">
<p>
Open selected region in remote repo page
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">
(use-package git-link
  <span class="org-builtin">:ensure</span> t
  <span class="org-builtin">:defer</span> t)

</pre>
</div>
</div>
</div>

<div id="outline-container-org3eb797f" class="outline-3">
<h3 id="org3eb797f"><span class="section-number-3">14.2</span> Git modes</h3>
<div class="outline-text-3" id="text-14-2">
<p>
This pacakge includes <code>gitignore-mode</code>, <code>gitconfig-mode</code> and <code>gitattributes-mode</code>
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">
(use-package git-modes
  <span class="org-builtin">:defer</span> t
  <span class="org-builtin">:ensure</span> t)

</pre>
</div>
</div>
</div>

<div id="outline-container-orgd87d481" class="outline-3">
<h3 id="orgd87d481"><span class="section-number-3">14.3</span> Magit</h3>
<div class="outline-text-3" id="text-14-3">
<div class="org-src-container">
<pre class="src src-emacs-lisp">
(<span class="org-keyword">defun</span> <span class="org-function-name">my/magit-blame-quit</span> ()
  <span class="org-doc">"Restore evil state after magit blame mode is closed."</span>
  (evil-exit-emacs-state))

(use-package magit
  <span class="org-builtin">:ensure</span> t
  <span class="org-builtin">:custom</span>
  <span class="org-comment-delimiter">;; </span><span class="org-comment">restore previous window configuration after a buffer is closed</span>
  (magit-bury-buffer-function 'magit-restore-window-configuration)
  <span class="org-comment-delimiter">;; </span><span class="org-comment">open magit status buffer in the whole frame</span>
  (magit-display-buffer-function 'magit-display-buffer-fullframe-status-v1)
  <span class="org-builtin">:defer</span> t
  <span class="org-builtin">:config</span>
  (advice-add 'magit-blame-quit <span class="org-builtin">:after</span> 'my/magit-blame-quit)
  (add-hook 'git-commit-mode-hook 'my/setup-ispell-for-commit-message)
  (add-hook 'magit-blame-mode-hook #'(lambda () (evil-emacs-state))))

</pre>
</div>
</div>
</div>

<div id="outline-container-org1162cab" class="outline-3">
<h3 id="org1162cab"><span class="section-number-3">14.4</span> Magit delta</h3>
<div class="outline-text-3" id="text-14-4">
<p>
Use <code>delta</code> tool to show diffs in magit
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package magit-delta
  <span class="org-builtin">:ensure</span> t
  <span class="org-builtin">:if</span> (executable-find <span class="org-string">"delta"</span>)
  <span class="org-builtin">:hook</span> (magit-mode . magit-delta-mode))
</pre>
</div>
</div>
</div>

<div id="outline-container-org055ae55" class="outline-3">
<h3 id="org055ae55"><span class="section-number-3">14.5</span> Forge</h3>
<div class="outline-text-3" id="text-14-5">
<div class="org-src-container">
<pre class="src src-emacs-lisp">
(use-package forge
  <span class="org-builtin">:ensure</span> t
  <span class="org-builtin">:after</span> (magit closql)
  <span class="org-builtin">:config</span>
  (add-hook 'forge-topic-mode-hook #'(lambda () (evil-emacs-state))))

</pre>
</div>
</div>
</div>

<div id="outline-container-orgc227aa2" class="outline-3">
<h3 id="orgc227aa2"><span class="section-number-3">14.6</span> Git diff-hl</h3>
<div class="outline-text-3" id="text-14-6">
<div class="org-src-container">
<pre class="src src-emacs-lisp">
(use-package diff-hl
  <span class="org-builtin">:ensure</span> t
  <span class="org-builtin">:custom</span>
  (diff-hl-show-staged-changes nil)
  <span class="org-comment-delimiter">;; </span><span class="org-comment">for some reason the :hook form doesn't work so we have to use :init</span>
  <span class="org-builtin">:init</span>
  (add-hook 'magit-pre-refresh-hook 'diff-hl-magit-pre-refresh)
  (add-hook 'magit-post-refresh-hook 'diff-hl-magit-post-refresh)
  (add-hook 'dired-mode-hook 'diff-hl-dired-mode)
  <span class="org-builtin">:config</span>
  (global-diff-hl-mode))

</pre>
</div>
</div>
</div>

<div id="outline-container-org65bbfe7" class="outline-3">
<h3 id="org65bbfe7"><span class="section-number-3">14.7</span> Timemachine</h3>
<div class="outline-text-3" id="text-14-7">
<div class="org-src-container">
<pre class="src src-emacs-lisp">
(use-package git-timemachine
  <span class="org-builtin">:ensure</span> t
  <span class="org-builtin">:config</span>
  (add-hook 'git-timemachine-mode-hook #'(lambda () (evil-emacs-state))))

</pre>
</div>
</div>
</div>

<div id="outline-container-org1457775" class="outline-3">
<h3 id="org1457775"><span class="section-number-3">14.8</span> Gist</h3>
<div class="outline-text-3" id="text-14-8">
<div class="org-src-container">
<pre class="src src-emacs-lisp">
(use-package gist
  <span class="org-builtin">:ensure</span> t
  <span class="org-builtin">:defer</span> t)

</pre>
</div>
</div>
</div>

<div id="outline-container-orge0ed361" class="outline-3">
<h3 id="orge0ed361"><span class="section-number-3">14.9</span> Linkode</h3>
<div class="outline-text-3" id="text-14-9">
<div class="org-src-container">
<pre class="src src-emacs-lisp">
(use-package linkode
  <span class="org-builtin">:ensure</span> t
  <span class="org-builtin">:defer</span> t)

</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org3126dfc" class="outline-2">
<h2 id="org3126dfc"><span class="section-number-2">15</span> Web</h2>
<div class="outline-text-2" id="text-15">
</div>
<div id="outline-container-org62f9757" class="outline-3">
<h3 id="org62f9757"><span class="section-number-3">15.1</span> Web mode</h3>
<div class="outline-text-3" id="text-15-1">
<div class="org-src-container">
<pre class="src src-emacs-lisp">
(<span class="org-keyword">defun</span> <span class="org-function-name">my/web-mode-hook</span> ()
  (emmet-mode)
  (rainbow-delimiters-mode-disable)
  (autopair-mode -1))

(use-package web-mode
  <span class="org-builtin">:ensure</span> t
  <span class="org-builtin">:custom</span>
  (web-mode-enable-current-element-highlight t)
  (web-mode-enable-current-column-highlight t)
  <span class="org-builtin">:mode</span> ((<span class="org-string">"\\.html\\'"</span> . web-mode)
         (<span class="org-string">"\\.html.eex\\'"</span> . web-mode)
         (<span class="org-string">"\\.html.leex\\'"</span> . web-mode)
         (<span class="org-string">"\\.html.heex\\'"</span> . web-mode)
         (<span class="org-string">"\\.hbs\\'"</span> . web-mode))
  <span class="org-builtin">:config</span>
  (add-hook 'web-mode-hook 'my/web-mode-hook))

</pre>
</div>
</div>
</div>

<div id="outline-container-orgc420b69" class="outline-3">
<h3 id="orgc420b69"><span class="section-number-3">15.2</span> Emmet</h3>
<div class="outline-text-3" id="text-15-2">
<div class="org-src-container">
<pre class="src src-emacs-lisp">
(use-package emmet-mode
  <span class="org-builtin">:ensure</span> t)

</pre>
</div>
</div>
</div>

<div id="outline-container-orge9b6d44" class="outline-3">
<h3 id="orge9b6d44"><span class="section-number-3">15.3</span> Sass</h3>
<div class="outline-text-3" id="text-15-3">
<div class="org-src-container">
<pre class="src src-emacs-lisp">
(use-package sass-mode
  <span class="org-builtin">:ensure</span> t
  <span class="org-builtin">:defer</span> t)

</pre>
</div>
</div>
</div>

<div id="outline-container-org3d56d08" class="outline-3">
<h3 id="org3d56d08"><span class="section-number-3">15.4</span> Rainbow</h3>
<div class="outline-text-3" id="text-15-4">
<div class="org-src-container">
<pre class="src src-emacs-lisp">
(use-package rainbow-mode
  <span class="org-builtin">:ensure</span> t
  <span class="org-builtin">:hook</span>
  ((css-mode . rainbow-mode)
   (sass-mode . rainbow-mode)
   (scss-mode . rainbow-mode)))

</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-orgeaedb98" class="outline-2">
<h2 id="orgeaedb98"><span class="section-number-2">16</span> Miscellaneous</h2>
<div class="outline-text-2" id="text-16">
<div class="org-src-container">
<pre class="src src-emacs-lisp">
(use-package writeroom-mode
  <span class="org-builtin">:ensure</span> t)

(use-package csv-mode
  <span class="org-builtin">:ensure</span> t
  <span class="org-builtin">:defer</span> t)

(use-package jsonian
  <span class="org-builtin">:ensure</span> t
  <span class="org-builtin">:defer</span> t)

(use-package request
  <span class="org-builtin">:ensure</span> t
  <span class="org-builtin">:defer</span> t)

(use-package graphql-mode
  <span class="org-builtin">:ensure</span> t
  <span class="org-builtin">:defer</span> t)

(<span class="org-keyword">defun</span> <span class="org-function-name">my/k8s-apply</span> ()
  <span class="org-doc">"Apply current yaml file to the current kubernetes context."</span>
  (<span class="org-keyword">interactive</span>)
  (<span class="org-keyword">let</span> ((default-directory (file-name-directory buffer-file-name)))
    (compile (format <span class="org-string">"kubectl apply -f %s"</span> buffer-file-name))))

(use-package yaml-mode
  <span class="org-builtin">:ensure</span> t
  <span class="org-builtin">:bind</span> (<span class="org-builtin">:map</span> yaml-mode-map
              (<span class="org-string">"C-c C-c"</span> . 'my/k8s-apply)))

(use-package flymake-yamllint
  <span class="org-builtin">:ensure</span> t
  <span class="org-builtin">:defer</span> t
  <span class="org-builtin">:hook</span>
  (yaml-mode . flymake-mode)
  (yaml-mode . flymake-yamllint-setup))

(use-package yaml-pro
  <span class="org-builtin">:ensure</span> t
  <span class="org-builtin">:defer</span> t
  <span class="org-builtin">:hook</span>
  (yaml-mode . yaml-pro-ts-mode))

(use-package hcl-mode
  <span class="org-builtin">:ensure</span> t)

<span class="org-comment-delimiter">;; </span><span class="org-comment">Used for gherkin files (.feature)</span>
(use-package feature-mode
  <span class="org-builtin">:ensure</span> t
  <span class="org-builtin">:defer</span> t)

(use-package toml-mode
  <span class="org-builtin">:ensure</span> t
  <span class="org-builtin">:defer</span> t)

(use-package nix-mode
  <span class="org-builtin">:ensure</span> t
  <span class="org-builtin">:defer</span> t
  <span class="org-builtin">:mode</span> <span class="org-string">"\\.nix\\'"</span>)

(use-package markdown-mode
  <span class="org-builtin">:ensure</span> t
  <span class="org-builtin">:defer</span> t)

(use-package edit-indirect
  <span class="org-builtin">:ensure</span> t
  <span class="org-builtin">:defer</span> t)

(use-package dockerfile-mode
  <span class="org-builtin">:ensure</span> t
  <span class="org-builtin">:defer</span> t)

(use-package dumb-jump
  <span class="org-builtin">:ensure</span> t
  <span class="org-builtin">:defer</span> t
  <span class="org-builtin">:custom</span>
  (dumb-jump-prefer-searcher 'rg)
  (dumb-jump-selector 'completing-read))

</pre>
</div>

<p>
helpful, enhance help functions
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package helpful
  <span class="org-builtin">:ensure</span> t
  <span class="org-builtin">:defer</span> t)

<span class="org-comment-delimiter">;; </span><span class="org-comment">these function have autoload annotation so they will load `</span><span class="org-comment"><span class="org-constant">helpful</span></span><span class="org-comment">' package when they are called</span>
<span class="org-comment-delimiter">;; </span><span class="org-comment">because we're defined just keybindings we can just use the symbol even the function is not loaded yet</span>
(global-set-key (kbd <span class="org-string">"C-h f"</span>) #'helpful-callable)
(global-set-key (kbd <span class="org-string">"C-h v"</span>) #'helpful-variable)
(global-set-key (kbd <span class="org-string">"C-h k"</span>) #'helpful-key)
</pre>
</div>

<p>
Use ESC key instead C-g to close and abort
</p>

<p>
Copied from somewhere
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">
(<span class="org-keyword">defun</span> <span class="org-function-name">minibuffer-keyboard-quit</span> ()
  <span class="org-doc">"Abort recursive edit.</span>
<span class="org-doc">  In Delete Selection mode, if the mark is active, just deactivate it;</span>
<span class="org-doc">  then it takes a second \\[</span><span class="org-doc"><span class="org-constant">keyboard-quit</span></span><span class="org-doc">] to abort the minibuffer."</span>
  (<span class="org-keyword">interactive</span>)
  (<span class="org-keyword">if</span> (<span class="org-keyword">and</span> delete-selection-mode transient-mark-mode mark-active)
      (<span class="org-keyword">setq</span> deactivate-mark  t)
    (<span class="org-keyword">when</span> (get-buffer <span class="org-string">"*Completions*"</span>) (delete-windows-on <span class="org-string">"*Completions*"</span>))
    (abort-recursive-edit)))

(<span class="org-keyword">with-eval-after-load</span> 'evil
  (define-key evil-normal-state-map [escape] 'keyboard-quit)
  (define-key evil-visual-state-map [escape] 'keyboard-quit))

(define-key minibuffer-local-map [escape] 'minibuffer-keyboard-quit)
(define-key minibuffer-local-ns-map [escape] 'minibuffer-keyboard-quit)
(define-key minibuffer-local-completion-map [escape] 'minibuffer-keyboard-quit)
(define-key minibuffer-local-must-match-map [escape] 'minibuffer-keyboard-quit)
(define-key minibuffer-local-isearch-map [escape] 'minibuffer-keyboard-quit)
(global-set-key [escape] 'evil-exit-emacs-state)

</pre>
</div>

<p>
Emacs Start Up Profiler
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">
(use-package esup
  <span class="org-builtin">:ensure</span> t)

</pre>
</div>
</div>
</div>

<div id="outline-container-org1b33aac" class="outline-2">
<h2 id="org1b33aac"><span class="section-number-2">17</span> LSP</h2>
<div class="outline-text-2" id="text-17">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package eglot
  <span class="org-builtin">:ensure</span> nil
  <span class="org-builtin">:defer</span> t
  <span class="org-builtin">:straight</span> (<span class="org-builtin">:type</span> built-in)
  <span class="org-builtin">:bind</span> (<span class="org-builtin">:map</span> eglot-mode-map
              (<span class="org-string">"C-c C-d"</span> . 'eldoc-doc-buffer)
              (<span class="org-string">"C-c C-s"</span> . 'xref-find-references))
  <span class="org-builtin">:config</span>
  (<span class="org-keyword">setf</span> (alist-get 'elixir-mode eglot-server-programs) `(,(expand-file-name <span class="org-string">"~/Code/oss/elixir-ls/release/language_server.sh"</span>))))
</pre>
</div>

<p>
In case we don't have eglot running we can relay on dump-jump
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span class="org-keyword">defun</span> <span class="org-function-name">my/goto-definition-dumb-jump-fallback</span> ()
  <span class="org-doc">"Go to definition using eglot when is active otherwise use dumb-jump."</span>
  (<span class="org-keyword">interactive</span>)
  (<span class="org-keyword">if</span> (<span class="org-keyword">and</span> (<span class="org-keyword">featurep</span> '<span class="org-constant">eglot</span>) (eglot-managed-p))
      (xref-find-definitions (thing-at-point 'symbol))
    (dumb-jump-go)))
</pre>
</div>
</div>
</div>

<div id="outline-container-orge3745d2" class="outline-2">
<h2 id="orge3745d2"><span class="section-number-2">18</span> Programming languages</h2>
<div class="outline-text-2" id="text-18">
</div>
<div id="outline-container-org2616aa7" class="outline-3">
<h3 id="org2616aa7"><span class="section-number-3">18.1</span> Shell scripts</h3>
<div class="outline-text-3" id="text-18-1">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package flymake-shellcheck
  <span class="org-builtin">:ensure</span> t
  <span class="org-builtin">:defer</span> t
  <span class="org-builtin">:if</span> (executable-find <span class="org-string">"shellcheck"</span>)
  <span class="org-builtin">:commands</span> flymake-shellcheck-load
  <span class="org-builtin">:init</span>
  (add-hook 'sh-mode-hook 'flymake-shellcheck-load))
</pre>
</div>
</div>
</div>

<div id="outline-container-orge28f803" class="outline-3">
<h3 id="orge28f803"><span class="section-number-3">18.2</span> C</h3>
<div class="outline-text-3" id="text-18-2">
<p>
<code>clang-format</code> is required for this, we can install it with <code>brew install clang-format</code>
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">
(reformatter-define c-format
  <span class="org-builtin">:program</span> <span class="org-string">"clang-format"</span>)

(<span class="org-keyword">with-eval-after-load</span> 'cc-mode
  (define-key c-mode-map (kbd <span class="org-string">"C-c C-f"</span>) 'c-format-buffer))

</pre>
</div>
</div>
</div>

<div id="outline-container-org5ce5afd" class="outline-3">
<h3 id="org5ce5afd"><span class="section-number-3">18.3</span> Python</h3>
<div class="outline-text-3" id="text-18-3">
<p>
For each virtual environment install the following packages:
</p>

<div class="org-src-container">
<pre class="src src-sh">pip install elpy jedi flake8 epc
</pre>
</div>

<p>
For LSP support <code>python-language-server</code> is required
</p>

<div class="org-src-container">
<pre class="src src-sh">pip python-language-server
</pre>
</div>

<p>
Install <code>flymake-ruff</code>
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package flymake-ruff
  <span class="org-builtin">:ensure</span> t)
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">
(reformatter-define python-black-format
  <span class="org-builtin">:program</span> <span class="org-string">"black"</span>
  <span class="org-builtin">:args</span> '(<span class="org-string">"-"</span>)
  <span class="org-builtin">:group</span> 'python)

(reformatter-define python-sort-imports
  <span class="org-builtin">:program</span> <span class="org-string">"ruff"</span>
  <span class="org-builtin">:args</span> '(<span class="org-string">"--fix"</span> <span class="org-string">"--select"</span> <span class="org-string">"I001"</span> <span class="org-string">"-"</span>)
  <span class="org-builtin">:group</span> 'python)

<span class="org-comment-delimiter">;; </span><span class="org-comment">we use elpy just to have `</span><span class="org-comment"><span class="org-constant">elpy-test</span></span><span class="org-comment">'</span>
(use-package elpy
  <span class="org-builtin">:ensure</span> t
  <span class="org-builtin">:defer</span> t
  <span class="org-builtin">:custom</span>
  <span class="org-comment-delimiter">;; </span><span class="org-comment">always print stdout when running tests with pytest</span>
  (elpy-test-pytest-runner-command '(<span class="org-string">"pytest"</span> <span class="org-string">"-s"</span>))
  (elpy-shell-echo-input nil))

(<span class="org-keyword">setq</span> python-shell-completion-native-enable nil)

(<span class="org-keyword">defun</span> <span class="org-function-name">my/ensure-elpy-is-loaded</span> ()
  <span class="org-doc">"Check if `</span><span class="org-doc"><span class="org-constant">elpy</span></span><span class="org-doc">' is loaded otherwise load it."</span>
  (<span class="org-keyword">unless</span> (<span class="org-keyword">featurep</span> '<span class="org-constant">elpy</span>)
    (<span class="org-keyword">require</span> '<span class="org-constant">elpy</span>)))

(<span class="org-keyword">with-eval-after-load</span> 'python
  (evil-leader/set-key-for-mode 'python-mode <span class="org-string">"d"</span> 'my/goto-definition-dumb-jump-fallback)
  (define-key python-mode-map (kbd <span class="org-string">"C-c C-f"</span>) 'python-black-format-buffer)
  (define-key python-mode-map (kbd <span class="org-string">"C-c C-t"</span>) 'elpy-test)
  (define-key python-mode-map (kbd <span class="org-string">"C-c C-i"</span>) 'python-sort-imports-region)
  (add-hook 'python-mode-hook #'flymake-ruff-load)
  (add-hook 'python-mode-hook 'my/ensure-elpy-is-loaded))

</pre>
</div>

<p>
Show a list of the available django commands and run the selected one using a compilation buffer.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">
(<span class="org-keyword">defun</span> <span class="org-function-name">my/run-django-command</span> ()
  <span class="org-doc">"Run a django command."</span>
  (<span class="org-keyword">interactive</span>)
  (<span class="org-keyword">let*</span> ((python-bin (concat (getenv <span class="org-string">"VIRTUAL_ENV"</span>) <span class="org-string">"/bin/python"</span>))
         (manage-py-file (concat (my/project-root) <span class="org-string">"manage.py"</span>))
         (default-directory (my/project-root))
         (raw-help (shell-command-to-string (concat python-bin <span class="org-string">" "</span> manage-py-file <span class="org-string">" help"</span>)))
         (splited-lines (split-string raw-help <span class="org-string">"\n"</span>))
         (options (seq-filter #'(lambda (line) (cl-search <span class="org-string">"    "</span> line)) splited-lines))
         (selection (completing-read <span class="org-string">"Pick django command: "</span> (mapcar 'string-trim options)))
         (command (concat python-bin <span class="org-string">" "</span> manage-py-file <span class="org-string">" "</span> selection)))
    (compile command)))

</pre>
</div>
</div>
</div>

<div id="outline-container-org7948bf6" class="outline-3">
<h3 id="org7948bf6"><span class="section-number-3">18.4</span> Erlang</h3>
<div class="outline-text-3" id="text-18-4">
<p>
Clone erlang source code into <code>~/Code/erlang/src/</code>
</p>

<div class="org-src-container">
<pre class="src src-sh">
git clone https://github.com/erlang/otp.git ~/Code/erlang/src/

</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">
(use-package erlang
  <span class="org-builtin">:ensure</span> t
  <span class="org-builtin">:defer</span> t
  <span class="org-builtin">:if</span> (executable-find <span class="org-string">"erl"</span>)
  <span class="org-builtin">:config</span>
  (<span class="org-keyword">setq</span> erlang-root-dir (expand-file-name <span class="org-string">"~/Code/erlang/src"</span>))
  (<span class="org-keyword">require</span> '<span class="org-constant">erlang-start</span>))

</pre>
</div>
</div>
</div>

<div id="outline-container-orgcfcc651" class="outline-3">
<h3 id="orgcfcc651"><span class="section-number-3">18.5</span> Elixir</h3>
<div class="outline-text-3" id="text-18-5">
<p>
To have support for LSP we need to compile <a href="https://github.com/elixir-lsp/elixir-ls">elixir-ls</a> and setup the generated release into <code>eglot-server-programs</code>
</p>

<div class="org-src-container">
<pre class="src src-shell">mix elixir_ls.release
</pre>
</div>

<p>
In case project <code>mix.exs</code> is not in root folder we need to tell <code>elixir_ls</code> where is the correct location using a <code>.dir-locals.el</code> file.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">((elixir-mode . ((eglot-workspace-configuration . ((<span class="org-builtin">:elixirLS</span> . (<span class="org-builtin">:projectDir</span> <span class="org-string">"mix.exs dir/"</span>)))))))
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">
(reformatter-define elixir-format
  <span class="org-builtin">:program</span> <span class="org-string">"mix"</span>
  <span class="org-builtin">:args</span> '(<span class="org-string">"format"</span> <span class="org-string">"-"</span>)
  <span class="org-builtin">:group</span> 'elixir)

(<span class="org-keyword">defun</span> <span class="org-function-name">my/elixir-format-buffer</span> ()
  <span class="org-doc">"Format elixir buffers using eglot when is active otherwise use reformatter function."</span>
  (<span class="org-keyword">interactive</span>)
  <span class="org-comment-delimiter">;; </span><span class="org-comment">eglot formatter is preferred because it will use project .formatter.exs file</span>
  <span class="org-comment-delimiter">;; </span><span class="org-comment">regular formatter generated by reformatted will ignore that file</span>
  (<span class="org-keyword">if</span> (<span class="org-keyword">and</span> (<span class="org-keyword">featurep</span> '<span class="org-constant">eglot</span>) (eglot-managed-p))
      (eglot-format-buffer)
    (elixir-format-buffer)))

(use-package elixir-mode
  <span class="org-builtin">:ensure</span> t
  <span class="org-builtin">:bind</span> (<span class="org-builtin">:map</span> elixir-mode-map
              (<span class="org-string">"C-c C-t"</span> . 'my/mix-run-test-at-point)
              (<span class="org-string">"C-c C-f"</span> . 'my/elixir-format-buffer))

  <span class="org-builtin">:config</span>
  (evil-leader/set-key-for-mode 'elixir-mode <span class="org-string">"d"</span> 'my/goto-definition-dumb-jump-fallback))

</pre>
</div>

<p>
Custom functions to run elixir tests.
</p>

<p>
<code>elixir-extra-test-env</code> can be set up on <code>.dir-locals.el</code>
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">
(<span class="org-keyword">defun</span> <span class="org-function-name">my/mix-run-test</span> (<span class="org-type">&amp;optional</span> scope)
  <span class="org-doc">"Run elixir test for the given SCOPE."</span>
  (<span class="org-keyword">interactive</span>)
  (<span class="org-keyword">let*</span> ((current-file (buffer-file-name))
         (current-line (line-number-at-pos))
         (mix-file (expand-file-name (concat (locate-dominating-file (buffer-file-name) <span class="org-string">"mix.exs"</span>) <span class="org-string">"mix.exs"</span>)))
         (default-directory (file-name-directory mix-file))
         (extra-env (<span class="org-keyword">if</span> (boundp 'elixir-extra-test-env) elixir-extra-test-env <span class="org-string">""</span>))
         (mix-env (concat <span class="org-string">"MIX_ENV=test "</span> extra-env)))

    (<span class="org-keyword">cond</span>
     ((string-equal scope <span class="org-string">"file"</span>)
      (compile (format <span class="org-string">"%s mix test %s"</span> mix-env current-file)))

     ((string-equal scope <span class="org-string">"at-point"</span>)
      (compile (format <span class="org-string">"%s mix test %s:%s"</span> mix-env current-file current-line)))

     (t
      (compile (format <span class="org-string">"%s mix test"</span> mix-env))))))


(<span class="org-keyword">defun</span> <span class="org-function-name">my/mix-run-test-file</span> ()
  <span class="org-doc">"Run mix test over the current file."</span>
  (<span class="org-keyword">interactive</span>)
  (my/mix-run-test <span class="org-string">"file"</span>))

(<span class="org-keyword">defun</span> <span class="org-function-name">my/mix-run-test-at-point</span> ()
  <span class="org-doc">"Run mix test at point."</span>
  (<span class="org-keyword">interactive</span>)
  (my/mix-run-test <span class="org-string">"at-point"</span>))

(<span class="org-keyword">defun</span> <span class="org-function-name">my/mix-run-test-all</span> ()
  <span class="org-doc">"Run mix test at point."</span>
  (<span class="org-keyword">interactive</span>)
  (my/mix-run-test))

</pre>
</div>
</div>
</div>

<div id="outline-container-orge472057" class="outline-3">
<h3 id="orge472057"><span class="section-number-3">18.6</span> LFE</h3>
<div class="outline-text-3" id="text-18-6">
<div class="org-src-container">
<pre class="src src-emacs-lisp">
(use-package lfe-mode
  <span class="org-builtin">:ensure</span> t
  <span class="org-builtin">:if</span> (executable-find <span class="org-string">"lfe"</span>)
  <span class="org-builtin">:bind</span> (<span class="org-builtin">:map</span> lfe-mode-map
              (<span class="org-string">"C-c C-c"</span> . lfe-eval-buffer))
  <span class="org-builtin">:init</span>
  (<span class="org-keyword">defun</span> <span class="org-function-name">lfe-eval-buffer</span> ()
    <span class="org-doc">"Send current buffer to inferior LFE process."</span>
    (<span class="org-keyword">interactive</span>)
    (<span class="org-keyword">if</span> (eq (get-buffer-window <span class="org-string">"*inferior-lfe*"</span>) nil)
        (run-lfe nil))
    (lfe-eval-region (point-min) (point-max) nil)))

</pre>
</div>
</div>
</div>

<div id="outline-container-org4b1f7c3" class="outline-3">
<h3 id="org4b1f7c3"><span class="section-number-3">18.7</span> Elm</h3>
<div class="outline-text-3" id="text-18-7">
<p>
Install Elm
</p>

<div class="org-src-container">
<pre class="src src-sh">
npm -g install elm elm-format elm-oracle

</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">
(use-package elm-mode
  <span class="org-builtin">:ensure</span> t
  <span class="org-builtin">:if</span> (executable-find <span class="org-string">"elm"</span>)
  <span class="org-builtin">:bind</span> (<span class="org-builtin">:map</span> elm-mode-map
              (<span class="org-string">"C-c C-d"</span> . elm-oracle-doc-at-point))
  <span class="org-builtin">:config</span>
  (add-hook 'elm-mode-hook #'elm-oracle-setup-completion)
  (add-to-list 'company-backends 'company-elm))

</pre>
</div>
</div>
</div>

<div id="outline-container-orgf96592b" class="outline-3">
<h3 id="orgf96592b"><span class="section-number-3">18.8</span> Haskell</h3>
<div class="outline-text-3" id="text-18-8">
<p>
Install haskell binaries <code>hlint</code> and <code>hindent</code> and make sure <code>~/.local/bin/</code> is loaded in <code>PATH</code>.
</p>

<div class="org-src-container">
<pre class="src src-shell">
stack install hlint
stack install hindent

</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">
(reformatter-define haskell-format
  <span class="org-builtin">:program</span> <span class="org-string">"hindent"</span>
  <span class="org-builtin">:group</span> 'haskell)

(use-package haskell-mode
  <span class="org-builtin">:ensure</span> t
  <span class="org-builtin">:bind</span> (<span class="org-builtin">:map</span> haskell-mode-map
              (<span class="org-string">"C-c C-f"</span> . haskell-format-buffer)
              (<span class="org-string">"C-c C-l"</span> . haskell-process-load-file)))

(<span class="org-keyword">defun</span> <span class="org-function-name">my/run-hlint</span> ()
  <span class="org-doc">"Run  hlint over the current project."</span>
  (<span class="org-keyword">interactive</span>)
  (<span class="org-keyword">let</span> ((default-directory (my/project-root)))
    (compile <span class="org-string">"hlint ."</span>)))

(<span class="org-keyword">defun</span> <span class="org-function-name">my/run-hlint-buffer</span> ()
  <span class="org-doc">"Run  hlint over the current buffer."</span>
  (<span class="org-keyword">interactive</span>)
  (<span class="org-keyword">let*</span> ((current-file (buffer-file-name))
         (default-directory (my/project-root)))
    (compile (concat <span class="org-string">"hlint "</span> current-file))))

</pre>
</div>
</div>
</div>

<div id="outline-container-org76d1bc4" class="outline-3">
<h3 id="org76d1bc4"><span class="section-number-3">18.9</span> Lua</h3>
<div class="outline-text-3" id="text-18-9">
<div class="org-src-container">
<pre class="src src-emacs-lisp">
(use-package lua-mode
  <span class="org-builtin">:ensure</span> t
  <span class="org-builtin">:bind</span> (<span class="org-builtin">:map</span> lua-mode-map
              (<span class="org-string">"C-c C-b"</span> . compile)
              (<span class="org-string">"C-c C-f"</span> . lua-format-buffer)))

</pre>
</div>

<p>
Define formatter using <a href="https://github.com/JohnnyMorganz/StyLua">StyLua</a>
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(reformatter-define lua-format
  <span class="org-builtin">:program</span> <span class="org-string">"stylua"</span>
  <span class="org-builtin">:args</span> '(<span class="org-string">"-"</span>)
  <span class="org-builtin">:group</span> 'lua)
</pre>
</div>
</div>
</div>

<div id="outline-container-org53f2dd3" class="outline-3">
<h3 id="org53f2dd3"><span class="section-number-3">18.10</span> Javascript</h3>
<div class="outline-text-3" id="text-18-10">
<p>
We use default <code>js-mode</code> because it has been improved in emacs 27.
</p>
</div>

<div id="outline-container-orgcc28dfe" class="outline-4">
<h4 id="orgcc28dfe"><span class="section-number-4">18.10.1</span> Formattter</h4>
<div class="outline-text-4" id="text-18-10-1">
<p>
We need to use <code>--stdin-filepath a.js</code> to tell <code>prettier</code> to use js parser.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(reformatter-define js-format
  <span class="org-builtin">:program</span> <span class="org-string">"npx"</span>
  <span class="org-builtin">:args</span> '(<span class="org-string">"prettier"</span> <span class="org-string">"--stdin-filepath"</span> <span class="org-string">"a.js"</span>))

(<span class="org-keyword">with-eval-after-load</span> 'js
  (evil-leader/set-key-for-mode 'js-mode <span class="org-string">"d"</span> 'dumb-jump-go)
  (define-key js-mode-map (kbd <span class="org-string">"C-c C-f"</span>) 'js-format-buffer))
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-orgc1fd95c" class="outline-3">
<h3 id="orgc1fd95c"><span class="section-number-3">18.11</span> Typescript</h3>
<div class="outline-text-3" id="text-18-11">
<div class="org-src-container">
<pre class="src src-emacs-lisp">
(use-package typescript-mode
  <span class="org-builtin">:ensure</span> t
  <span class="org-builtin">:defer</span> t
  <span class="org-builtin">:mode</span> <span class="org-string">"\\.tsx?\\'"</span>
  <span class="org-builtin">:config</span>
  (evil-leader/set-key-for-mode 'typescript-mode <span class="org-string">"d"</span> 'dumb-jump-go))

</pre>
</div>
</div>
</div>

<div id="outline-container-org68a34fa" class="outline-3">
<h3 id="org68a34fa"><span class="section-number-3">18.12</span> Rust</h3>
<div class="outline-text-3" id="text-18-12">
<p>
Install rust analyzer, this should be installed when <code>rustup-init</code> is executed but in case is not we can execute:
</p>

<div class="org-src-container">
<pre class="src src-sh">rustup component add rust-analyzer
</pre>
</div>

<p>
Install rust source code, it is required by <code>rust-analyzer</code>, in case it's not installed automatically
</p>

<div class="org-src-container">
<pre class="src src-shell">rustup component add rust-src
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">
(use-package rust-mode
  <span class="org-builtin">:ensure</span> t
  <span class="org-builtin">:if</span> (executable-find <span class="org-string">"rustc"</span>)
  <span class="org-builtin">:config</span>
  (evil-leader/set-key-for-mode 'rust-mode <span class="org-string">"d"</span> 'my/goto-definition-dumb-jump-fallback))

</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span class="org-keyword">defun</span> <span class="org-function-name">my/rust-run-file</span> ()
  <span class="org-doc">"Compile and rust current file."</span>
  (<span class="org-keyword">interactive</span>)
  (<span class="org-keyword">unless</span> (buffer-file-name)
    (<span class="org-warning">user-error</span> <span class="org-string">"Save file before"</span>))
  (<span class="org-keyword">let*</span> ((path (buffer-file-name))
         (default-directory (file-name-directory path))
         (filename (buffer-name))
         (command (format <span class="org-string">"rustc %s &amp;&amp; ./%s"</span> filename (string-replace <span class="org-string">".rs"</span> <span class="org-string">""</span> filename))))
    (compile command)))
</pre>
</div>
</div>
</div>

<div id="outline-container-org04172a0" class="outline-3">
<h3 id="org04172a0"><span class="section-number-3">18.13</span> Golang</h3>
<div class="outline-text-3" id="text-18-13">
<p>
Install dependencies: goimports
</p>

<div class="org-src-container">
<pre class="src src-sh">go get golang.org/x/tools/cmd/goimports
</pre>
</div>

<p>
Install <code>gopls</code> to have LSP support using eglot
</p>

<div class="org-src-container">
<pre class="src src-shell">brew install gopls
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">
(use-package go-mode
  <span class="org-builtin">:ensure</span> t
  <span class="org-builtin">:if</span> (executable-find <span class="org-string">"go"</span>)
  <span class="org-builtin">:bind</span> (<span class="org-builtin">:map</span> go-mode-map
              (<span class="org-string">"C-c C-t"</span> . go-test-current-file)
              (<span class="org-string">"C-c C-c"</span> . go-run)
              (<span class="org-string">"C-c C-f"</span> . gofmt))
  <span class="org-builtin">:hook</span> (go-mode . eglot-ensure)
  <span class="org-builtin">:config</span>
  (<span class="org-keyword">setq</span> gofmt-command <span class="org-string">"goimports"</span>)
  (evil-leader/set-key-for-mode 'go-mode <span class="org-string">"d"</span> 'xref-find-definitions))

(use-package go-playground
  <span class="org-builtin">:ensure</span> t
  <span class="org-builtin">:if</span> (executable-find <span class="org-string">"go"</span>)
  <span class="org-builtin">:after</span> go-mode
  <span class="org-builtin">:config</span>
  (<span class="org-keyword">setq</span> go-playground-basedir (expand-file-name <span class="org-string">"~/Code/golang/playgrounds"</span>)))

</pre>
</div>
</div>
</div>

<div id="outline-container-orgcf71688" class="outline-3">
<h3 id="orgcf71688"><span class="section-number-3">18.14</span> Common lisp</h3>
<div class="outline-text-3" id="text-18-14">
<div class="org-src-container">
<pre class="src src-emacs-lisp">
(<span class="org-keyword">defconst</span> <span class="org-variable-name">inferior-lisp-program</span> (executable-find <span class="org-string">"sbcl"</span>))

(use-package sly
  <span class="org-builtin">:ensure</span> t
  <span class="org-builtin">:defer</span> t)

</pre>
</div>
</div>
</div>

<div id="outline-container-org724963d" class="outline-3">
<h3 id="org724963d"><span class="section-number-3">18.15</span> Clojure</h3>
<div class="outline-text-3" id="text-18-15">
<div class="org-src-container">
<pre class="src src-emacs-lisp">
(<span class="org-keyword">defun</span> <span class="org-function-name">my/clj-format-code</span> ()
  <span class="org-doc">"Format clojure code using cider commands."</span>
  (<span class="org-keyword">interactive</span>)
  (<span class="org-keyword">if</span> (region-active-p)
      (cider-format-region (region-beginning) (region-end))
    (cider-format-buffer)))

(<span class="org-keyword">defun</span> <span class="org-function-name">my/cider-repl-reset</span> ()
  <span class="org-doc">"Call (reset) in the active repl and return to the position where was called."</span>
  (<span class="org-keyword">interactive</span>)
  (<span class="org-keyword">save-window-excursion</span>
    (cider-insert-in-repl <span class="org-string">"(reset)"</span> t)))

(use-package cider
  <span class="org-builtin">:ensure</span> t
  <span class="org-builtin">:bind</span> (<span class="org-builtin">:map</span> cider-mode-map
              (<span class="org-string">"C-c C-f"</span> . my/clj-format-code)
              (<span class="org-string">"C-c C-r"</span> . my/cider-repl-reset)))

(evil-leader/set-key-for-mode 'clojure-mode <span class="org-string">"d"</span> 'cider-find-var)

(<span class="org-keyword">with-eval-after-load</span> 'evil
  (evil-set-initial-state 'cider-stacktrace-mode 'emacs))

</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">
(use-package clj-refactor
  <span class="org-builtin">:ensure</span> t
  <span class="org-builtin">:after</span> cider
  <span class="org-builtin">:bind</span> (<span class="org-builtin">:map</span> clojure-mode-map
              (<span class="org-string">"C-c C-a"</span> . cljr-add-project-dependency))
  <span class="org-builtin">:hook</span> (clojure . clj-refactor))

</pre>
</div>
</div>
</div>

<div id="outline-container-org867da39" class="outline-3">
<h3 id="org867da39"><span class="section-number-3">18.16</span> Emacs lisp</h3>
<div class="outline-text-3" id="text-18-16">
<p>
Enable go to definition with \ d keybinding
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">
(evil-leader/set-key-for-mode 'emacs-lisp-mode <span class="org-string">"d"</span> 'xref-find-definitions)
(evil-leader/set-key-for-mode 'lisp-interaction-mode <span class="org-string">"d"</span> 'xref-find-definitions)

</pre>
</div>

<p>
Disable indentation with tabs for <code>emacs-lisp-mode</code>
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span class="org-keyword">defun</span> <span class="org-function-name">my/emacs-lisp-hook-setup</span> ()
  (<span class="org-keyword">setq</span> indent-tabs-mode nil))

(add-hook 'emacs-lisp-mode-hook 'my/emacs-lisp-hook-setup)
</pre>
</div>

<p>
Enable flymake
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(add-hook 'emacs-lisp-mode-hook 'flymake-mode-on)
</pre>
</div>

<p>
<code>package-lint</code>, used for packages development
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package package-lint
  <span class="org-builtin">:ensure</span> t
  <span class="org-builtin">:defer</span> t)
</pre>
</div>
</div>
</div>

<div id="outline-container-org0a34a6e" class="outline-3">
<h3 id="org0a34a6e"><span class="section-number-3">18.17</span> OCaml</h3>
<div class="outline-text-3" id="text-18-17">
<div class="org-src-container">
<pre class="src src-emacs-lisp">
(use-package tuareg
  <span class="org-builtin">:ensure</span> t
  <span class="org-builtin">:defer</span> t)

(use-package merlin
  <span class="org-builtin">:ensure</span> t
  <span class="org-builtin">:hook</span> ((tuareg-mode caml-mode) . merlin-mode))

(use-package merlin-eldoc
  <span class="org-builtin">:ensure</span> t
  <span class="org-builtin">:hook</span> ((reason-mode tuareg-mode caml-mode) . merlin-eldoc-setup))

</pre>
</div>
</div>
</div>

<div id="outline-container-org287ea62" class="outline-3">
<h3 id="org287ea62"><span class="section-number-3">18.18</span> Dart</h3>
<div class="outline-text-3" id="text-18-18">
<div class="org-src-container">
<pre class="src src-emacs-lisp">
(reformatter-define dart-format
  <span class="org-builtin">:program</span> <span class="org-string">"dart"</span>
  <span class="org-builtin">:args</span> '(<span class="org-string">"format"</span>)
  <span class="org-builtin">:group</span> 'dart)

(<span class="org-keyword">defun</span> <span class="org-function-name">my/dart-run-file</span> ()
  <span class="org-doc">"Execute the code of the current file."</span>
  (<span class="org-keyword">interactive</span>)
  (compile (format <span class="org-string">"dart %s"</span> (buffer-file-name))))

(use-package dart-mode
  <span class="org-builtin">:ensure</span> t
  <span class="org-builtin">:if</span> (<span class="org-keyword">or</span> (executable-find <span class="org-string">"dart"</span>) (executable-find <span class="org-string">"flutter"</span>))
  <span class="org-builtin">:bind</span> (<span class="org-builtin">:map</span> dart-mode-map
              (<span class="org-string">"C-c C-f"</span> . dart-format-buffer)
              (<span class="org-string">"C-c C-c"</span> . my/dart-run-file))
  <span class="org-builtin">:config</span>
  (evil-leader/set-key-for-mode 'dart-mode <span class="org-string">"d"</span> 'xref-find-definitions))

</pre>
</div>
</div>

<div id="outline-container-org32adc6a" class="outline-4">
<h4 id="org32adc6a"><span class="section-number-4">18.18.1</span> Flutter</h4>
<div class="outline-text-4" id="text-18-18-1">
<div class="org-src-container">
<pre class="src src-emacs-lisp">
(<span class="org-keyword">defun</span> <span class="org-function-name">my/flutter-goto-logs-buffer</span>()
  <span class="org-doc">"Go to buffer logs buffer."</span>
  (<span class="org-keyword">interactive</span>)
  (<span class="org-keyword">let</span> ((buffer (get-buffer flutter-buffer-name)))
    (<span class="org-keyword">unless</span> buffer
      (<span class="org-warning">user-error</span> <span class="org-string">"flutter is not running."</span>))
    (switch-to-buffer buffer)
    (goto-line (point-max))))

(use-package flutter
  <span class="org-builtin">:ensure</span> t
  <span class="org-builtin">:after</span> dart-mode
  <span class="org-builtin">:bind</span> (<span class="org-builtin">:map</span> dart-mode-map
              (<span class="org-string">"C-c C-r"</span> . #'flutter-run-or-hot-reload)
              (<span class="org-string">"C-c C-l"</span> . #'my/flutter-goto-logs-buffer))
  <span class="org-builtin">:hook</span> (dart-mode . flutter-test-mode)
  <span class="org-builtin">:custom</span>
  <span class="org-comment-delimiter">;; </span><span class="org-comment">sdk path will be the parent-parent directory of flutter cli</span>
  (flutter-sdk-path (directory-file-name
                     (file-name-directory
                      (directory-file-name
                       (file-name-directory (executable-find <span class="org-string">"flutter"</span>)))))))

</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org7eddb6a" class="outline-3">
<h3 id="org7eddb6a"><span class="section-number-3">18.19</span> F-sharp</h3>
<div class="outline-text-3" id="text-18-19">
<div class="org-src-container">
<pre class="src src-emacs-lisp">
(use-package fsharp-mode
  <span class="org-builtin">:ensure</span> t
  <span class="org-builtin">:defer</span> t
  <span class="org-builtin">:if</span> (executable-find <span class="org-string">"dotnet"</span>)
  <span class="org-builtin">:config</span>
  (evil-leader/set-key-for-mode 'fsharp-mode <span class="org-string">"d"</span> 'fsharp-ac/gotodefn-at-point))

</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org7fefa9f" class="outline-2">
<h2 id="org7fefa9f"><span class="section-number-2">19</span> Writing</h2>
<div class="outline-text-2" id="text-19">
<p>
Custom functions to speed up writing process
</p>
</div>

<div id="outline-container-org3377975" class="outline-3">
<h3 id="org3377975"><span class="section-number-3">19.1</span> Hugo</h3>
<div class="outline-text-3" id="text-19-1">
<p>
Insert <code>org-link</code> image using clipboard value, if the current file is <code>blog/demo.org</code> it will place the resulting image into <code>static/images/blog/demo/image.png</code>.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">
(<span class="org-keyword">defun</span> <span class="org-function-name">my/hugo-insert-image-from-clipboard</span> ()
  <span class="org-doc">"Use clipoard image and put it in a generated images folder for the current file."</span>
  (<span class="org-keyword">interactive</span>)
  (<span class="org-keyword">let*</span> ((absolute-path (buffer-file-name))
         (splitted (reverse (split-string absolute-path <span class="org-string">"/"</span>)))
         (filename (replace-regexp-in-string <span class="org-string">".org"</span> <span class="org-string">""</span> (car splitted)))
         (dir (nth 1 splitted))
         (base-image-path (concat (my/project-root) <span class="org-string">"static/images"</span>))
         (result-image-dir (format <span class="org-string">"%s/%s/%s"</span> base-image-path dir filename))
         (result-image-name (read-string <span class="org-string">"Filename: "</span> <span class="org-string">"image.png"</span>))
         (full-path-result-image (format <span class="org-string">"%s/%s"</span> result-image-dir result-image-name)))

    (shell-command (format <span class="org-string">"mkdir -p %s"</span> result-image-dir))
    (shell-command (format <span class="org-string">"pngpaste %s"</span> full-path-result-image))
    (insert (format <span class="org-string">"[[file:%s]]"</span> (car (cdr (split-string full-path-result-image <span class="org-string">"static"</span>)))))))

</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-orgb1d8a4d" class="outline-2">
<h2 id="orgb1d8a4d"><span class="section-number-2">20</span> Custom functions</h2>
<div class="outline-text-2" id="text-20">
<p>
Simple bookmarks management
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span class="org-keyword">defvar</span> <span class="org-variable-name">my/bookmarks</span> '())

(<span class="org-keyword">defun</span> <span class="org-function-name">my/bookmark-switch</span> ()
  <span class="org-doc">"Switch to selected bookmark."</span>
  (<span class="org-keyword">interactive</span>)
  (<span class="org-keyword">let*</span> ((options (mapcar 'car my/bookmarks))
         (selected (completing-read <span class="org-string">"Pick buffer: "</span> options))
         (selected-buffer (cdr (assoc selected my/bookmarks))))
    (<span class="org-keyword">when</span> selected-buffer

      (switch-to-buffer selected-buffer))))

(<span class="org-keyword">defun</span> <span class="org-function-name">my/add-bookmark</span> ()
  <span class="org-doc">"Add current buffer to bookmark list."</span>
  (<span class="org-keyword">interactive</span>)
  (<span class="org-keyword">setf</span> (alist-get (buffer-name) my/bookmarks ) (current-buffer))
  (message <span class="org-string">"%s added to bookmarks"</span> (buffer-name)))
</pre>
</div>

<p>
Manage window configurations, allows to save a "snapshot" of the current windows configuration. Also allows to restore a saved "snapshot".
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">
(<span class="org-keyword">defvar</span> <span class="org-variable-name">my/window-snapshots</span> '())

(<span class="org-keyword">defun</span> <span class="org-function-name">my/save-window-snapshot</span> ()
  <span class="org-doc">"Save the current window configuration into `window-snapshots` alist."</span>
  (<span class="org-keyword">interactive</span>)
  (<span class="org-keyword">let</span> ((key (read-string <span class="org-string">"Enter a name for the snapshot: "</span>)))
    (<span class="org-keyword">setf</span> (alist-get key my/window-snapshots) (current-window-configuration))
    (message <span class="org-string">"%s window snapshot saved!"</span> key)))

(<span class="org-keyword">defun</span> <span class="org-function-name">my/get-window-snapshot</span> (key)
  <span class="org-doc">"Given a KEY return the saved value in `window-snapshots` alist."</span>
  (<span class="org-keyword">let</span> ((value (assoc key my/window-snapshots)))
    (cdr value)))

(<span class="org-keyword">defun</span> <span class="org-function-name">my/restore-window-snapshot</span> ()
  <span class="org-doc">"Restore a window snapshot from the window-snapshots alist."</span>
  (<span class="org-keyword">interactive</span>)
  (<span class="org-keyword">let*</span> ((snapshot-name (completing-read <span class="org-string">"Choose snapshot: "</span> (mapcar #'car my/window-snapshots)))
         (snapshot (my/get-window-snapshot snapshot-name)))
    (<span class="org-keyword">if</span> snapshot
        (set-window-configuration snapshot)
      (message <span class="org-string">"Snapshot %s not found"</span> snapshot-name))))

</pre>
</div>

<p>
Manipulate frame font height.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">
(<span class="org-keyword">defun</span> <span class="org-function-name">my/change-font-height</span> (delta)
  <span class="org-doc">"Use DELTA to increase/decrease the frame font height."</span>
  (<span class="org-keyword">let*</span> ((current-height (face-attribute 'default <span class="org-builtin">:height</span>))
         (new-height (+ current-height delta)))
    (set-face-attribute 'default (selected-frame) <span class="org-builtin">:height</span> new-height)))

(<span class="org-keyword">defun</span> <span class="org-function-name">my/decrease-font-height</span> ()
  <span class="org-doc">"Decrease font height by 10."</span>
  (<span class="org-keyword">interactive</span>)
  (my/change-font-height -10))

(<span class="org-keyword">defun</span> <span class="org-function-name">my/increase-font-height</span> ()
  <span class="org-doc">"Increase font height by 10."</span>
  (<span class="org-keyword">interactive</span>)
  (my/change-font-height +10))

</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">
(<span class="org-keyword">defun</span> <span class="org-function-name">my/find-file-in-project</span> ()
  <span class="org-doc">"Custom find file function."</span>
  (<span class="org-keyword">interactive</span>)
  (<span class="org-keyword">if</span> (my/project-p)
      (project-find-file)
    (call-interactively #'find-file)))

(<span class="org-keyword">defun</span> <span class="org-function-name">my/fold-buffer-when-is-too-big</span> (max-lines)
  <span class="org-doc">"Fold buffer is max lines if grater than as MAX-LINES."</span>
  (<span class="org-keyword">if</span> (&gt; (count-lines (point-min) (point-max)) max-lines)
      (hs-hide-all)))

(<span class="org-keyword">defun</span> <span class="org-function-name">my/toggle-maximize</span> ()
  <span class="org-doc">"Toggle maximization of current window."</span>
  (<span class="org-keyword">interactive</span>)
  (<span class="org-keyword">let</span> ((register ?w))
    (<span class="org-keyword">if</span> (eq (get-register register) nil)
        (<span class="org-keyword">progn</span>
          (set-register register (current-window-configuration))
          (delete-other-windows))
      (<span class="org-keyword">progn</span>
        (set-window-configuration (get-register register))
        (set-register register nil)))))

(<span class="org-keyword">defun</span> <span class="org-function-name">my/venv-workon</span> (name)
  <span class="org-doc">"Active virtualenv NAME only is not setup yet."</span>
  (<span class="org-keyword">unless</span> pyvenv-virtual-env
    (pyvenv-workon name)))

(<span class="org-keyword">defun</span> <span class="org-function-name">my/config-file</span> ()
  <span class="org-doc">"Open config file."</span>
  (<span class="org-keyword">interactive</span>)
  (find-file (expand-file-name <span class="org-string">"~/.emacs.d/bootstrap.org"</span>)))

(<span class="org-keyword">defun</span> <span class="org-function-name">my/toggle-spanish-characters</span> ()
  <span class="org-doc">"Enable/disable alt key to allow insert spanish characters."</span>
  (<span class="org-keyword">interactive</span>)
  (<span class="org-keyword">if</span> (eq ns-alternate-modifier 'meta)
      (<span class="org-keyword">setq</span> ns-alternate-modifier nil)
    (<span class="org-keyword">setq</span> ns-alternate-modifier 'meta)))

(<span class="org-keyword">defun</span> <span class="org-function-name">my/change-font-size</span>()
  <span class="org-doc">"Change frame font size."</span>
  (<span class="org-keyword">interactive</span>)
  (<span class="org-keyword">let*</span> ((size (read-number <span class="org-string">"New size: "</span>))
         (font (format <span class="org-string">"%s %d"</span> my/font-family size)))
    (set-frame-font font)))
</pre>
</div>

<p>
Function to extract clocks from org buffer and filter them by month
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">
(<span class="org-keyword">defun</span> <span class="org-function-name">my/collect-clocks</span> ()
  <span class="org-doc">"Collect all the clocks of current buffer."</span>
  (org-element-map (org-element-parse-buffer) 'clock #'(lambda (clock) clock)))

(<span class="org-keyword">defun</span> <span class="org-function-name">my/filter-clocks-by-month</span> (clocks month)
  <span class="org-doc">"Filter CLOCKS using MONTH value."</span>
  (seq-filter #'(lambda (clock)
                  (eq (org-element-property <span class="org-builtin">:month-end</span> (org-element-property <span class="org-builtin">:value</span> clock)) month)) <span class="org-warning">clocks))</span>

(<span class="org-keyword">defun</span> <span class="org-function-name">my/org-filter-clocks-report</span> ()
  <span class="org-doc">"Create a buffer with the tasks filtered by month."</span>
  (<span class="org-keyword">interactive</span>)
  (<span class="org-keyword">let*</span> ((month (read-number <span class="org-string">"Insert month: "</span>))
         (clocks (my/collect-clocks))
         (filtered-clocks (my/filter-clocks-by-month clocks month))
         (buffer (get-buffer-create <span class="org-string">"*clocks report*"</span>)))
    (switch-to-buffer buffer)
    (org-mode)
    (insert <span class="org-string">"* Report\n"</span>)
    (seq-map #'(lambda (clock)
                 (insert (format <span class="org-string">"CLOCK: %s\n"</span> (org-element-property <span class="org-builtin">:raw-value</span> (org-element-property <span class="org-builtin">:value</span> clock))))) <span class="org-warning">filtered-clocks)</span>
    (org-clock-display)))

</pre>
</div>

<p>
Copy absolute and relative path to clipboard
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">
(<span class="org-keyword">defun</span> <span class="org-function-name">my/copy-abs-path</span> ()
  <span class="org-doc">"Copy absolute path of the buffer to clipboard"</span>
  (<span class="org-keyword">interactive</span>)
  (<span class="org-keyword">if</span> buffer-file-name
      (<span class="org-keyword">progn</span>
        (kill-new buffer-file-name)
        (message (format <span class="org-string">"%s copied to clipboard"</span> buffer-file-name)))
    (message <span class="org-string">"File not saved yet"</span>)))

(<span class="org-keyword">defun</span> <span class="org-function-name">my/copy-relative-path</span> ()
  <span class="org-doc">"Copy relative path of the buffer to clipboard"</span>
  (<span class="org-keyword">interactive</span>)
  (<span class="org-keyword">if</span> (<span class="org-keyword">and</span> (my/project-p) buffer-file-name)
      (<span class="org-keyword">let</span> ((path (file-relative-name buffer-file-name (my/project-root))))
        (kill-new path)
        (message (format <span class="org-string">"%s copied to clipboard"</span> path)))
    (message <span class="org-string">"File not saved yet or not inside project"</span>)))

</pre>
</div>

<p>
Create a temp file with the current buffer content and render it with <code>eww</code>.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">
(<span class="org-keyword">defun</span> <span class="org-function-name">my/preview-buffer-in-eww</span> ()
  <span class="org-doc">"Preview buffer content in EWW."</span>
  (<span class="org-keyword">interactive</span>)
  (<span class="org-keyword">let*</span> ((temp-file (make-temp-name (temporary-file-directory)))
         (path (concat temp-file <span class="org-string">".html"</span>)))
    (write-file path)
    (kill-buffer)
    (eww-open-file path)))

(<span class="org-keyword">defun</span> <span class="org-function-name">my/preview-buffer-in-xwidget-browser</span> ()
  <span class="org-doc">"Preview buffer content in EWW."</span>
  (<span class="org-keyword">interactive</span>)
  (<span class="org-keyword">let*</span> ((temp-file (make-temp-name (temporary-file-directory)))
         (path (concat temp-file <span class="org-string">".html"</span>)))
    (write-file path)
    (kill-buffer)
    (xwidget-webkit-browse-url (format <span class="org-string">"file://%s"</span> path))))
</pre>
</div>

<p>
Resize window: allow create a "resize mode" and use hjkl to increase/decrease width/height of the current window
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">
(<span class="org-keyword">defun</span> <span class="org-function-name">my/resize-window</span> ()
  <span class="org-doc">"Resize window using j k h l keys."</span>
  (<span class="org-keyword">interactive</span>)
  (<span class="org-keyword">let</span> ((keys-map '((?h . evil-window-decrease-width)
                    (?j . evil-window-decrease-height)
                    (?k . evil-window-increase-height)
                    (?l . evil-window-increase-width)))
        (overlay (make-overlay (point-min) (point-max) (window-buffer))))
    (<span class="org-keyword">let</span> ((is-reading t))
      (overlay-put overlay 'face '((t (<span class="org-builtin">:foreground</span> <span class="org-string">"gray40"</span>))))
      (<span class="org-keyword">while</span> is-reading
        (<span class="org-keyword">let</span> ((action (alist-get (read-key) keys-map)))
          (<span class="org-keyword">if</span> action
              (apply action '(1))
            (<span class="org-keyword">setq</span> is-reading nil)
            (delete-overlay overlay)))))))

</pre>
</div>

<p>
Kill the current buffer and delete the related file
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">
(<span class="org-keyword">defun</span> <span class="org-function-name">my/delete-close-file</span> ()
  <span class="org-doc">"Delete the current file and kill its buffer."</span>
  (<span class="org-keyword">interactive</span>)
  (<span class="org-keyword">when</span> buffer-file-name
    (delete-file buffer-file-name)
    (kill-buffer)))

</pre>
</div>

<p>
Generate daily report for work.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">
(<span class="org-keyword">defun</span> <span class="org-function-name">my/daily-template</span> ()
  <span class="org-doc">"Create a markdown formatter daily report."</span>
  (<span class="org-keyword">interactive</span>)
  (<span class="org-keyword">let*</span> ((day (format-time-string <span class="org-string">"%A"</span>))
         (prev-label-text (<span class="org-keyword">if</span> (equal day <span class="org-string">"Monday"</span>) <span class="org-string">"Viernes"</span> <span class="org-string">"Ayer"</span>))
         (prev (read-string (concat prev-label-text <span class="org-string">": "</span>)))
         (today (read-string <span class="org-string">"Hoy: "</span>))
         (problems (read-string <span class="org-string">"Impedimentos: "</span>)))
    (kill-new (format <span class="org-string">"*%s*: %s\n*Hoy*: %s\n*Impedimentos*: %s"</span> prev-label-text prev today problems))))

</pre>
</div>

<p>
Copy json text from clipboard in a new buffer and format it
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span class="org-keyword">defun</span> <span class="org-function-name">my/copy-and-format-json-from-clipboard</span> ()
  <span class="org-doc">"Copy content from clipboard and format it in a new buffer."</span>
  (<span class="org-keyword">interactive</span>)
  (<span class="org-keyword">let</span> ((buffer (generate-new-buffer <span class="org-string">"tmp.json"</span>)))
    (<span class="org-keyword">with-current-buffer</span> buffer
      (yank)
      (jsonian-mode)
      (json-pretty-print-buffer))
    (set-window-buffer nil buffer)))
</pre>
</div>
</div>

<div id="outline-container-org934c0d4" class="outline-3">
<h3 id="org934c0d4"><span class="section-number-3">20.1</span> MacOS</h3>
<div class="outline-text-3" id="text-20-1">
<p>
Functions to open Finder using current file or current project.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">
(<span class="org-keyword">defun</span> <span class="org-function-name">my/open-finder-at</span> (path)
  <span class="org-doc">"Open Finder app with the given PATH."</span>
  (<span class="org-keyword">let*</span> ((finder (executable-find <span class="org-string">"open"</span>))
         (command (format <span class="org-string">"%s %s"</span> finder path)))
    (shell-command command)))

(<span class="org-keyword">defun</span> <span class="org-function-name">my/open-project-in-finder</span> ()
  <span class="org-doc">"Open current project in Finder app."</span>
  (<span class="org-keyword">interactive</span>)
  (<span class="org-keyword">if</span> (my/project-p)
      (my/open-finder-at (my/project-root))
    (message <span class="org-string">"There is no active project."</span>)))

(<span class="org-keyword">defun</span> <span class="org-function-name">my/open-current-file-in-finder</span> ()
  <span class="org-doc">"Open current file in Finder."</span>
  (<span class="org-keyword">interactive</span>)
  (<span class="org-keyword">let</span> ((file (buffer-file-name)))
    (<span class="org-keyword">if</span> file
        (my/open-finder-at (file-name-directory file))
      (message <span class="org-string">"Buffer has not been saved yet!"</span>))))

</pre>
</div>

<p>
Open current file with an macOS app. Installed macOS apps will be listed using <code>completing-read</code>
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">
(<span class="org-keyword">defun</span> <span class="org-function-name">my/macos-open-file-with</span> ()
  <span class="org-doc">"Open current file with and macOS installed app."</span>
  (<span class="org-keyword">interactive</span>)
  (<span class="org-keyword">let*</span> ((apps-list (directory-files <span class="org-string">"/Applications"</span> nil <span class="org-string">"\\.app$"</span>))
         (selected-app (completing-read <span class="org-string">"Choose an application: "</span> apps-list)))
    (shell-command (format <span class="org-string">"open %s -a '%s'"</span> (buffer-file-name) selected-app))))

</pre>
</div>

<p>
Open the current file with macOS <code>open</code> command. This will open the file with the default app configured for the type of file.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">
(<span class="org-keyword">defun</span> <span class="org-function-name">my/macos-open-current-file</span> ()
  (<span class="org-keyword">interactive</span>)
  (shell-command (format <span class="org-string">"open %s"</span> (buffer-file-name))))

</pre>
</div>

<p>
Save image from clipboard to path.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">
(<span class="org-keyword">defun</span> <span class="org-function-name">my/save-image-from-clipboard</span> ()
  <span class="org-doc">"Save image from clipboard to the given path."</span>
  (<span class="org-keyword">interactive</span>)
  (<span class="org-keyword">unless</span> (executable-find <span class="org-string">"pngpaste"</span>)
    (<span class="org-warning">user-error</span> <span class="org-string">"Install pngpaste to continue"</span>))
  (<span class="org-keyword">let*</span> ((path (read-file-name <span class="org-string">""</span>))
         (command (format <span class="org-string">"pngpaste %s"</span> path)))
    (shell-command command)
    (kill-new path)))

</pre>
</div>
</div>
</div>
</div>
</div>
<div id="postamble" class="status">
<p class="author">Author: Erick Navarro</p>
<p class="date">Created: 2023-09-08 Fri 14:08</p>
<p class="validation"><a href="http://validator.w3.org/check?uri=referer">Validate</a></p>
</div>
</body>
</html>
