<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
<head>
<!-- 2024-07-14 Sun 22:43 -->
<meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Emacs config</title>
<meta name="generator" content="Org mode" />
<meta name="author" content="Erick Navarro" />
<link rel="stylesheet" type="text/css" href="https://fniessen.github.io/org-html-themes/src/readtheorg_theme/css/htmlize.css"/>
<link rel="stylesheet" type="text/css" href="https://fniessen.github.io/org-html-themes/src/readtheorg_theme/css/readtheorg.css"/>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.4/js/bootstrap.min.js"></script>
<script type="text/javascript" src="https://fniessen.github.io/org-html-themes/src/lib/js/jquery.stickytableheaders.min.js"></script>
<script type="text/javascript" src="https://fniessen.github.io/org-html-themes/src/readtheorg_theme/js/readtheorg.js"></script>
<script type="text/javascript">
/*
@licstart  The following is the entire license notice for the
JavaScript code in this tag.

Copyright (C) 2012-2020 Free Software Foundation, Inc.

The JavaScript code in this tag is free software: you can
redistribute it and/or modify it under the terms of the GNU
General Public License (GNU GPL) as published by the Free Software
Foundation, either version 3 of the License, or (at your option)
any later version.  The code is distributed WITHOUT ANY WARRANTY;
without even the implied warranty of MERCHANTABILITY or FITNESS
FOR A PARTICULAR PURPOSE.  See the GNU GPL for more details.

As additional permission under GNU GPL version 3 section 7, you
may distribute non-source (e.g., minimized or compacted) forms of
that code without the copy of the GNU GPL normally required by
section 4, provided you include this license notice and a URL
through which recipients can access the Corresponding Source.


@licend  The above is the entire license notice
for the JavaScript code in this tag.
*/
<!--/*--><![CDATA[/*><!--*/
 function CodeHighlightOn(elem, id)
 {
   var target = document.getElementById(id);
   if(null != target) {
     elem.cacheClassElem = elem.className;
     elem.cacheClassTarget = target.className;
     target.className = "code-highlighted";
     elem.className   = "code-highlighted";
   }
 }
 function CodeHighlightOff(elem, id)
 {
   var target = document.getElementById(id);
   if(elem.cacheClassElem)
     elem.className = elem.cacheClassElem;
   if(elem.cacheClassTarget)
     target.className = elem.cacheClassTarget;
 }
/*]]>*///-->
</script>
</head>
<body>
<div id="content">
<h1 class="title">Emacs config</h1>
<div id="table-of-contents">
<h2>Table of Contents</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="#org154788f">Vanilla Emacs setup</a>
<ul>
<li><a href="#org0497e0b">Ansi term</a></li>
<li><a href="#orgc5fa694">xref</a></li>
<li><a href="#org8020632">Occur</a></li>
<li><a href="#orgcb5e0c1">Popper.el</a></li>
<li><a href="#orgbf24dbf">Compilation</a></li>
<li><a href="#org1d9a772">Narrowing</a></li>
<li><a href="#orgd9db9d5">Ediff</a></li>
</ul>
</li>
<li><a href="#org3e01ee5">Theme and styles</a>
<ul>
<li><a href="#org15a1148">Doom theme</a></li>
<li><a href="#org0fa2e22">Doom modeline</a></li>
<li><a href="#org2aeaa9e">Emoji support</a></li>
</ul>
</li>
<li><a href="#org1888196">Dired</a>
<ul>
<li><a href="#org4fe916a">Nerd icons dired</a></li>
<li><a href="#org5f447db">Dired subtree</a></li>
</ul>
</li>
<li><a href="#org3cbaca4">Editor enhancements</a>
<ul>
<li><a href="#org7d375db">Whitespace</a></li>
<li><a href="#org3bf6066">Deactivate extended region in visual mode</a></li>
<li><a href="#org1ba9ed9">Dark and transparent title bar in macOS</a></li>
<li><a href="#orgd1e8752">Share clipoard with OS</a></li>
<li><a href="#org9d436b3">Highlight TODO, FIXME, etc</a></li>
<li><a href="#org2f02a79">Auto fill mode</a></li>
<li><a href="#org2fdd259">Load PATH environment</a></li>
<li><a href="#org7be5aea">Editorconfig</a></li>
<li><a href="#orgc5cd847">Snippets</a></li>
<li><a href="#org221b86d">Wakatime</a></li>
<li><a href="#orgd8b2b63">Highlight thing</a></li>
<li><a href="#org34de15a">Various changes</a></li>
<li><a href="#orgdbf0da3">Reformatter</a></li>
<li><a href="#org7ef704b">Hydra for major modes</a></li>
<li><a href="#org64a3dcb">Vterm</a></li>
<li><a href="#org892caac">Toggle terminal</a></li>
<li><a href="#orga7e2df3">iSpell</a></li>
<li><a href="#org1a0ab88">Tree sitter</a></li>
</ul>
</li>
<li><a href="#org0e3087e">Evil</a></li>
<li><a href="#org43e9bad">IA models integration</a></li>
<li><a href="#org9bde979">Utils</a>
<ul>
<li><a href="#orgb918c10">Which-key</a></li>
<li><a href="#org30ae0fe">Auto pair</a></li>
<li><a href="#orge22926a">Restclient</a></li>
<li><a href="#org07f290c">Rainbow delimiters</a></li>
<li><a href="#orged5a6a9">XML formatter</a></li>
<li><a href="#org803288e">SQL formatter</a></li>
<li><a href="#org6055c6c">SQL linter using sqlfluff</a></li>
</ul>
</li>
<li><a href="#orgb7aa2ae">Common packages</a>
<ul>
<li><a href="#orgf8def24">Company</a></li>
<li><a href="#orgd48fba8">Flymake</a></li>
<li><a href="#orgceb3241">Direnv</a></li>
<li><a href="#orgae302e3">Cloak mode</a></li>
<li><a href="#orgefd7ac7">Avy</a></li>
<li><a href="#orga061028">perspective.el</a></li>
<li><a href="#org591684c">Project.el</a></li>
<li><a href="#org47c5aed">Completion</a></li>
</ul>
</li>
<li><a href="#org39b6e1e">Emacs process list</a></li>
<li><a href="#org6584023">Git backup</a></li>
<li><a href="#org76f5d54">Meme</a></li>
<li><a href="#org932ed98">Orgmode</a>
<ul>
<li><a href="#org2bcb428">Org tree slide</a></li>
</ul>
</li>
<li><a href="#org551f9f3">Denote</a></li>
<li><a href="#org017b2da">Latex</a></li>
<li><a href="#orgbc9a48a">Git</a>
<ul>
<li><a href="#orga08682d">Git-link</a></li>
<li><a href="#orga766205">Git modes</a></li>
<li><a href="#orgb4a3913">Magit</a></li>
<li><a href="#orgd283344">Magit delta</a></li>
<li><a href="#orgf42b619">Forge</a></li>
<li><a href="#org63de264">Git diff-hl</a></li>
<li><a href="#orga138936">Timemachine</a></li>
<li><a href="#orgbd34a5b">Gist</a></li>
<li><a href="#orge005697">Linkode</a></li>
</ul>
</li>
<li><a href="#orgb715492">Web</a>
<ul>
<li><a href="#org5dc7dd5">Web mode</a></li>
<li><a href="#orgfaed52c">Emmet</a></li>
<li><a href="#org22e569d">Sass</a></li>
<li><a href="#orgd7cb497">Rainbow</a></li>
</ul>
</li>
<li><a href="#orga41a006">Telegram</a></li>
<li><a href="#orgd72dc62">Miscellaneous</a></li>
<li><a href="#org0bf77c1">LSP</a></li>
<li><a href="#org7f9e5b6">Programming languages</a>
<ul>
<li><a href="#orga437e46">Shell scripts</a></li>
<li><a href="#org6ca0d61">C</a></li>
<li><a href="#org4719b8c">Python</a></li>
<li><a href="#org74c7a76">Erlang</a></li>
<li><a href="#org3db802f">Elixir</a>
<ul>
<li><a href="#orgf1778e7">LSP server building</a></li>
<li><a href="#orgd87de67">Config</a></li>
</ul>
</li>
<li><a href="#org523c53e">LFE</a></li>
<li><a href="#orgd7d37ad">Elm</a></li>
<li><a href="#org6ec2079">Haskell</a></li>
<li><a href="#org87cdd2d">Lua</a></li>
<li><a href="#org437e31c">Javascript</a>
<ul>
<li><a href="#orgca1894a">Formattter</a></li>
</ul>
</li>
<li><a href="#org0129c27">Typescript</a></li>
<li><a href="#org27cc10e">Rust</a></li>
<li><a href="#org90e088b">Golang</a></li>
<li><a href="#org4eb4537">Common lisp</a></li>
<li><a href="#org0ae709c">Clojure</a></li>
<li><a href="#org9fd60a3">Emacs lisp</a></li>
<li><a href="#org3ea631a">OCaml</a></li>
<li><a href="#org658ce14">Dart</a>
<ul>
<li><a href="#orgc868e99">Flutter</a></li>
</ul>
</li>
<li><a href="#orgc2efaca">F-sharp</a></li>
</ul>
</li>
<li><a href="#orgbe279d0">Writing</a>
<ul>
<li><a href="#orgde5dd7b">Hugo</a></li>
</ul>
</li>
<li><a href="#orgc4e4813">Custom functions</a>
<ul>
<li><a href="#org559f475">MacOS</a></li>
</ul>
</li>
</ul>
</div>
</div>

<div id="outline-container-org154788f" class="outline-2">
<h2 id="org154788f">Vanilla Emacs setup</h2>
<div class="outline-text-2" id="text-org154788f">
<p>
This is required to enable lexical binding in the resulting <code>.el</code> file, which will be used by emacs at startup.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp"><span class="org-comment-delimiter">;; </span><span class="org-comment">-*- lexical-binding: t -*-</span>
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span class="org-keyword">setq</span> inhibit-startup-message t)
(<span class="org-keyword">setq</span> default-directory (expand-file-name <span class="org-string">"~/"</span>))

<span class="org-comment-delimiter">;; </span><span class="org-comment">Default font-family, this will used in all the function that manipulates font settings</span>
(<span class="org-keyword">defvar</span> <span class="org-variable-name">my/font-family</span> <span class="org-string">"JetBrainsMono Nerd Font"</span>)

<span class="org-comment-delimiter">;; </span><span class="org-comment">Change backups directory to emacs folder</span>
<span class="org-comment-delimiter">;; </span><span class="org-comment">this avoid to save backup files in the same directory of the original files</span>
(<span class="org-keyword">setq</span> backup-directory-alist `((<span class="org-string">"."</span> . ,(concat user-emacs-directory
                                               <span class="org-string">"backups"</span>))))

<span class="org-comment-delimiter">;; </span><span class="org-comment">Revert dired and other buffers when there are changes on disk</span>
(<span class="org-keyword">setq</span> global-auto-revert-non-file-buffers t)

<span class="org-comment-delimiter">;; </span><span class="org-comment">Hide the bell in the center of screen</span>
(<span class="org-keyword">setq</span> ring-bell-function 'ignore)
(column-number-mode t)
(global-hl-line-mode 1)

(<span class="org-keyword">when</span> (member my/font-family (font-family-list))
  (set-face-attribute 'default nil <span class="org-builtin">:font</span> (format <span class="org-string">"%s 13"</span> my/font-family)))

(global-set-key (kbd <span class="org-string">"C-x -"</span>) 'my/decrease-font-height)
(global-set-key (kbd <span class="org-string">"C-x ="</span>) 'my/increase-font-height)
(global-set-key (kbd <span class="org-string">"C-x +"</span>) 'my/increase-font-height)

<span class="org-comment-delimiter">;; </span><span class="org-comment">Navigate through buffers</span>
(global-set-key (kbd <span class="org-string">"M-["</span>) 'previous-buffer)
(global-set-key (kbd <span class="org-string">"M-]"</span>) 'next-buffer)

<span class="org-comment-delimiter">;; </span><span class="org-comment">Fix unicode errors</span>
(setenv <span class="org-string">"LANG"</span> <span class="org-string">"en_US.UTF-8"</span>)
(setenv <span class="org-string">"LC_ALL"</span> <span class="org-string">"en_US.UTF-8"</span>)
(setenv <span class="org-string">"LC_CTYPE"</span> <span class="org-string">"en_US.UTF-8"</span>)

<span class="org-comment-delimiter">;; </span><span class="org-comment">Fix size of scroll</span>
(<span class="org-keyword">setq</span> scroll-step 1
      scroll-conservatively  10000)

<span class="org-comment-delimiter">;; </span><span class="org-comment">Show a marker when the line has empty characters at the end</span>
(<span class="org-keyword">setq-default</span> show-trailing-whitespace t)

<span class="org-comment-delimiter">;; </span><span class="org-comment">disable `</span><span class="org-comment"><span class="org-constant">show-trailing-whitespace</span></span><span class="org-comment">' for modes based in comint-mode</span>
<span class="org-comment-delimiter">;; </span><span class="org-comment">make prompt readonly</span>
(add-hook 'comint-mode-hook #'(lambda ()
                                (<span class="org-keyword">setq-local</span> show-trailing-whitespace nil)
                                (<span class="org-keyword">setq-local</span> comint-prompt-read-only t)))

<span class="org-comment-delimiter">;; </span><span class="org-comment">Avoid close emacs by mistake</span>
(global-unset-key (kbd <span class="org-string">"C-x C-c"</span>))

(<span class="org-keyword">defalias</span> '<span class="org-function-name">yes-or-no-p</span> 'y-or-n-p)
(<span class="org-keyword">defalias</span> '<span class="org-function-name">run-elisp</span> 'ielm)

<span class="org-comment-delimiter">;; </span><span class="org-comment">place custom code generated for emacs in a separate file</span>
(<span class="org-keyword">defconst</span> <span class="org-variable-name">custom-file</span> (expand-file-name <span class="org-string">".customize.el"</span> user-emacs-directory))
(load custom-file <span class="org-builtin">:noerror</span>)
</pre>
</div>

<p>
Show a message with emacs startup time
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span class="org-keyword">defun</span> <span class="org-function-name">my/display-startup-time</span> ()
  (message <span class="org-string">"&#128640; Emacs loaded in %s with %d garbage collections."</span>
           (float-time (time-subtract after-init-time before-init-time))
           gcs-done))

(add-hook 'emacs-startup-hook #'my/display-startup-time)
</pre>
</div>

<p>
Setup ligatures, by default it has support for <code>JetBrainsMono</code>.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package ligature
  <span class="org-builtin">:ensure</span> t
  <span class="org-builtin">:config</span>
  <span class="org-comment-delimiter">;; </span><span class="org-comment">Enable ligatures in programming modes</span>
  (ligature-set-ligatures 'prog-mode '(<span class="org-string">"www"</span> <span class="org-string">"**"</span> <span class="org-string">"***"</span> <span class="org-string">"**/"</span> <span class="org-string">"*&gt;"</span> <span class="org-string">"*/"</span> <span class="org-string">"\\\\"</span> <span class="org-string">"\\\\\\"</span> <span class="org-string">"{-"</span> <span class="org-string">"::"</span>
                                       <span class="org-string">":::"</span> <span class="org-string">":="</span> <span class="org-string">"!!"</span> <span class="org-string">"!="</span> <span class="org-string">"!=="</span> <span class="org-string">"-}"</span> <span class="org-string">"----"</span> <span class="org-string">"--&gt;"</span> <span class="org-string">"-&gt;"</span> <span class="org-string">"-&gt;&gt;"</span>
                                       <span class="org-string">"-&lt;"</span> <span class="org-string">"-&lt;&lt;"</span> <span class="org-string">"-~"</span> <span class="org-string">"#{"</span> <span class="org-string">"#["</span> <span class="org-string">"##"</span> <span class="org-string">"###"</span> <span class="org-string">"####"</span> <span class="org-string">"#("</span> <span class="org-string">"#?"</span> <span class="org-string">"#_"</span>
                                       <span class="org-string">"#_("</span> <span class="org-string">".-"</span> <span class="org-string">".="</span> <span class="org-string">".."</span> <span class="org-string">"..&lt;"</span> <span class="org-string">"..."</span> <span class="org-string">"?="</span> <span class="org-string">"??"</span> <span class="org-string">";;"</span> <span class="org-string">"/*"</span> <span class="org-string">"/**"</span>
                                       <span class="org-string">"/="</span> <span class="org-string">"/=="</span> <span class="org-string">"/&gt;"</span> <span class="org-string">"//"</span> <span class="org-string">"///"</span> <span class="org-string">"&amp;&amp;"</span> <span class="org-string">"||"</span> <span class="org-string">"||="</span> <span class="org-string">"|="</span> <span class="org-string">"|&gt;"</span> <span class="org-string">"^="</span> <span class="org-string">"$&gt;"</span>
                                       <span class="org-string">"++"</span> <span class="org-string">"+++"</span> <span class="org-string">"+&gt;"</span> <span class="org-string">"=:="</span> <span class="org-string">"=="</span> <span class="org-string">"==="</span> <span class="org-string">"==&gt;"</span> <span class="org-string">"=&gt;"</span> <span class="org-string">"=&gt;&gt;"</span> <span class="org-string">"&lt;="</span>
                                       <span class="org-string">"=&lt;&lt;"</span> <span class="org-string">"=/="</span> <span class="org-string">"&gt;-"</span> <span class="org-string">"&gt;="</span> <span class="org-string">"&gt;=&gt;"</span> <span class="org-string">"&gt;&gt;"</span> <span class="org-string">"&gt;&gt;-"</span> <span class="org-string">"&gt;&gt;="</span> <span class="org-string">"&gt;&gt;&gt;"</span> <span class="org-string">"&lt;*"</span>
                                       <span class="org-string">"&lt;*&gt;"</span> <span class="org-string">"&lt;|"</span> <span class="org-string">"&lt;|&gt;"</span> <span class="org-string">"&lt;$"</span> <span class="org-string">"&lt;$&gt;"</span> <span class="org-string">"&lt;!--"</span> <span class="org-string">"&lt;-"</span> <span class="org-string">"&lt;--"</span> <span class="org-string">"&lt;-&gt;"</span> <span class="org-string">"&lt;+"</span>
                                       <span class="org-string">"&lt;+&gt;"</span> <span class="org-string">"&lt;="</span> <span class="org-string">"&lt;=="</span> <span class="org-string">"&lt;=&gt;"</span> <span class="org-string">"&lt;=&lt;"</span> <span class="org-string">"&lt;&gt;"</span> <span class="org-string">"&lt;&lt;"</span> <span class="org-string">"&lt;&lt;-"</span> <span class="org-string">"&lt;&lt;="</span> <span class="org-string">"&lt;&lt;&lt;"</span>
                                       <span class="org-string">"&lt;~"</span> <span class="org-string">"&lt;~~"</span> <span class="org-string">"&lt;/"</span> <span class="org-string">"&lt;/&gt;"</span> <span class="org-string">"~@"</span> <span class="org-string">"~-"</span> <span class="org-string">"~&gt;"</span> <span class="org-string">"~~"</span> <span class="org-string">"~~&gt;"</span> <span class="org-string">"%%"</span>))
  (global-ligature-mode 't))
</pre>
</div>

<p>
Adjust font size to screen resolution, increase font size for 4K screens
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span class="org-keyword">when</span> (<span class="org-keyword">and</span> (display-graphic-p) (&gt;= (x-display-pixel-width) 3840))
  (set-face-attribute 'default nil <span class="org-builtin">:font</span> (format <span class="org-string">"%s 14"</span> my/font-family)))
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span class="org-keyword">define-minor-mode</span> <span class="org-function-name">big-font-mode</span>
  <span class="org-doc">"Switch between a regular font size and a presentation font size."</span>
  <span class="org-builtin">:init-value</span> nil
  <span class="org-builtin">:global</span> t
  (<span class="org-keyword">if</span> big-font-mode
      (<span class="org-keyword">progn</span>
        <span class="org-comment-delimiter">;; </span><span class="org-comment">save current font size in a temp variable to be able to restore it</span>
        <span class="org-comment-delimiter">;; </span><span class="org-comment">after this minor mode is disabled</span>
        (<span class="org-keyword">setq</span> big-font-mode--tmp (/ (face-attribute 'default <span class="org-builtin">:height</span>) 10))
        (set-face-attribute 'default nil <span class="org-builtin">:font</span> (format <span class="org-string">"%s 26"</span> my/font-family)))
    (set-face-attribute 'default nil <span class="org-builtin">:font</span> (format <span class="org-string">"%s %d"</span> my/font-family big-font-mode--tmp))))
</pre>
</div>

<p>
Parrot mode FTW!
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span class="org-keyword">defun</span> <span class="org-function-name">my/parrot-animate-when-compile-success</span> (buffer result)
  (<span class="org-keyword">if</span> (string-match <span class="org-string">"^finished"</span> result)
      (parrot-start-animation)))

(use-package parrot
  <span class="org-builtin">:ensure</span> t
  <span class="org-builtin">:config</span>
  (parrot-mode)
  (add-hook 'before-save-hook 'parrot-start-animation)
  (add-to-list 'compilation-finish-functions 'my/parrot-animate-when-compile-success))
</pre>
</div>

<p>
Open scratch buffer
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span class="org-keyword">defun</span> <span class="org-function-name">my/scratch-buffer</span>()
  <span class="org-doc">"Switch to scratch buffer."</span>
  (<span class="org-keyword">interactive</span>)
  (<span class="org-keyword">let</span> ((buffer (get-buffer <span class="org-string">"*scratch*"</span>)))
    (<span class="org-keyword">if</span> buffer
        (switch-to-buffer buffer)
      (switch-to-buffer (get-buffer-create <span class="org-string">"*scratch*"</span>))
      (insert (substitute-command-keys initial-scratch-message)))
    (lisp-interaction-mode)))
</pre>
</div>
</div>

<div id="outline-container-org0497e0b" class="outline-3">
<h3 id="org0497e0b">Ansi term</h3>
<div class="outline-text-3" id="text-org0497e0b">
<p>
For some reason ansi-term doesn't respect the global keybinding for <code>M-]</code> so this have to be setup in <code>term-raw-map</code> as well.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span class="org-keyword">with-eval-after-load</span> 'term
  (define-key term-raw-map (kbd <span class="org-string">"M-]"</span>) 'next-buffer))
</pre>
</div>
</div>
</div>

<div id="outline-container-orgc5fa694" class="outline-3">
<h3 id="orgc5fa694">xref</h3>
<div class="outline-text-3" id="text-orgc5fa694">
<p>
Enable evil emacs state when entering a xref buffer
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span class="org-keyword">with-eval-after-load</span> 'xref
  (add-hook 'xref-after-update-hook #'(lambda () (evil-emacs-state))))
</pre>
</div>
</div>
</div>

<div id="outline-container-org8020632" class="outline-3">
<h3 id="org8020632">Occur</h3>
<div class="outline-text-3" id="text-org8020632">
<div class="org-src-container">
<pre class="src src-emacs-lisp"><span class="org-comment-delimiter">;; </span><span class="org-comment">occur is part of replace.el file</span>
(<span class="org-keyword">with-eval-after-load</span> 'replace
  (define-key occur-mode-map (kbd <span class="org-string">"C-c C-e"</span>) 'occur-edit-mode)
  <span class="org-comment-delimiter">;; </span><span class="org-comment">this will run every time search results are shown</span>
  (<span class="org-keyword">setq</span> occur-hook #'(lambda ()
                       (window-buffer)
                       (select-window (get-buffer-window <span class="org-string">"*Occur*"</span>))
                       (evil-normal-state))))
</pre>
</div>
</div>
</div>

<div id="outline-container-orgcb5e0c1" class="outline-3">
<h3 id="orgcb5e0c1">Popper.el</h3>
<div class="outline-text-3" id="text-orgcb5e0c1">
<p>
Display some special buffers in a little window always at bottom
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package popper
  <span class="org-builtin">:ensure</span> t
  <span class="org-builtin">:init</span>
  (<span class="org-keyword">setq</span> popper-reference-buffers
        '(<span class="org-string">"\\*eldoc\\*"</span>
          help-mode))
  (popper-mode +1))
</pre>
</div>
</div>
</div>

<div id="outline-container-orgbf24dbf" class="outline-3">
<h3 id="orgbf24dbf">Compilation</h3>
<div class="outline-text-3" id="text-orgbf24dbf">
<p>
Disable <code>h</code> key-binding, this has a conflict with evil-mode left navigation key-binding.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span class="org-keyword">with-eval-after-load</span> 'compile
  <span class="org-comment-delimiter">;; </span><span class="org-comment">set cursor to follow compilation output</span>
  (<span class="org-keyword">setq</span> compilation-scroll-output t)
  <span class="org-comment-delimiter">;; </span><span class="org-comment">for elixir testing output test filename use black color which makes it ineligible</span>
  (set-face-foreground 'ansi-color-bold <span class="org-string">"magenta"</span>)
  (define-key compilation-mode-map (kbd <span class="org-string">"g"</span>) nil)
  (define-key compilation-mode-map (kbd <span class="org-string">"r"</span>) 'recompile)
  (define-key compilation-mode-map (kbd <span class="org-string">"h"</span>) nil))
</pre>
</div>

<p>
Allow to show color characters in the compilation buffer.
</p>

<p>
copied from <a href="https://stackoverflow.com/questions/3072648/cucumbers-ansi-colors-messing-up-emacs-compilation-buffer/3072831#3072831">https://stackoverflow.com/questions/3072648/cucumbers-ansi-colors-messing-up-emacs-compilation-buffer/3072831#3072831</a>
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span class="org-keyword">require</span> '<span class="org-constant">ansi-color</span>)

(<span class="org-keyword">defun</span> <span class="org-function-name">colorize-compilation-buffer</span> ()
  (<span class="org-keyword">let</span> ((inhibit-read-only t))
    (ansi-color-apply-on-region (point-min) (point-max))))

(add-hook 'compilation-filter-hook 'colorize-compilation-buffer)
</pre>
</div>

<p>
Custom function to select a base directory before running compilation. <code>M-x compile</code> always use the base directory of the buffer from where it was called as <code>default-directory</code>, this is awful when you want to run a project compilation command from a nested file buffer.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span class="org-keyword">defun</span> <span class="org-function-name">my/compile</span> ()
  <span class="org-doc">"Run compilation process but ask for a `</span><span class="org-doc"><span class="org-constant">default-directory</span></span><span class="org-doc">' before."</span>
  (<span class="org-keyword">interactive</span>)
  (<span class="org-keyword">let</span> ((default-directory (read-directory-name <span class="org-string">"Base directory: "</span> (my/project-root)))
        (cmd (read-string <span class="org-string">"Compile command: "</span>)))
    <span class="org-comment-delimiter">;; </span><span class="org-comment">we need to "export" this variable to be able to re-run `</span><span class="org-comment"><span class="org-constant">compile</span></span><span class="org-comment">' command</span>
    (<span class="org-keyword">setq</span> compile-command cmd)
    (compile compile-command)))
</pre>
</div>
</div>
</div>

<div id="outline-container-org1d9a772" class="outline-3">
<h3 id="org1d9a772">Narrowing</h3>
<div class="outline-text-3" id="text-org1d9a772">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span class="org-keyword">defun</span> <span class="org-function-name">my/toggle-narrowing</span> ()
  <span class="org-doc">"Toggle narrow on the selected region."</span>
  (<span class="org-keyword">interactive</span>)
  (<span class="org-keyword">if</span> (buffer-narrowed-p)
      (widen)
    (<span class="org-keyword">if</span> (region-active-p)
        (narrow-to-region (region-beginning) (region-end))
      (<span class="org-warning">user-error</span> <span class="org-string">"No active selection"</span>))))
</pre>
</div>
</div>
</div>

<div id="outline-container-orgd9db9d5" class="outline-3">
<h3 id="orgd9db9d5">Ediff</h3>
<div class="outline-text-3" id="text-orgd9db9d5">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span class="org-keyword">with-eval-after-load</span> 'ediff
  (<span class="org-keyword">setq</span> ediff-split-window-function 'split-window-horizontally)
  <span class="org-comment-delimiter">;; </span><span class="org-comment">put ediff buffer in a buffer at the bottom instead of in a new frame</span>
  (<span class="org-keyword">setq</span> ediff-window-setup-function 'ediff-setup-windows-plain))
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org3e01ee5" class="outline-2">
<h2 id="org3e01ee5">Theme and styles</h2>
<div class="outline-text-2" id="text-org3e01ee5">
</div>
<div id="outline-container-org15a1148" class="outline-3">
<h3 id="org15a1148">Doom theme</h3>
<div class="outline-text-3" id="text-org15a1148">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package doom-themes
  <span class="org-builtin">:ensure</span> t
  <span class="org-builtin">:config</span>
  (load-theme 'doom-badger t))
</pre>
</div>
</div>
</div>

<div id="outline-container-org0fa2e22" class="outline-3">
<h3 id="org0fa2e22">Doom modeline</h3>
<div class="outline-text-3" id="text-org0fa2e22">
<p>
Enable <code>display-battery-mode</code> after <code>doom-modeline</code> is loaded.
</p>

<p>
This is required for GitHub notifications segment
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package async
  <span class="org-builtin">:ensure</span> t)
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package doom-modeline
  <span class="org-builtin">:ensure</span> t
  <span class="org-builtin">:defer</span> t
  <span class="org-builtin">:custom</span>
  (doom-modeline-modal-icon nil)
  (doom-modeline-buffer-file-name-style 'relative-from-project)
  (doom-modeline-github t)
  (doom-modeline-github-interval (* 30 60))
  <span class="org-builtin">:hook</span>
  (after-init . doom-modeline-mode)
  (doom-modeline-mode . display-battery-mode))
</pre>
</div>
</div>
</div>

<div id="outline-container-org2aeaa9e" class="outline-3">
<h3 id="org2aeaa9e">Emoji support</h3>
<div class="outline-text-3" id="text-org2aeaa9e">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package unicode-fonts
  <span class="org-builtin">:ensure</span> t
  <span class="org-builtin">:config</span>
  (unicode-fonts-setup))
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org1888196" class="outline-2">
<h2 id="org1888196">Dired</h2>
<div class="outline-text-2" id="text-org1888196">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span class="org-keyword">with-eval-after-load</span> <span class="org-string">"dired"</span>
  (define-key dired-mode-map (kbd <span class="org-string">"C-c C-e"</span>) 'wdired-change-to-wdired-mode))
</pre>
</div>
</div>

<div id="outline-container-org4fe916a" class="outline-3">
<h3 id="org4fe916a">Nerd icons dired</h3>
<div class="outline-text-3" id="text-org4fe916a">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package nerd-icons-dired
  <span class="org-builtin">:ensure</span> t
  <span class="org-builtin">:defer</span> t
  <span class="org-builtin">:hook</span>
  (dired-mode . nerd-icons-dired-mode))
</pre>
</div>
</div>
</div>

<div id="outline-container-org5f447db" class="outline-3">
<h3 id="org5f447db">Dired subtree</h3>
<div class="outline-text-3" id="text-org5f447db">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package dired-subtree
  <span class="org-builtin">:ensure</span> t
  <span class="org-builtin">:after</span> dired
  <span class="org-builtin">:config</span>
  (define-key dired-mode-map (kbd <span class="org-string">"&lt;tab&gt;"</span>) 'dired-subtree-toggle))
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org3cbaca4" class="outline-2">
<h2 id="org3cbaca4">Editor enhancements</h2>
<div class="outline-text-2" id="text-org3cbaca4">
</div>
<div id="outline-container-org7d375db" class="outline-3">
<h3 id="org7d375db">Whitespace</h3>
<div class="outline-text-3" id="text-org7d375db">
<p>
Show special markers for tab and endline characters in <code>prog-mode</code>
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package whitespace-mode
  <span class="org-builtin">:custom</span>
  (whitespace-style '(tab-mark newline-mark))
  (whitespace-display-mappings '((newline-mark ?\n    [?&#172; ?\n]  [?$ ?\n])
                                 (tab-mark     ?\t    [?&#187; ?\t] [?\\ ?\t])))
  <span class="org-builtin">:hook</span>
  (prog-mode . whitespace-mode))
</pre>
</div>
</div>
</div>

<div id="outline-container-org3bf6066" class="outline-3">
<h3 id="org3bf6066">Deactivate extended region in visual mode</h3>
<div class="outline-text-3" id="text-org3bf6066">
<p>
Allow to visual mode work more like vim visual highlighting.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(set-face-attribute 'region nil <span class="org-builtin">:extend</span> nil)
</pre>
</div>
</div>
</div>

<div id="outline-container-org1ba9ed9" class="outline-3">
<h3 id="org1ba9ed9">Dark and transparent title bar in macOS</h3>
<div class="outline-text-3" id="text-org1ba9ed9">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span class="org-keyword">when</span> (memq window-system '(mac ns))
  (add-to-list 'default-frame-alist '(ns-transparent-titlebar . t))
  (add-to-list 'default-frame-alist '(ns-appearance . dark)))
</pre>
</div>
</div>
</div>

<div id="outline-container-orgd1e8752" class="outline-3">
<h3 id="orgd1e8752">Share clipoard with OS</h3>
<div class="outline-text-3" id="text-orgd1e8752">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package pbcopy
  <span class="org-builtin">:ensure</span> t)
</pre>
</div>
</div>
</div>

<div id="outline-container-org9d436b3" class="outline-3">
<h3 id="org9d436b3">Highlight TODO, FIXME, etc</h3>
<div class="outline-text-3" id="text-org9d436b3">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span class="org-keyword">defun</span> <span class="org-function-name">my/highlight-todo-like-words</span> ()
  (font-lock-add-keywords
   nil `((<span class="org-string">"\\&lt;</span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">(</span></span><span class="org-string">FIXME</span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">|</span></span><span class="org-string">TODO</span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">)</span></span><span class="org-string">"</span>
          1 font-lock-warning-face t))))

(add-hook 'prog-mode-hook 'my/highlight-todo-like-words)
</pre>
</div>
</div>
</div>

<div id="outline-container-org2f02a79" class="outline-3">
<h3 id="org2f02a79">Auto fill mode</h3>
<div class="outline-text-3" id="text-org2f02a79">
<p>
Use <code>auto-fill-mode</code> only for comments and only with programming buffers
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span class="org-keyword">setq</span> comment-auto-fill-only-comments t)

(add-hook 'prog-mode-hook #'(lambda ()
                              (auto-fill-mode 1)))
</pre>
</div>
</div>
</div>

<div id="outline-container-org2fdd259" class="outline-3">
<h3 id="org2fdd259">Load PATH environment</h3>
<div class="outline-text-3" id="text-org2fdd259">
<p>
<code>exec-path-from-shell</code> by default uses <code>("-l" "-i")</code> when starts a new shell to get the <code>PATH</code>, <code>-i</code> option was removed to open a non interactive shell so it can be faster at startup.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package exec-path-from-shell
  <span class="org-builtin">:ensure</span> t
  <span class="org-builtin">:custom</span>
  (exec-path-from-shell-arguments '(<span class="org-string">"-l"</span>))
  (exec-path-from-shell-check-startup-files nil)
  <span class="org-builtin">:config</span>
  (<span class="org-keyword">when</span> (memq window-system '(mac ns))
    (exec-path-from-shell-initialize)))
</pre>
</div>
</div>
</div>

<div id="outline-container-org7be5aea" class="outline-3">
<h3 id="org7be5aea">Editorconfig</h3>
<div class="outline-text-3" id="text-org7be5aea">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span class="org-keyword">if</span> (&gt;= emacs-major-version 30)
    (use-package editorconfig
      <span class="org-builtin">:straight</span> (<span class="org-builtin">:type</span> built-in)
      <span class="org-builtin">:config</span>
      (editorconfig-mode 1))
  (use-package editorconfig
    <span class="org-builtin">:ensure</span> t
    <span class="org-builtin">:config</span>
    (editorconfig-mode 1)))
</pre>
</div>
</div>
</div>

<div id="outline-container-orgc5cd847" class="outline-3">
<h3 id="orgc5cd847">Snippets</h3>
<div class="outline-text-3" id="text-orgc5cd847">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package yasnippet
  <span class="org-builtin">:ensure</span> t
  <span class="org-builtin">:hook</span> ((prog-mode . yas-minor-mode)
         (conf-mode . yas-minor-mode)
         (text-mode . yas-minor-mode)
         (snippet-mode . yas-minor-mode)))

(use-package yasnippet-snippets
  <span class="org-builtin">:ensure</span> t
  <span class="org-builtin">:after</span> (yasnippet))
</pre>
</div>
</div>
</div>

<div id="outline-container-org221b86d" class="outline-3">
<h3 id="org221b86d">Wakatime</h3>
<div class="outline-text-3" id="text-org221b86d">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package wakatime-mode
  <span class="org-builtin">:ensure</span> t
  <span class="org-builtin">:if</span> (executable-find <span class="org-string">"wakatime-cli"</span>)
  <span class="org-builtin">:init</span>
  (<span class="org-keyword">setq</span> wakatime-cli-path (executable-find <span class="org-string">"wakatime-cli"</span>))
  <span class="org-builtin">:config</span>
  (global-wakatime-mode))
</pre>
</div>
</div>
</div>

<div id="outline-container-orgd8b2b63" class="outline-3">
<h3 id="orgd8b2b63">Highlight thing</h3>
<div class="outline-text-3" id="text-orgd8b2b63">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package highlight-thing
  <span class="org-builtin">:ensure</span> t
  <span class="org-builtin">:hook</span>
  (prog-mode . highlight-thing-mode))
</pre>
</div>
</div>
</div>

<div id="outline-container-org34de15a" class="outline-3">
<h3 id="org34de15a">Various changes</h3>
<div class="outline-text-3" id="text-org34de15a">
<p>
Disable lock files
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span class="org-keyword">setq</span> create-lockfiles nil)
</pre>
</div>
</div>
</div>

<div id="outline-container-orgdbf0da3" class="outline-3">
<h3 id="orgdbf0da3">Reformatter</h3>
<div class="outline-text-3" id="text-orgdbf0da3">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package reformatter
  <span class="org-builtin">:ensure</span> t)
</pre>
</div>
</div>
</div>

<div id="outline-container-org7ef704b" class="outline-3">
<h3 id="org7ef704b">Hydra for major modes</h3>
<div class="outline-text-3" id="text-org7ef704b">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package major-mode-hydra
  <span class="org-builtin">:ensure</span> t
  <span class="org-builtin">:config</span>
  (<span class="org-keyword">with-eval-after-load</span> 'evil
    (evil-define-key nil 'global (kbd <span class="org-string">"&lt;leader&gt;\\"</span>) #'(lambda ()
                                                        (<span class="org-keyword">interactive</span>)
                                                        (major-mode-hydra)))))

(use-package hydra-posframe
  <span class="org-builtin">:straight</span> (hydra-posframe
             <span class="org-builtin">:type</span> git
             <span class="org-builtin">:host</span> github
             <span class="org-builtin">:repo</span> <span class="org-string">"Ladicle/hydra-posframe"</span>)
  <span class="org-builtin">:hook</span> (after-init . hydra-posframe-mode))
</pre>
</div>
</div>
</div>

<div id="outline-container-org64a3dcb" class="outline-3">
<h3 id="org64a3dcb">Vterm</h3>
<div class="outline-text-3" id="text-org64a3dcb">
<p>
Function to search into zsh history
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span class="org-keyword">defun</span> <span class="org-function-name">my/select-from-zsh-history</span> ()
  <span class="org-doc">"Selectt one option from ~/.zsh_history file."</span>
  (<span class="org-keyword">with-temp-buffer</span>
    (insert-file-contents (expand-file-name <span class="org-string">"~/.zsh_history"</span>))
    (<span class="org-keyword">let*</span> ((raw-content (buffer-substring-no-properties (point-min) (point-max)))
           (lines (string-split raw-content <span class="org-string">"\n"</span>))
           (choices (mapcar (<span class="org-keyword">lambda</span> (line) (second (string-split line <span class="org-string">";"</span>))) lines)))
      (completing-read <span class="org-string">"Select command: "</span> choices))))

(<span class="org-keyword">defun</span> <span class="org-function-name">my/insert-from-zsh-history</span> ()
  <span class="org-doc">"Search into zsh history and insert the selected choice into buffer."</span>
  (<span class="org-keyword">interactive</span>)
  (<span class="org-keyword">when-let</span> ((selected-choice (my/select-from-zsh-history)))
    (vterm-insert selected-choice)))
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package vterm
  <span class="org-builtin">:ensure</span> t
  <span class="org-builtin">:defer</span> t
  <span class="org-builtin">:hook</span>
  (vterm-mode . (<span class="org-keyword">lambda</span> ()
                  (<span class="org-keyword">setq-local</span> show-trailing-whitespace nil)))
  <span class="org-builtin">:mode-hydra</span>
  (vterm-mode
   (<span class="org-builtin">:title</span> (concat (nerd-icons-icon-for-buffer) <span class="org-string">" Vterm commands"</span>))
   (<span class="org-string">"History"</span>
    ((<span class="org-string">"i"</span> my/insert-from-zsh-history <span class="org-string">"Insert command from history"</span>))))
  <span class="org-builtin">:custom</span>
  (vterm-module-cmake-args <span class="org-string">"-DUSE_SYSTEM_LIBVTERM=yes"</span>)
  (vterm-always-compile-module t))
</pre>
</div>
</div>
</div>

<div id="outline-container-org892caac" class="outline-3">
<h3 id="org892caac">Toggle terminal</h3>
<div class="outline-text-3" id="text-org892caac">
<p>
<code>'project</code> use always the same terminal per project, this way we avoid to create a new terminal for each call to <code>vterm-toggle</code>.
<code>'reset-window-configration</code> yes, it's suppose to be <code>configration</code>, for some reason it was defined like this instead of <code>configuration</code>
</p>

<p>
Also for easy access insert mode is activated right away after vterm is shown
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package vterm-toggle
  <span class="org-builtin">:ensure</span> t
  <span class="org-builtin">:custom</span>
  (vterm-toggle-scope 'project)
  (vterm-toggle-hide-method 'reset-window-configration)
  <span class="org-builtin">:hook</span>
  (vterm-toggle-show . evil-insert-state))
</pre>
</div>
</div>
</div>

<div id="outline-container-orga7e2df3" class="outline-3">
<h3 id="orga7e2df3">iSpell</h3>
<div class="outline-text-3" id="text-orga7e2df3">
<p>
Avoid check spelling in markdown code blocks
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span class="org-keyword">with-eval-after-load</span> 'ispell
  (<span class="org-keyword">setq</span> ispell-program-name <span class="org-string">"aspell"</span>)
  (add-to-list 'ispell-skip-region-alist
               '(<span class="org-string">"^```"</span> . <span class="org-string">"^```"</span>)))
</pre>
</div>

<p>
When editing a commit message <code>ispell</code> should ignore lines that start with <code>#</code>, these lines are diff details about the commit.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span class="org-keyword">defun</span> <span class="org-function-name">my/setup-ispell-for-commit-message</span> ()
  <span class="org-doc">"Setup `</span><span class="org-doc"><span class="org-constant">ispell-skip-region-alist</span></span><span class="org-doc">' to avoid lines starting with #.</span>
<span class="org-doc">  This way diff code will be ignored when ispell run."</span>
  (<span class="org-keyword">setq-local</span> ispell-skip-region-alist (cons '(<span class="org-string">"^#"</span> . <span class="org-string">"$"</span>) ispell-skip-region-alist)))
</pre>
</div>
</div>
</div>

<div id="outline-container-org1a0ab88" class="outline-3">
<h3 id="org1a0ab88">Tree sitter</h3>
<div class="outline-text-3" id="text-org1a0ab88">
<p>
Incremental code parsing for better syntax highlighting
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package tree-sitter
  <span class="org-builtin">:ensure</span> t
  <span class="org-builtin">:hook</span>
  (tree-sitter-after-on . tree-sitter-hl-mode)
  <span class="org-builtin">:config</span>
  (global-tree-sitter-mode))

(use-package tree-sitter-langs
  <span class="org-builtin">:ensure</span> t)
</pre>
</div>

<p>
Function to copy grammar <code>~/.emacs.d/tree-sitter</code>
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span class="org-keyword">defun</span> <span class="org-function-name">my/copy-grammars-to-emacs-tree-sitter-dir</span> ()
  <span class="org-doc">"Copy tree-sitter grammar files to native Emacs dir."</span>
  (<span class="org-keyword">interactive</span>)
  (<span class="org-keyword">let*</span> ((extension (<span class="org-keyword">if</span> (string-equal system-type <span class="org-string">"darwin"</span>) <span class="org-string">"dylb"</span> <span class="org-string">"so"</span>))
         (files (directory-files (tree-sitter-langs--bin-dir) nil (format <span class="org-string">"\\.%s$"</span> <span class="org-string">"so"</span>)))
         (tree-sitter-dir (concat (expand-file-name user-emacs-directory) <span class="org-string">"tree-sitter"</span>)))
    (<span class="org-keyword">unless</span> (file-directory-p tree-sitter-dir)
      (mkdir tree-sitter-dir))
    (<span class="org-keyword">dolist</span> (grammar-file files)
      (copy-file (concat (tree-sitter-langs--bin-dir) grammar-file) (concat tree-sitter-dir <span class="org-string">"/libtree-sitter-"</span> grammar-file) t)
      (message <span class="org-string">"%s grammar files copied"</span> (length files)))))
</pre>
</div>

<p>
Run ispell in text nodes
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package treesit-ispell
  <span class="org-builtin">:ensure</span> t
  <span class="org-builtin">:defer</span> t
  <span class="org-builtin">:bind</span> ((<span class="org-string">"C-x C-s"</span> . treesit-ispell-run-at-point)))
</pre>
</div>

<p>
Set maximum value for <code>font-locking</code> in <code>treesit</code> native syntax highlighting
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span class="org-keyword">with-eval-after-load</span> 'treesit
  (<span class="org-keyword">setq</span> treesit-font-lock-level 4))
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org0e3087e" class="outline-2">
<h2 id="org0e3087e">Evil</h2>
<div class="outline-text-2" id="text-org0e3087e">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span class="org-keyword">defun</span> <span class="org-function-name">my/find-file-under-cursor</span> ()
  <span class="org-doc">"Check it the filepath under cursor is an absolute path otherwise open `</span><span class="org-doc"><span class="org-constant">project-find-file</span></span><span class="org-doc">' and insert the filepath."</span>
  (<span class="org-keyword">interactive</span>)
  (<span class="org-keyword">let</span> ((file-path (thing-at-point 'filename t)))
    (<span class="org-keyword">if</span> (file-name-absolute-p file-path)
        (find-file-at-point file-path)
      (<span class="org-keyword">minibuffer-with-setup-hook</span> #'(lambda () (insert file-path))
        (project-find-file)))))
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package evil
  <span class="org-builtin">:ensure</span> t
  <span class="org-builtin">:init</span>
  (<span class="org-keyword">setq</span> evil-emacs-state-cursor '(<span class="org-string">"white"</span> box)
        evil-normal-state-cursor '(<span class="org-string">"green"</span> box)
        evil-visual-state-cursor '(<span class="org-string">"orange"</span> box)
        evil-insert-state-cursor '(<span class="org-string">"red"</span> bar)
        <span class="org-comment-delimiter">;; </span><span class="org-comment">use emacs-28 undo system</span>
        evil-undo-system 'undo-redo)
  <span class="org-builtin">:config</span>
  (evil-mode 1)
  (modify-syntax-entry ?_ <span class="org-string">"w"</span>)
  (define-key evil-normal-state-map (kbd <span class="org-string">"C-p"</span>) 'diff-hl-previous-hunk)
  (define-key evil-normal-state-map (kbd <span class="org-string">"C-n"</span>) 'diff-hl-next-hunk)
  (define-key evil-normal-state-map <span class="org-string">"gf"</span> 'my/find-file-under-cursor)
  (define-key evil-motion-state-map <span class="org-string">"gd"</span> 'my/goto-definition-dumb-jump-fallback)
  (add-hook 'prog-mode-hook #'(lambda ()
                                (modify-syntax-entry ?_ <span class="org-string">"w"</span>)))

  <span class="org-comment-delimiter">;; </span><span class="org-comment">Setup leader key only for `</span><span class="org-comment"><span class="org-constant">normal</span></span><span class="org-comment">', `</span><span class="org-comment"><span class="org-constant">visual</span></span><span class="org-comment">' and `</span><span class="org-comment"><span class="org-constant">motion</span></span><span class="org-comment">' modes</span>
  (evil-set-leader '(normal visual motion) (kbd <span class="org-string">"\\"</span>))

  (evil-define-key nil 'global (kbd <span class="org-string">"&lt;leader&gt;SPC"</span>) #'(lambda ()
                                                       (<span class="org-keyword">interactive</span>)
                                                       (call-interactively #'execute-extended-command)))
  (evil-define-key nil 'global (kbd <span class="org-string">"&lt;leader&gt;a"</span>) #'(lambda ()
                                                     (<span class="org-keyword">interactive</span>)
                                                     (<span class="org-keyword">if</span> (region-active-p)
                                                         (my/grep-in-project (buffer-substring-no-properties (region-beginning) (region-end)))
                                                       (my/grep-in-project (thing-at-point 'symbol)))))
  (evil-define-key nil 'global (kbd <span class="org-string">"&lt;leader&gt;A"</span>) 'my/grep-in-project)
  (evil-define-key nil 'global (kbd <span class="org-string">"&lt;leader&gt;ba"</span>) 'my/add-bookmark)
  (evil-define-key nil 'global (kbd <span class="org-string">"&lt;leader&gt;bb"</span>) 'my/bookmark-switch)
  (evil-define-key nil 'global (kbd <span class="org-string">"&lt;leader&gt;B"</span>) #'(lambda ()
                                                     (<span class="org-keyword">interactive</span>)
                                                     (call-interactively #'switch-to-buffer)))
  (evil-define-key nil 'global (kbd <span class="org-string">"&lt;leader&gt;c"</span>) 'vterm-toggle)
  (evil-define-key nil 'global (kbd <span class="org-string">"&lt;leader&gt;d"</span>) 'my/goto-definition-dumb-jump-fallback)
  (evil-define-key nil 'global (kbd <span class="org-string">"&lt;leader&gt;e"</span>) 'my/find-file-in-project)
  (evil-define-key nil 'global (kbd <span class="org-string">"&lt;leader&gt;f"</span>) 'find-file)
  (evil-define-key nil 'global (kbd <span class="org-string">"&lt;leader&gt;g"</span>) 'magit-status)
  (evil-define-key nil 'global (kbd <span class="org-string">"&lt;leader&gt;G"</span>) 'magit-file-dispatch)
  (evil-define-key nil 'global (kbd <span class="org-string">"&lt;leader&gt;i"</span>) 'consult-imenu)
  (evil-define-key nil 'global (kbd <span class="org-string">"&lt;leader&gt;hs"</span>) 'diff-hl-stage-current-hunk)
  (evil-define-key nil 'global (kbd <span class="org-string">"&lt;leader&gt;hk"</span>) 'diff-hl-revert-hunk)
  (evil-define-key nil 'global (kbd <span class="org-string">"&lt;leader&gt;k"</span>) 'kill-buffer)
  (evil-define-key nil 'global (kbd <span class="org-string">"&lt;leader&gt;l"</span>) 'display-line-numbers-mode)
  (evil-define-key nil 'global (kbd <span class="org-string">"&lt;leader&gt;n"</span>) 'evil-buffer-new)
  (evil-define-key nil 'global (kbd <span class="org-string">"&lt;leader&gt;N"</span>) 'my/toggle-narrowing)
  (evil-define-key nil 'global (kbd <span class="org-string">"&lt;leader&gt;pa"</span>) 'my/copy-abs-path)
  (evil-define-key nil 'global (kbd <span class="org-string">"&lt;leader&gt;pr"</span>) 'my/copy-relative-path)
  (evil-define-key nil 'global (kbd <span class="org-string">"&lt;leader&gt;q"</span>) 'consult-line)
  (evil-define-key nil 'global (kbd <span class="org-string">"&lt;leader&gt;r"</span>) 'my/replace-at-point-or-region)
  (evil-define-key nil 'global (kbd <span class="org-string">"&lt;leader&gt;R"</span>) '(lambda ()
                                                    (<span class="org-keyword">interactive</span>)
                                                    (<span class="org-keyword">save-excursion</span>)
                                                    (<span class="org-keyword">with-current-buffer</span> <span class="org-string">"*compilation*"</span>
                                                      (recompile))))
  (evil-define-key nil 'global (kbd <span class="org-string">"&lt;leader&gt;s"</span>) 'my/toggle-spanish-characters)
  (evil-define-key nil 'global (kbd <span class="org-string">"&lt;leader&gt;t"</span>) 'persp-switch)
  (evil-define-key nil 'global (kbd <span class="org-string">"&lt;leader&gt;w"</span>) 'my/toggle-maximize)
  (evil-define-key nil 'global (kbd <span class="org-string">"&lt;leader&gt;x"</span>) 'my/resize-window)
  (evil-define-key nil 'global (kbd <span class="org-string">"&lt;leader&gt;y"</span>) 'consult-yank-from-kill-ring)

  (face-spec-set
   'evil-ex-substitute-matches
   '((t <span class="org-builtin">:foreground</span> <span class="org-string">"red"</span>
        <span class="org-builtin">:strike-through</span> t
        <span class="org-builtin">:weight</span> bold)))

  (face-spec-set
   'evil-ex-substitute-replacement
   '((t
      <span class="org-builtin">:foreground</span> <span class="org-string">"green"</span>
      <span class="org-builtin">:weight</span> bold))))

(use-package evil-commentary
  <span class="org-builtin">:ensure</span> t
  <span class="org-builtin">:after</span> (evil)
  <span class="org-builtin">:config</span>
  (evil-commentary-mode))

(use-package evil-surround
  <span class="org-builtin">:ensure</span> t
  <span class="org-builtin">:after</span> (evil)
  <span class="org-builtin">:config</span>
  (global-evil-surround-mode 1))

(<span class="org-keyword">defun</span> <span class="org-function-name">my/replace-at-point-or-region</span> ()
  <span class="org-doc">"Setup buffer replace string for word at point or active region using evil ex mode."</span>
  (<span class="org-keyword">interactive</span>)
  (<span class="org-keyword">let</span> ((text (<span class="org-keyword">if</span> (region-active-p)
                  (buffer-substring-no-properties (region-beginning) (region-end))
                (word-at-point))))
    (evil-ex (concat <span class="org-string">"%s/"</span> text <span class="org-string">"/"</span>))))

(use-package evil-matchit
  <span class="org-builtin">:ensure</span> t
  <span class="org-builtin">:config</span> (global-evil-matchit-mode 1))
</pre>
</div>
</div>
</div>

<div id="outline-container-org43e9bad" class="outline-2">
<h2 id="org43e9bad">IA models integration</h2>
<div class="outline-text-2" id="text-org43e9bad">
<p>
Integration with different "backends", <code>ollama</code>, <code>openai</code>, and so on.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package llm
  <span class="org-builtin">:ensure</span> t)
</pre>
</div>

<p>
UI to interact with models, relies on <code>llm</code>
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package ellama
  <span class="org-builtin">:ensure</span> t
  <span class="org-builtin">:custom</span>
  (ellama-language <span class="org-string">"English"</span>)
  <span class="org-builtin">:config</span>
  (<span class="org-keyword">require</span> '<span class="org-constant">llm-ollama</span>)
  (<span class="org-keyword">with-eval-after-load</span> 'llm-ollama)
  (setopt ellama-provider (make-llm-ollama
                           <span class="org-builtin">:host</span> <span class="org-string">"localhost"</span>
                           <span class="org-builtin">:chat-model</span> <span class="org-string">"zephyr"</span>)))
</pre>
</div>

<p>
Custom functions to better management of models
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span class="org-keyword">defun</span> <span class="org-function-name">my/switch-ollama-provider</span> ()
  <span class="org-doc">"Switch ollama provider by using the installed local models."</span>
  (<span class="org-keyword">interactive</span>)
  (<span class="org-keyword">let*</span> ((raw-result (shell-command-to-string <span class="org-string">"ollama list | awk '{print $1}' | tail -n+2"</span>))
         (choices (string-split (string-trim raw-result) <span class="org-string">"\n"</span>))
         (choices (mapcar (<span class="org-keyword">lambda</span> (choice) (car (string-split choice <span class="org-string">":"</span>))) choices))
         (model (completing-read <span class="org-string">"Choose model"</span> choices)))
    (setopt ellama-provider (make-llm-ollama <span class="org-builtin">:host</span> <span class="org-string">"localhost"</span> <span class="org-builtin">:chat-model</span> model))
    (message <span class="org-string">"Model %s configured as ollama provider."</span> (propertize model 'face '(<span class="org-builtin">:foreground</span> <span class="org-string">"magenta"</span>)))))
</pre>
</div>
</div>
</div>

<div id="outline-container-org9bde979" class="outline-2">
<h2 id="org9bde979">Utils</h2>
<div class="outline-text-2" id="text-org9bde979">
</div>
<div id="outline-container-orgb918c10" class="outline-3">
<h3 id="orgb918c10">Which-key</h3>
<div class="outline-text-3" id="text-orgb918c10">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span class="org-keyword">if</span> (&gt;= emacs-major-version 30)
    (use-package which-key
      <span class="org-builtin">:straight</span> (<span class="org-builtin">:type</span> built-in)
      <span class="org-builtin">:config</span>
      (which-key-mode)
      (which-key-setup-minibuffer))
  (use-package which-key
    <span class="org-builtin">:ensure</span> t
    <span class="org-builtin">:config</span>
    (which-key-mode)
    (which-key-setup-minibuffer)))
</pre>
</div>
</div>
</div>

<div id="outline-container-org30ae0fe" class="outline-3">
<h3 id="org30ae0fe">Auto pair</h3>
<div class="outline-text-3" id="text-org30ae0fe">
<p>
Complete parenthesis, square brackets, etc
</p>

<p>
Enable it globally and disable it just for <code>org-mode</code> to avoid having a conflict with <code>&lt;s</code>
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(electric-pair-mode)
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(add-hook 'org-mode-hook #'(lambda ()
                             (electric-pair-local-mode -1)))
</pre>
</div>
</div>
</div>

<div id="outline-container-orge22926a" class="outline-3">
<h3 id="orge22926a">Restclient</h3>
<div class="outline-text-3" id="text-orge22926a">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package restclient
  <span class="org-builtin">:ensure</span> t
  <span class="org-builtin">:defer</span> t
  <span class="org-builtin">:mode</span> ((<span class="org-string">"\\.http\\'"</span> . restclient-mode))
  <span class="org-builtin">:mode-hydra</span>
  (restclient-mode
   (<span class="org-builtin">:title</span> (concat (nerd-icons-icon-for-buffer) <span class="org-string">" restclient commands"</span>))
   (<span class="org-string">"Format"</span>
    <span class="org-comment-delimiter">;; </span><span class="org-comment">TODO: change to only apply json formatting when the content-type is application/json</span>
    ((<span class="org-string">"f"</span> jsonian-format-region))
    <span class="org-string">"Secrets"</span>
    ((<span class="org-string">"h"</span> cloak-mode <span class="org-string">"Toggle cloak"</span> <span class="org-builtin">:toggle</span> t))
    <span class="org-string">"Request"</span>
    ((<span class="org-string">"r"</span> restclient-http-send-current-stay-in-window <span class="org-string">"Execute request"</span>)
     (<span class="org-string">"c"</span> restclient-copy-curl-command <span class="org-string">"Copy CURL command"</span>)))))

(use-package company-restclient
  <span class="org-builtin">:ensure</span> t
  <span class="org-builtin">:after</span> (restclient)
  <span class="org-builtin">:config</span>
  (add-to-list 'company-backends 'company-restclient))
</pre>
</div>
</div>
</div>

<div id="outline-container-org07f290c" class="outline-3">
<h3 id="org07f290c">Rainbow delimiters</h3>
<div class="outline-text-3" id="text-org07f290c">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package rainbow-delimiters
  <span class="org-builtin">:ensure</span> t
  <span class="org-builtin">:hook</span>
  (prog-mode . rainbow-delimiters-mode))
</pre>
</div>
</div>
</div>

<div id="outline-container-orged5a6a9" class="outline-3">
<h3 id="orged5a6a9">XML formatter</h3>
<div class="outline-text-3" id="text-orged5a6a9">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(reformatter-define xml-format
  <span class="org-builtin">:program</span> <span class="org-string">"xmlformat"</span>
  <span class="org-builtin">:group</span> 'xml)

(<span class="org-keyword">with-eval-after-load</span> 'nxml-mode
  (define-key nxml-mode-map (kbd <span class="org-string">"C-c C-f"</span>) 'xml-format-buffer))
</pre>
</div>
</div>
</div>

<div id="outline-container-org803288e" class="outline-3">
<h3 id="org803288e">SQL formatter</h3>
<div class="outline-text-3" id="text-org803288e">
<p>
Install <code>pgformatter</code> using homebrew <code>brew install pgformatter</code>
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(reformatter-define sql-format
  <span class="org-builtin">:program</span> <span class="org-string">"pg_format"</span>)

(<span class="org-keyword">defun</span> <span class="org-function-name">my/format-sql</span> ()
  <span class="org-doc">"Format active region otherwise format the entire buffer."</span>
  (<span class="org-keyword">interactive</span>)
  (<span class="org-keyword">if</span> (region-active-p)
      (sql-format-region (region-beginning) (region-end))
    (sql-format-buffer)))

(<span class="org-keyword">with-eval-after-load</span> 'sql
  (add-hook 'sql-mode-hook 'flymake-sqlfluff-load)
  (add-hook 'sql-mode-hook 'flymake-mode)
  (define-key sql-mode-map (kbd <span class="org-string">"C-c C-f"</span>) 'my/format-sql))
</pre>
</div>
</div>
</div>

<div id="outline-container-org6055c6c" class="outline-3">
<h3 id="org6055c6c">SQL linter using <a href="https://www.sqlfluff.com">sqlfluff</a></h3>
<div class="outline-text-3" id="text-org6055c6c">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package flymake-sqlfluff
  <span class="org-builtin">:ensure</span> t)
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-orgb7aa2ae" class="outline-2">
<h2 id="orgb7aa2ae">Common packages</h2>
<div class="outline-text-2" id="text-orgb7aa2ae">
<p>
Used in every major mode
</p>
</div>

<div id="outline-container-orgf8def24" class="outline-3">
<h3 id="orgf8def24">Company</h3>
<div class="outline-text-3" id="text-orgf8def24">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package company
  <span class="org-builtin">:ensure</span> t
  <span class="org-builtin">:init</span>
  (<span class="org-keyword">setq</span> company-idle-delay 0.1
        company-tooltip-limit 10
        company-minimum-prefix-length 3)
  <span class="org-builtin">:hook</span> (after-init . global-company-mode)
  <span class="org-builtin">:config</span>
  (define-key company-active-map (kbd <span class="org-string">"C-n"</span>) 'company-select-next)
  (define-key company-active-map (kbd <span class="org-string">"C-p"</span>) 'company-select-previous))
</pre>
</div>
</div>
</div>

<div id="outline-container-orgd48fba8" class="outline-3">
<h3 id="orgd48fba8">Flymake</h3>
<div class="outline-text-3" id="text-orgd48fba8">
<p>
Only activate <code>flymake</code> for actual projects and for <code>prog-mode</code>
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span class="org-keyword">defun</span> <span class="org-function-name">my/setup-flymake</span> ()
  <span class="org-doc">"Activate flymake only if we are inside a project."</span>
  (<span class="org-keyword">when</span> (functionp 'my/project-p)
    (flymake-mode 1)))

(add-hook 'prog-mode-hook 'my/setup-flymake)

(<span class="org-keyword">with-eval-after-load</span> <span class="org-string">"flymake"</span>
  (define-key flymake-mode-map (kbd <span class="org-string">"M-n"</span>) 'flymake-goto-next-error)
  (define-key flymake-mode-map (kbd <span class="org-string">"M-p"</span>) 'flymake-goto-prev-error))
</pre>
</div>
</div>
</div>

<div id="outline-container-orgceb3241" class="outline-3">
<h3 id="orgceb3241">Direnv</h3>
<div class="outline-text-3" id="text-orgceb3241">
<p>
Handle environment variables per buffer using a <code>.envrc</code> file.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package envrc
  <span class="org-builtin">:ensure</span> t
  <span class="org-builtin">:config</span>
  (envrc-global-mode))
</pre>
</div>

<p>
Hydra commands, this have to be defined this way instead of using <code>:mode-hydra</code> inside <code>use-package</code> because
for some reason it mess up with environment variables loading
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span class="org-keyword">with-eval-after-load</span> 'major-mode-hydra
  (major-mode-hydra-define envrc-file-mode
    (<span class="org-builtin">:title</span> (concat (nerd-icons-icon-for-buffer) <span class="org-string">" envrc commands"</span>))
    (<span class="org-string">"Secrets"</span>
     ((<span class="org-string">"h"</span> cloak-mode <span class="org-string">"Toggle cloak"</span> <span class="org-builtin">:toggle</span> t)))))
</pre>
</div>
</div>
</div>

<div id="outline-container-orgae302e3" class="outline-3">
<h3 id="orgae302e3">Cloak mode</h3>
<div class="outline-text-3" id="text-orgae302e3">
<p>
Hide values that match regex patterns in <code>.envrc</code> and <code>restclient</code> files
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package cloak-mode
 <span class="org-builtin">:ensure</span> t
 <span class="org-builtin">:custom</span>
 (cloak-mode-patterns '((envrc-file-mode . <span class="org-string">"[a-zA-Z0-9_]+[ \t]*=[ \t]*</span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">(</span></span><span class="org-string">.*+</span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">)</span></span><span class="org-string">$"</span>)
                        (restclient-mode . <span class="org-string">"^:[</span><span class="org-string"><span class="org-negation-char">^</span></span><span class="org-string">: ]+[ \t]*=[ \t]*</span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">(</span></span><span class="org-string">.+?</span><span class="org-string"><span class="org-regexp-grouping-backslash">\\</span></span><span class="org-string"><span class="org-regexp-grouping-construct">)</span></span><span class="org-string">$"</span>)))
 (cloak-mode-mask <span class="org-string">"&#128584;&#128584;&#128584;"</span>)
 <span class="org-builtin">:config</span>
 (global-cloak-mode))
</pre>
</div>
</div>
</div>

<div id="outline-container-orgefd7ac7" class="outline-3">
<h3 id="orgefd7ac7">Avy</h3>
<div class="outline-text-3" id="text-orgefd7ac7">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package avy
  <span class="org-builtin">:ensure</span> t
  <span class="org-builtin">:config</span>
  (<span class="org-keyword">with-eval-after-load</span> 'evil
    (define-key evil-normal-state-map (kbd <span class="org-string">"SPC SPC"</span>) 'avy-goto-char-2)))
</pre>
</div>
</div>
</div>

<div id="outline-container-orga061028" class="outline-3">
<h3 id="orga061028">perspective.el</h3>
<div class="outline-text-3" id="text-orga061028">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package perspective
  <span class="org-builtin">:ensure</span> t
  <span class="org-builtin">:custom</span>
  <span class="org-comment-delimiter">;; </span><span class="org-comment">disable warnings</span>
  (persp-suppress-no-prefix-key-warning t)
  <span class="org-builtin">:config</span>
  (persp-mode)
  <span class="org-comment-delimiter">;; </span><span class="org-comment">setup vim tab like key-bindings</span>
  (define-key evil-normal-state-map (kbd <span class="org-string">"gt"</span>) 'persp-next)
  (define-key evil-normal-state-map (kbd <span class="org-string">"gT"</span>) 'persp-prev))
</pre>
</div>
</div>
</div>

<div id="outline-container-org591684c" class="outline-3">
<h3 id="org591684c">Project.el</h3>
<div class="outline-text-3" id="text-org591684c">
<p>
<code>project.el</code> default prefix is <code>C-x</code>
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span class="org-keyword">defun</span> <span class="org-function-name">my/project-edit-dir-locals</span> ()
  <span class="org-doc">"Edit .dir-locals.el file in project root."</span>
  (<span class="org-keyword">interactive</span>)
  (find-file (expand-file-name <span class="org-string">".dir-locals.el"</span> (my/project-root))))

(<span class="org-keyword">defun</span> <span class="org-function-name">my/project-edit-direnv</span> ()
  <span class="org-doc">"Edit .envrc file in project root."</span>
  (<span class="org-keyword">interactive</span>)
  (find-file (expand-file-name <span class="org-string">".envrc"</span> (my/project-root))))

(use-package project
  <span class="org-builtin">:straight</span> (<span class="org-builtin">:type</span> built-in)
  <span class="org-builtin">:bind</span> (<span class="org-builtin">:map</span> project-prefix-map
              (<span class="org-string">"D"</span> . 'my/project-edit-direnv)
              (<span class="org-string">"d"</span> . 'project-dired)
              (<span class="org-string">"e"</span> . 'my/project-edit-dir-locals)
              (<span class="org-string">"k"</span> . 'my/project-kill-buffers)
              (<span class="org-string">"n"</span> . 'my/project-open-new-project)
              (<span class="org-string">"p"</span> . 'my/project-switch)))
</pre>
</div>

<p>
Define helper functions to be used by other packages
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span class="org-keyword">defun</span> <span class="org-function-name">my/project-root</span> ()
  <span class="org-doc">"Return project root path."</span>
  (project-root (project-current)))

(<span class="org-keyword">defun</span> <span class="org-function-name">my/project-p</span> ()
  (project-current))

(<span class="org-keyword">defun</span> <span class="org-function-name">my/project-name</span> ()
  <span class="org-doc">"Get project name extracting latest part of project path."</span>
  (<span class="org-keyword">if</span> (my/project-p)
      (second (reverse (split-string (my/project-root) <span class="org-string">"/"</span>)))
    nil))
</pre>
</div>

<p>
<code>perspective.el</code> integration, a new perspective should be "attached" to a project so it's easy to switch between them.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span class="org-keyword">defun</span> <span class="org-function-name">my/project-switch</span> ()
  <span class="org-doc">"Switch to a project and trigger switch action."</span>
  (<span class="org-keyword">interactive</span>)
  <span class="org-comment-delimiter">;; </span><span class="org-comment">make sure all the projects list is available to be used</span>
  (project--ensure-read-project-list)
  (<span class="org-keyword">let*</span> ((projects (mapcar 'car project--list))
         (choice (completing-read <span class="org-string">"Switch to project: "</span> projects))
         (default-directory choice))
    <span class="org-comment-delimiter">;; </span><span class="org-comment">`</span><span class="org-comment"><span class="org-constant">default-directory</span></span><span class="org-comment">' must be defined so `</span><span class="org-comment"><span class="org-constant">project.el</span></span><span class="org-comment">' can know is in a new project</span>
    (my/project-switch-action)))

(<span class="org-keyword">defun</span> <span class="org-function-name">my/project-switch-action</span> ()
  <span class="org-doc">"Switch to a new perspective which name is project's name and open `</span><span class="org-doc"><span class="org-constant">project-find-file</span></span><span class="org-doc">'."</span>
  (<span class="org-keyword">interactive</span>)
  (persp-switch (my/project-name))
  (project-find-file))

(<span class="org-keyword">defun</span> <span class="org-function-name">my/project-kill-buffers</span> ()
  <span class="org-doc">"Kill all the related buffers to the current project and delete its perspective as well."</span>
  (<span class="org-keyword">interactive</span>)
  (<span class="org-keyword">let*</span> ((project-name (my/project-name))
         (project (project-current))
         (buffers-to-kill (project--buffers-to-kill project)))
    (<span class="org-keyword">when</span> (yes-or-no-p (format <span class="org-string">"Kill %d buffers in %s?"</span> (length buffers-to-kill) (my/project-root)))
      <span class="org-comment-delimiter">;; </span><span class="org-comment">in case we're using eglot we shutdown its server</span>
      (<span class="org-keyword">if</span> (<span class="org-keyword">and</span> (<span class="org-keyword">featurep</span> '<span class="org-constant">eglot</span>) (eglot-managed-p))
          (eglot-shutdown (eglot-current-server)))
      (mapc #'kill-buffer buffers-to-kill)
      (persp-kill project-name))))

(<span class="org-keyword">defun</span> <span class="org-function-name">my/project-open-new-project</span> ()
  <span class="org-doc">"Open a project for the first time and add it to `</span><span class="org-doc"><span class="org-constant">project.el</span></span><span class="org-doc">' projects list."</span>
  (<span class="org-keyword">interactive</span>)
  (<span class="org-keyword">let*</span> ((project-path-abs (read-directory-name <span class="org-string">"Enter project root: "</span>))
         <span class="org-comment-delimiter">;; </span><span class="org-comment">we need to define `</span><span class="org-comment"><span class="org-constant">default-directory</span></span><span class="org-comment">' to be able to get the new project when `</span><span class="org-comment"><span class="org-constant">project-current</span></span><span class="org-comment">' is called</span>
         (default-directory (replace-regexp-in-string (expand-file-name <span class="org-string">"~"</span>) <span class="org-string">"~"</span> project-path-abs)))
    (project-remember-project (project-current))
    (my/project-switch-action)))
</pre>
</div>
</div>
</div>

<div id="outline-container-org47c5aed" class="outline-3">
<h3 id="org47c5aed">Completion</h3>
<div class="outline-text-3" id="text-org47c5aed">
<p>
UI for completion
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package vertico
  <span class="org-builtin">:ensure</span> t
  <span class="org-builtin">:init</span>
  (vertico-mode)
  <span class="org-builtin">:custom</span>
  <span class="org-comment-delimiter">;; </span><span class="org-comment">fixed height</span>
  (vertico-resize nil)
  <span class="org-comment-delimiter">;; </span><span class="org-comment">show max 15 elements</span>
  (vertico-count 15)
  <span class="org-builtin">:config</span>
  <span class="org-comment-delimiter">;; </span><span class="org-comment">`C-;' will open embark and `o' with execute `</span><span class="org-comment"><span class="org-constant">find-file-other-window</span></span><span class="org-comment">'</span>
  (define-key vertico-map (kbd <span class="org-string">"C-&lt;return&gt;"</span>) (kbd <span class="org-string">"C-; o"</span>)))
</pre>
</div>

<p>
Load <code>vertico-multiform</code> which is required for <code>vertico-posframe</code>
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package vertico-multiform
  <span class="org-builtin">:after</span> vertico
  <span class="org-builtin">:straight</span> nil
  <span class="org-builtin">:load-path</span> <span class="org-string">"straight/repos/vertico/extensions/"</span>)
</pre>
</div>

<p>
Vertico posframe, show all the candidates in a child-frame, it will activated only for GUI version.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package vertico-posframe
  <span class="org-builtin">:ensure</span> t
  <span class="org-builtin">:if</span> (display-graphic-p)
  <span class="org-builtin">:init</span>
  (vertico-posframe-mode 1))
</pre>
</div>

<p>
Add annotations to results shown by vertico
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package marginalia
  <span class="org-builtin">:ensure</span>
  <span class="org-builtin">:init</span>
  (marginalia-mode))
</pre>
</div>

<p>
Icons support
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package nerd-icons-completion
  <span class="org-builtin">:ensure</span> t
  <span class="org-builtin">:after</span> marginalia
  <span class="org-builtin">:config</span>
  (nerd-icons-completion-mode)
  (add-hook 'marginalia-mode-hook #'nerd-icons-completion-marginalia-setup))
</pre>
</div>

<p>
Enable better completion styles
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package orderless
  <span class="org-builtin">:ensure</span> t
  <span class="org-builtin">:config</span>
  (<span class="org-keyword">setq</span> completion-styles '(orderless basic)
        completion-category-overrides '((file (styles basic partial-completion)))))
</pre>
</div>

<p>
Disable orderless completion style in company to keep previous behaviour which I like, this was copied from <code>orderless</code> documentation.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp"><span class="org-comment-delimiter">;; </span><span class="org-comment">We follow a suggestion by company maintainer u/hvis:</span>
<span class="org-comment-delimiter">;; </span><span class="org-comment">https://www.reddit.com/r/emacs/comments/nichkl/comment/gz1jr3s/</span>
(<span class="org-keyword">defun</span> <span class="org-function-name">company-completion-styles</span> (capf-fn <span class="org-type">&amp;rest</span> args)
  (<span class="org-keyword">let</span> ((completion-styles '(basic partial-completion)))
    (apply capf-fn args)))

(advice-add 'company-capf <span class="org-builtin">:around</span> #'company-completion-styles)
</pre>
</div>

<p>
Search into project source
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package consult
  <span class="org-builtin">:ensure</span> t
  <span class="org-builtin">:config</span>
  <span class="org-comment-delimiter">;; </span><span class="org-comment">Use consult for completion inside minibuffer, for example when</span>
  <span class="org-comment-delimiter">;; </span><span class="org-comment">searching for a file.</span>
  (<span class="org-keyword">setq</span> completion-in-region-function #'consult-completion-in-region))
</pre>
</div>

<p>
Integration with yasnippets
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package consult-yasnippet
  <span class="org-builtin">:ensure</span> t
  <span class="org-builtin">:defer</span> t)
</pre>
</div>

<p>
Helpers to search term at point and general search into project
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span class="org-keyword">defun</span> <span class="org-function-name">my/grep-in-project</span> (<span class="org-type">&amp;optional</span> term)
  <span class="org-doc">"Run grep in current project.</span>
<span class="org-doc">If TERM is not nil it will be used as initial value."</span>
  (<span class="org-keyword">interactive</span>)
  (<span class="org-keyword">let*</span> ((pattern (read-string <span class="org-string">"Pattern: "</span> (<span class="org-keyword">or</span> term <span class="org-string">""</span>)))
         <span class="org-comment-delimiter">;; </span><span class="org-comment">add an extra space to be able to start typing more filters</span>
         (pattern (concat pattern <span class="org-string">" "</span>)))
    (call-interactively #'(lambda ()
                            (<span class="org-keyword">interactive</span>)
                            (consult-ripgrep (my/project-root) pattern)))))
</pre>
</div>

<p>
Switch fonts like <code>consult-theme</code>
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span class="org-keyword">defun</span> <span class="org-function-name">my/consult-font</span> (font)
  <span class="org-doc">"Replace current font with FONT from `</span><span class="org-doc"><span class="org-constant">font-family-list</span></span><span class="org-doc">'."</span>
  (<span class="org-keyword">interactive</span>
   (list
    (<span class="org-keyword">let</span> ((saved-font (symbol-name (font-get (face-attribute 'default <span class="org-builtin">:font</span>) <span class="org-builtin">:family</span>))))
      (consult--read
       (font-family-list)
       <span class="org-builtin">:prompt</span> <span class="org-string">"Font: "</span>
       <span class="org-builtin">:require-match</span> t
       <span class="org-builtin">:state</span> (<span class="org-keyword">lambda</span> (action font)
                (<span class="org-keyword">pcase</span> action
                  ('return (my/consult-font (<span class="org-keyword">or</span> font saved-font)))
                  ((<span class="org-keyword">and</span> 'preview (guard font)) (my/consult-font font))))
       ))))
  (<span class="org-keyword">when</span> font
    <span class="org-comment-delimiter">;; </span><span class="org-comment">size doesn't change during scrolling so we can reuse that to</span>
    <span class="org-comment-delimiter">;; </span><span class="org-comment">configure new selected font</span>
    (set-face-attribute 'default nil <span class="org-builtin">:font</span> (format <span class="org-string">"%s %d"</span> font (font-get (face-attribute 'default <span class="org-builtin">:font</span>) <span class="org-builtin">:size</span>)))))
</pre>
</div>

<p>
Integration with <code>embark</code>
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package embark
  <span class="org-builtin">:ensure</span> t
  <span class="org-builtin">:bind</span>
  (<span class="org-string">"C-;"</span> . embark-act)
  <span class="org-builtin">:config</span>
  <span class="org-comment-delimiter">;; </span><span class="org-comment">grep exported data can have a lot of white spaces so we don't want</span>
  <span class="org-comment-delimiter">;; </span><span class="org-comment">them to be shown while editing their content</span>
  (setq-mode-local embark-collect-mode show-trailing-whitespace nil))

(use-package embark-consult
  <span class="org-builtin">:ensure</span> t
  <span class="org-builtin">:defer</span> t)

(<span class="org-keyword">defun</span> <span class="org-function-name">my/edit-completing-results</span> ()
  <span class="org-doc">"Use results origin to execute an action after export them with `</span><span class="org-doc"><span class="org-constant">embark-export</span></span><span class="org-doc">'."</span>
  (<span class="org-keyword">interactive</span>)
  <span class="org-comment-delimiter">;; </span><span class="org-comment">call of `</span><span class="org-comment"><span class="org-constant">project-find-file</span></span><span class="org-comment">'</span>
  (<span class="org-keyword">when</span> (cl-search <span class="org-string">"Find file in"</span> (buffer-string))
    (run-at-time 0 nil #'embark-export)
    (run-at-time 0 nil #'wdired-change-to-wdired-mode)
    (run-at-time 0 nil #'evil-normal-state))
  <span class="org-comment-delimiter">;; </span><span class="org-comment">call of `</span><span class="org-comment"><span class="org-constant">consult-ripgrep</span></span><span class="org-comment">'</span>
  (<span class="org-keyword">when</span> (cl-search <span class="org-string">"Ripgrep"</span> (buffer-string))
    <span class="org-comment-delimiter">;; </span><span class="org-comment">we use `</span><span class="org-comment"><span class="org-constant">run-at-time</span></span><span class="org-comment">' to ensure all of these steps</span>
    <span class="org-comment-delimiter">;; </span><span class="org-comment">will be executed in order</span>
    (run-at-time 0 nil #'embark-export)
    (run-at-time 0 nil #'wgrep-change-to-wgrep-mode)
    (run-at-time 0 nil #'evil-normal-state)))

(define-key minibuffer-mode-map (kbd <span class="org-string">"C-c C-e"</span>) #'my/edit-completing-results)
</pre>
</div>

<p>
Edit grep buffer
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package wgrep
  <span class="org-builtin">:ensure</span> t
  <span class="org-builtin">:custom</span>
  (wgrep-auto-save-buffer t)
  <span class="org-builtin">:bind</span>
  (<span class="org-string">"C-c C-c"</span> . 'wgrep-finish-edit)
  (<span class="org-string">"C-c C-k"</span> . 'wgrep-abort-changes))
</pre>
</div>
</div>
</div>
</div>


<div id="outline-container-org39b6e1e" class="outline-2">
<h2 id="org39b6e1e">Emacs process list</h2>
<div class="outline-text-2" id="text-org39b6e1e">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span class="org-keyword">defun</span> <span class="org-function-name">my/kill-emacs-process</span> ()
  <span class="org-doc">"Show a list of current Emacs processes and kill the selected one."</span>
  (<span class="org-keyword">interactive</span>)
  (<span class="org-keyword">let*</span> ((names (mapcar #'process-name (process-list)))
         (process-name (completing-read <span class="org-string">"Choose process: "</span> names)))
    (delete-process (get-process process-name))
    (message <span class="org-string">"%s process killed"</span> (propertize process-name 'face '(<span class="org-builtin">:foreground</span> <span class="org-string">"magenta"</span>)))))

(global-set-key (kbd <span class="org-string">"C-x c p"</span>) 'my/kill-emacs-process)
</pre>
</div>
</div>
</div>

<div id="outline-container-org6584023" class="outline-2">
<h2 id="org6584023">Git backup</h2>
<div class="outline-text-2" id="text-org6584023">
<p>
Save a backup on every save, also allow to recover any version of a file
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span class="org-keyword">defvar</span> <span class="org-variable-name">my/backup-dir</span> (expand-file-name <span class="org-string">"~/.git-backup"</span>))

(<span class="org-keyword">defun</span> <span class="org-function-name">my/git-backup-versioning</span> ()
  <span class="org-doc">"Save a version of the current file."</span>
  (<span class="org-keyword">unless</span> (<span class="org-keyword">featurep</span> '<span class="org-constant">git-backup</span>)
    (<span class="org-keyword">require</span> '<span class="org-constant">git-backup</span>))
  (git-backup-version-file (executable-find <span class="org-string">"git"</span>) my/backup-dir '() (buffer-file-name)))

(<span class="org-keyword">defun</span> <span class="org-function-name">my/git-backup-run-action</span> (command commit-hash)
  <span class="org-doc">"Execute COMMAND with COMMIT-HASH using another defaults arguments."</span>
  (apply command `(,(executable-find <span class="org-string">"git"</span>) ,my/backup-dir ,commit-hash ,(buffer-file-name))))

(<span class="org-keyword">defun</span> <span class="org-function-name">my/git-backup-sort</span> (completions)
  <span class="org-doc">"Given COMPLETIONS define a custom sort function."</span>
  (<span class="org-keyword">lambda</span> (string pred action)
    (<span class="org-keyword">if</span> (eq action 'metadata)
        '(metadata (display-sort-function . identity))
      (complete-with-action action completions string pred))))

(<span class="org-keyword">defun</span> <span class="org-function-name">my/git-backup</span> ()
  <span class="org-doc">"Navigate in versions of the current file."</span>
  (<span class="org-keyword">interactive</span>)
  (<span class="org-keyword">unless</span> (<span class="org-keyword">featurep</span> '<span class="org-constant">git-backup</span>)
    (<span class="org-keyword">require</span> '<span class="org-constant">git-backup</span>))
  <span class="org-comment-delimiter">;; </span><span class="org-comment">for some reason an extra space after `</span><span class="org-comment"><span class="org-constant">%h|</span></span><span class="org-comment">' is required to avoid an error when</span>
  <span class="org-comment-delimiter">;; </span><span class="org-comment">the shell command is executed</span>
  (<span class="org-keyword">let*</span> ((candidates (git-backup-list-file-change-time (executable-find <span class="org-string">"git"</span>) my/backup-dir <span class="org-string">"%cI|%h| %ar"</span> (buffer-file-name)))
         (selection (completing-read <span class="org-string">"Pick revision: "</span> (my/git-backup-sort candidates)))
         (commit-hash (nth 1 (string-split selection <span class="org-string">"|"</span>)))
         (action (completing-read <span class="org-string">"Choose action: "</span> '(<span class="org-string">"diff"</span> <span class="org-string">"new buffer"</span> <span class="org-string">"replace current buffer"</span>))))
    (<span class="org-keyword">cond</span> ((string-equal action <span class="org-string">"diff"</span>) (my/git-backup-run-action 'git-backup-create-ediff commit-hash))
          ((string-equal action <span class="org-string">"new buffer"</span>) (my/git-backup-run-action 'git-backup-open-in-new-buffer commit-hash))
          ((string-equal action <span class="org-string">"replace current buffer"</span>) (my/git-backup-run-action 'git-backup-replace-current-buffer commit-hash))
          (t (message <span class="org-string">"Not valid option"</span>)))))

(use-package git-backup
  <span class="org-builtin">:ensure</span> t
  <span class="org-builtin">:hook</span> (after-save . my/git-backup-versioning))
</pre>
</div>
</div>
</div>

<div id="outline-container-org76f5d54" class="outline-2">
<h2 id="org76f5d54">Meme</h2>
<div class="outline-text-2" id="text-org76f5d54">
<p>
This package requires to have svg support in emacs, this feature relies on <code>librsvg</code> at compilation time
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span class="org-keyword">defun</span> <span class="org-function-name">my/meme-from-clipboard</span> ()
  <span class="org-doc">"Create a meme using an image from clipboard"</span>
  (<span class="org-keyword">interactive</span>)
  (<span class="org-keyword">unless</span> (executable-find <span class="org-string">"pngpaste"</span>)
    (<span class="org-warning">user-error</span> <span class="org-string">"please install pngpaste"</span>))

  (<span class="org-keyword">let*</span> ((filepath (make-temp-file <span class="org-string">"clipboard"</span> nil <span class="org-string">".png"</span>))
         (command (format <span class="org-string">"pngpaste %s"</span> filepath))
         (command-stdout (shell-command-to-string command)))
    <span class="org-comment-delimiter">;; </span><span class="org-comment">pngpaste returns "" when found a valid image in the clipboard</span>
    (<span class="org-keyword">unless</span> (string-equal command-stdout <span class="org-string">""</span>)
      (<span class="org-warning">user-error</span> (string-trim command-stdout)))

    (switch-to-buffer (get-buffer-create <span class="org-string">"*meme*"</span>))
    (meme-mode)
    (meme--setup-image filepath)))
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package imgur
  <span class="org-builtin">:ensure</span> t
  <span class="org-builtin">:defer</span> t
  <span class="org-builtin">:straight</span> (imgur
             <span class="org-builtin">:type</span> git
             <span class="org-builtin">:host</span> github
             <span class="org-builtin">:repo</span> <span class="org-string">"myuhe/imgur.el"</span>))

(use-package meme
  <span class="org-builtin">:ensure</span> t
  <span class="org-builtin">:defer</span> t
  <span class="org-builtin">:commands</span> (meme-mode meme)
  <span class="org-builtin">:straight</span> (meme
             <span class="org-builtin">:type</span> git
             <span class="org-builtin">:host</span> github
             <span class="org-builtin">:repo</span> <span class="org-string">"larsmagne/meme"</span>)
  <span class="org-builtin">:config</span>
  <span class="org-comment-delimiter">;; </span><span class="org-comment">fix to be able to read images, straight.el put files in a different directory so we have to</span>
  <span class="org-comment-delimiter">;; </span><span class="org-comment">move them to the right one</span>
  (<span class="org-keyword">let</span> ((images-dest-dir (concat user-emacs-directory <span class="org-string">"straight/build/meme/images"</span>))
        (images-source-dir (concat user-emacs-directory <span class="org-string">"straight/repos/meme/images"</span>)))
    (<span class="org-keyword">unless</span> (file-directory-p images-dest-dir)
      (shell-command (format <span class="org-string">"cp -r %s %s"</span> images-source-dir images-dest-dir)))))
</pre>
</div>
</div>
</div>

<div id="outline-container-org932ed98" class="outline-2">
<h2 id="org932ed98">Orgmode</h2>
<div class="outline-text-2" id="text-org932ed98">
<p>
Configured variables:
</p>

<ul class="org-ul">
<li><code>org-latex-caption-above</code> puts table captions at the bottom</li>
<li><code>org-clock-persist</code> persists time even if emacs is closed</li>
<li><code>org-src-fontify-natively</code> enables syntax highlighting for code blocks</li>
<li><code>org-log-done</code> saves the timestamp when a task is done</li>
<li><code>org-src-preserve-indentation</code> when is <code>t</code> avoid to insert a left indentation in source blocks</li>
</ul>

<div class="org-src-container">
<pre class="src src-emacs-lisp">
(<span class="org-keyword">defun</span> <span class="org-function-name">my/org-insert-image-from-clipboard</span> ()
  <span class="org-doc">"Insert image from clipboard using an org tag"</span>
  (<span class="org-keyword">interactive</span>)
  (<span class="org-keyword">let*</span> ((image-name (read-string <span class="org-string">"Filename: "</span> <span class="org-string">"image.png"</span>))
         (images-folder <span class="org-string">"./images"</span>)
         (image-path (format <span class="org-string">"%s/%s"</span> images-folder image-name)))
    (<span class="org-keyword">unless</span> (file-directory-p images-folder)
      (shell-command (format <span class="org-string">"mkdir -p %s"</span> images-folder)))
    (shell-command (format <span class="org-string">"pngpaste %s"</span> image-path))
    (insert (format <span class="org-string">"[[file:%s]]"</span> image-path))))

(evil-define-key nil org-mode-map (kbd <span class="org-string">"&lt;leader&gt;mii"</span>) 'my/org-insert-image-from-clipboard)

</pre>
</div>

<p>
When I read books on Apple Books and I want to insert some quote Apple Books insert some text I don't want in my notes, this function delete that and just insert the meaning part using org quote syntax.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span class="org-keyword">defun</span> <span class="org-function-name">my/org-insert-quote-from-apple-books</span> ()
  <span class="org-doc">"Take quote from clipboard and remove all the unnecesary text and insert</span>
<span class="org-doc">    an org quote in the current position"</span>
  (<span class="org-keyword">interactive</span>)
  (<span class="org-keyword">let*</span> ((raw-value (current-kill 0 t))
         (tmp (second (split-string raw-value <span class="org-string">"&#8220;"</span>)))
         (quote-value (car (split-string tmp <span class="org-string">"&#8221;"</span>))))
    (insert <span class="org-string">"#+begin_quote\n"</span>)
    (insert (concat quote-value <span class="org-string">"\n"</span>))
    (insert <span class="org-string">"#+end_quote\n"</span>)))
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span class="org-keyword">defvar</span> <span class="org-variable-name">my/org-src-block-tmp-window-configuration</span> nil)

(<span class="org-keyword">defun</span> <span class="org-function-name">my/org-edit-special</span> (<span class="org-type">&amp;optional</span> arg)
  <span class="org-doc">"Save current window configuration before a org-edit buffer is open."</span>
  (<span class="org-keyword">setq</span> my/org-src-block-tmp-window-configuration (current-window-configuration)))

(<span class="org-keyword">defun</span> <span class="org-function-name">my/org-edit-src-exit</span> ()
  <span class="org-doc">"Restore the window configuration that was saved before org-edit-special was called."</span>
  (set-window-configuration my/org-src-block-tmp-window-configuration))

(<span class="org-keyword">with-eval-after-load</span> 'org
  (<span class="org-keyword">setq</span> org-latex-caption-above nil
        org-clock-persist 'history
        org-src-fontify-natively t
        org-src-preserve-indentation t
        <span class="org-comment-delimiter">;; </span><span class="org-comment">use tectonic for export to PDF</span>
        org-latex-pdf-process '(<span class="org-string">"tectonic -X compile --outdir=%o -Z shell-escape %f"</span>)
        org-log-done t)
  (org-clock-persistence-insinuate)

  (add-hook 'org-mode-hook #'(lambda ()
                               <span class="org-comment-delimiter">;; </span><span class="org-comment">Since emacs 27 this is needed to use shortcuts like &lt;s to create source blocks</span>
                               (<span class="org-keyword">unless</span> (<span class="org-keyword">featurep</span> '<span class="org-constant">org-tempo</span>)
                                 (<span class="org-keyword">require</span> '<span class="org-constant">org-tempo</span>))
                               (org-indent-mode t)))

  (advice-add 'org-edit-special <span class="org-builtin">:before</span> 'my/org-edit-special)
  (advice-add 'org-edit-src-exit <span class="org-builtin">:after</span> 'my/org-edit-src-exit)

  (org-babel-do-load-languages 'org-babel-load-languages
                               '((python . t)
                                 (shell . t)
                                 (lisp . t)
                                 (sql . t)
                                 (dot . t)
                                 (plantuml . t)
                                 (emacs-lisp . t))))

(use-package htmlize
  <span class="org-builtin">:ensure</span> t
  <span class="org-builtin">:after</span> (org))
</pre>
</div>

<p>
Fix error with <code>TAB</code> in <code>evil-mode</code> in <code>org-mode</code> with org elements.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span class="org-keyword">defun</span> <span class="org-function-name">my/org-tab</span> ()
  <span class="org-doc">"Run `</span><span class="org-doc"><span class="org-constant">org-cycle</span></span><span class="org-doc">' only at point of an org element."</span>
  (<span class="org-keyword">interactive</span>)
  (<span class="org-keyword">if</span> (org-element-at-point)
      (org-cycle)
    (evil-jump-forward)))

(<span class="org-keyword">with-eval-after-load</span> 'org
  (define-key org-mode-map (kbd <span class="org-string">"&lt;tab&gt;"</span>) 'my/org-tab))
</pre>
</div>
</div>

<div id="outline-container-org2bcb428" class="outline-3">
<h3 id="org2bcb428">Org tree slide</h3>
<div class="outline-text-3" id="text-org2bcb428">
<p>
A tool to show org file as an slideshow
</p>

<p>
<code>hide-mode-line</code> hide the modeline to allow to have a clean screen while using <code>org-tree-slide-mode</code>
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package hide-mode-line
  <span class="org-builtin">:ensure</span> t)
</pre>
</div>

<p>
Some tweaks to have a better looking while presenting slides
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span class="org-keyword">defun</span> <span class="org-function-name">my/org-tree-slide-setup</span> ()
  (org-display-inline-images)
  (hide-mode-line-mode 1))

(<span class="org-keyword">defun</span> <span class="org-function-name">my/org-tree-slide-end</span> ()
  (org-display-inline-images)
  (hide-mode-line-mode 0))

(use-package org-tree-slide
  <span class="org-builtin">:ensure</span> t
  <span class="org-builtin">:defer</span> t
  <span class="org-builtin">:custom</span>
  (org-image-actual-width nil)
  (org-tree-slide-activate-message <span class="org-string">"Presentation started!"</span>)
  (org-tree-slide-deactivate-message <span class="org-string">"Presentation finished!"</span>)
  <span class="org-builtin">:hook</span> ((org-tree-slide-play . my/org-tree-slide-setup)
         (org-tree-slide-stop . my/org-tree-slide-end))
  <span class="org-builtin">:bind</span> (<span class="org-builtin">:map</span> org-tree-slide-mode-map
              (<span class="org-string">"C-&lt;"</span> . org-tree-slide-move-previous-tree)
              (<span class="org-string">"C-&gt;"</span> . org-tree-slide-move-next-tree)))
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org551f9f3" class="outline-2">
<h2 id="org551f9f3">Denote</h2>
<div class="outline-text-2" id="text-org551f9f3">
<p>
Note taking using <code>denote</code>
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package denote
  <span class="org-builtin">:ensure</span> t
  <span class="org-builtin">:custom</span> (denote-directory <span class="org-string">"~/Documents/wiki"</span>)
  <span class="org-builtin">:hook</span> ((dired-mode . denote-dired-mode)))

(<span class="org-keyword">defun</span> <span class="org-function-name">my/wiki</span> ()
  <span class="org-doc">"Open personal wiki and launch Dired."</span>
  (<span class="org-keyword">interactive</span>)
  (dired (expand-file-name <span class="org-string">"~/Documents/wiki"</span>))
  (dired-hide-details-mode t))
</pre>
</div>
</div>
</div>

<div id="outline-container-org017b2da" class="outline-2">
<h2 id="org017b2da">Latex</h2>
<div class="outline-text-2" id="text-org017b2da">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package auctex
  <span class="org-builtin">:ensure</span> t
  <span class="org-builtin">:defer</span> t)

(use-package latex-preview-pane
  <span class="org-builtin">:ensure</span> t
  <span class="org-builtin">:defer</span> t)
</pre>
</div>
</div>
</div>

<div id="outline-container-orgbc9a48a" class="outline-2">
<h2 id="orgbc9a48a">Git</h2>
<div class="outline-text-2" id="text-orgbc9a48a">
</div>
<div id="outline-container-orga08682d" class="outline-3">
<h3 id="orga08682d">Git-link</h3>
<div class="outline-text-3" id="text-orga08682d">
<p>
Open selected region in remote repo page
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package git-link
  <span class="org-builtin">:ensure</span> t
  <span class="org-builtin">:defer</span> t)
</pre>
</div>
</div>
</div>

<div id="outline-container-orga766205" class="outline-3">
<h3 id="orga766205">Git modes</h3>
<div class="outline-text-3" id="text-orga766205">
<p>
This pacakge includes <code>gitignore-mode</code>, <code>gitconfig-mode</code> and <code>gitattributes-mode</code>
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package git-modes
  <span class="org-builtin">:defer</span> t
  <span class="org-builtin">:ensure</span> t)
</pre>
</div>
</div>
</div>

<div id="outline-container-orgb4a3913" class="outline-3">
<h3 id="orgb4a3913">Magit</h3>
<div class="outline-text-3" id="text-orgb4a3913">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span class="org-keyword">defun</span> <span class="org-function-name">my/magit-blame-quit</span> ()
  <span class="org-doc">"Restore evil state after magit blame mode is closed."</span>
  (evil-exit-emacs-state))

(use-package magit
  <span class="org-builtin">:ensure</span> t
  <span class="org-builtin">:custom</span>
  <span class="org-comment-delimiter">;; </span><span class="org-comment">restore previous window configuration after a buffer is closed</span>
  (magit-bury-buffer-function 'magit-restore-window-configuration)
  <span class="org-comment-delimiter">;; </span><span class="org-comment">open magit status buffer in the whole frame</span>
  (magit-display-buffer-function 'magit-display-buffer-fullframe-status-v1)
  <span class="org-builtin">:defer</span> t
  <span class="org-builtin">:config</span>
  (advice-add 'magit-blame-quit <span class="org-builtin">:after</span> 'my/magit-blame-quit)
  (add-hook 'git-commit-mode-hook 'my/setup-ispell-for-commit-message)
  (add-hook 'magit-blame-mode-hook #'(lambda () (evil-emacs-state))))
</pre>
</div>
</div>
</div>

<div id="outline-container-orgd283344" class="outline-3">
<h3 id="orgd283344">Magit delta</h3>
<div class="outline-text-3" id="text-orgd283344">
<p>
Use <code>delta</code> tool to show diffs in magit
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package magit-delta
  <span class="org-builtin">:ensure</span> t
  <span class="org-builtin">:if</span> (executable-find <span class="org-string">"delta"</span>)
  <span class="org-builtin">:hook</span> (magit-mode . magit-delta-mode))
</pre>
</div>
</div>
</div>

<div id="outline-container-orgf42b619" class="outline-3">
<h3 id="orgf42b619">Forge</h3>
<div class="outline-text-3" id="text-orgf42b619">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package forge
  <span class="org-builtin">:ensure</span> t
  <span class="org-builtin">:after</span> (magit closql)
  <span class="org-builtin">:config</span>
  (add-hook 'forge-topic-mode-hook #'(lambda () (evil-emacs-state))))
</pre>
</div>
</div>
</div>

<div id="outline-container-org63de264" class="outline-3">
<h3 id="org63de264">Git diff-hl</h3>
<div class="outline-text-3" id="text-org63de264">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package diff-hl
  <span class="org-builtin">:ensure</span> t
  <span class="org-builtin">:custom</span>
  (diff-hl-show-staged-changes nil)
  <span class="org-comment-delimiter">;; </span><span class="org-comment">for some reason the :hook form doesn't work so we have to use :init</span>
  <span class="org-builtin">:init</span>
  (add-hook 'magit-pre-refresh-hook 'diff-hl-magit-pre-refresh)
  (add-hook 'magit-post-refresh-hook 'diff-hl-magit-post-refresh)
  (add-hook 'dired-mode-hook 'diff-hl-dired-mode)
  <span class="org-builtin">:config</span>
  (global-diff-hl-mode))
</pre>
</div>
</div>
</div>

<div id="outline-container-orga138936" class="outline-3">
<h3 id="orga138936">Timemachine</h3>
<div class="outline-text-3" id="text-orga138936">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package git-timemachine
  <span class="org-builtin">:ensure</span> t
  <span class="org-builtin">:config</span>
  (add-hook 'git-timemachine-mode-hook #'(lambda () (evil-emacs-state))))
</pre>
</div>
</div>
</div>

<div id="outline-container-orgbd34a5b" class="outline-3">
<h3 id="orgbd34a5b">Gist</h3>
<div class="outline-text-3" id="text-orgbd34a5b">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package gist
  <span class="org-builtin">:ensure</span> t
  <span class="org-builtin">:defer</span> t)
</pre>
</div>
</div>
</div>

<div id="outline-container-orge005697" class="outline-3">
<h3 id="orge005697">Linkode</h3>
<div class="outline-text-3" id="text-orge005697">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package linkode
  <span class="org-builtin">:ensure</span> t
  <span class="org-builtin">:defer</span> t)
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-orgb715492" class="outline-2">
<h2 id="orgb715492">Web</h2>
<div class="outline-text-2" id="text-orgb715492">
</div>
<div id="outline-container-org5dc7dd5" class="outline-3">
<h3 id="org5dc7dd5">Web mode</h3>
<div class="outline-text-3" id="text-org5dc7dd5">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span class="org-keyword">defun</span> <span class="org-function-name">my/web-mode-hook</span> ()
  (emmet-mode)
  (rainbow-delimiters-mode-disable))

(use-package web-mode
  <span class="org-builtin">:ensure</span> t
  <span class="org-builtin">:custom</span>
  (web-mode-enable-current-element-highlight t)
  (web-mode-enable-current-column-highlight t)
  <span class="org-builtin">:mode</span> ((<span class="org-string">"\\.html\\'"</span> . web-mode)
         (<span class="org-string">"\\.html.eex\\'"</span> . web-mode)
         (<span class="org-string">"\\.html.leex\\'"</span> . web-mode)
         (<span class="org-string">"\\.hbs\\'"</span> . web-mode))
  <span class="org-builtin">:config</span>
  (add-hook 'web-mode-hook 'my/web-mode-hook))
</pre>
</div>
</div>
</div>

<div id="outline-container-orgfaed52c" class="outline-3">
<h3 id="orgfaed52c">Emmet</h3>
<div class="outline-text-3" id="text-orgfaed52c">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package emmet-mode
  <span class="org-builtin">:ensure</span> t)
</pre>
</div>
</div>
</div>

<div id="outline-container-org22e569d" class="outline-3">
<h3 id="org22e569d">Sass</h3>
<div class="outline-text-3" id="text-org22e569d">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package sass-mode
  <span class="org-builtin">:ensure</span> t
  <span class="org-builtin">:defer</span> t)
</pre>
</div>
</div>
</div>

<div id="outline-container-orgd7cb497" class="outline-3">
<h3 id="orgd7cb497">Rainbow</h3>
<div class="outline-text-3" id="text-orgd7cb497">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package rainbow-mode
  <span class="org-builtin">:ensure</span> t
  <span class="org-builtin">:hook</span>
  ((css-mode . rainbow-mode)
   (sass-mode . rainbow-mode)
   (heex-ts-mode . rainbow-mode)
   (scss-mode . rainbow-mode)))
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-orga41a006" class="outline-2">
<h2 id="orga41a006">Telegram</h2>
<div class="outline-text-2" id="text-orga41a006">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package telega
  <span class="org-builtin">:ensure</span> t
  <span class="org-builtin">:defer</span> t
  <span class="org-builtin">:custom</span>
  <span class="org-comment-delimiter">;; </span><span class="org-comment">enable markdown for code snippets</span>
  (telega-chat-input-markups '(<span class="org-string">"markdown2"</span> <span class="org-string">"org"</span> nil))
  <span class="org-comment-delimiter">;; </span><span class="org-comment">use vertico for completion</span>
  (telega-completing-read-function 'completing-read)
  <span class="org-builtin">:config</span>
  <span class="org-comment-delimiter">;; </span><span class="org-comment">use shift enter to make multi line messages and enter to send it</span>
  (define-key telega-chat-mode-map (kbd <span class="org-string">"S-&lt;return&gt;"</span>) #'newline)
  <span class="org-comment-delimiter">;; </span><span class="org-comment">disable copy message link when moving over text with evil-mode</span>
  (define-key telega-msg-button-map (kbd <span class="org-string">"l"</span>) nil)
  <span class="org-comment-delimiter">;; </span><span class="org-comment">avoid showing blank spaces highlighted</span>
  (add-hook 'telega-chat-mode-hook #'(lambda ()
                                       (<span class="org-keyword">setq-local</span> show-trailing-whitespace nil))))

(<span class="org-keyword">defun</span> <span class="org-function-name">my/start-telega</span> ()
  <span class="org-doc">"Start `</span><span class="org-doc"><span class="org-constant">telega</span></span><span class="org-doc">' inside a new perspective and activate 'telega-mode-line-mode'"</span>
  (<span class="org-keyword">interactive</span>)
  (persp-switch <span class="org-string">"*telega*"</span>)
  (telega)
  (telega-mode-line-mode))
</pre>
</div>
</div>
</div>

<div id="outline-container-orgd72dc62" class="outline-2">
<h2 id="orgd72dc62">Miscellaneous</h2>
<div class="outline-text-2" id="text-orgd72dc62">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package writeroom-mode
  <span class="org-builtin">:ensure</span> t)

(use-package csv-mode
  <span class="org-builtin">:ensure</span> t
  <span class="org-builtin">:defer</span> t)

(<span class="org-keyword">defun</span> <span class="org-function-name">my/json-format</span> ()
  <span class="org-doc">"Format region or buffer."</span>
  (<span class="org-keyword">interactive</span>)
  (<span class="org-keyword">if</span> (region-active-p)
      (jsonian-format-region (region-beginning) (region-end))
    (jsonian-format-region (point-min) (point-max))))

(use-package jsonian
  <span class="org-builtin">:ensure</span> t
  <span class="org-builtin">:defer</span> t
  <span class="org-builtin">:mode</span> ((<span class="org-string">"\\.json\\'"</span> . jsonian-mode))
  <span class="org-builtin">:mode-hydra</span>
  (jsonian-mode
   (<span class="org-builtin">:title</span> (concat (nerd-icons-icon-for-buffer) <span class="org-string">" JSON commands"</span>))
   (<span class="org-string">"Format"</span>
    ((<span class="org-string">"f"</span> my/json-format)))))

(use-package request
  <span class="org-builtin">:ensure</span> t
  <span class="org-builtin">:defer</span> t)

(use-package graphql-mode
  <span class="org-builtin">:ensure</span> t
  <span class="org-builtin">:defer</span> t)

(reformatter-define terraform-format
  <span class="org-builtin">:program</span> <span class="org-string">"terraform"</span>
  <span class="org-builtin">:args</span> '(<span class="org-string">"fmt"</span> <span class="org-string">"-"</span>)
  <span class="org-builtin">:group</span> 'terraform)

(use-package terraform-mode
  <span class="org-builtin">:ensure</span> t
  <span class="org-builtin">:defer</span> t
  <span class="org-builtin">:bind</span> (<span class="org-builtin">:map</span> terraform-mode-map
              (<span class="org-string">"C-c C-f"</span> . 'terraform-format-buffer)))

(<span class="org-keyword">defun</span> <span class="org-function-name">my/k8s-apply</span> ()
  <span class="org-doc">"Apply current yaml file to the current kubernetes context."</span>
  (<span class="org-keyword">interactive</span>)
  (<span class="org-keyword">let</span> ((default-directory (file-name-directory buffer-file-name)))
    (compile (format <span class="org-string">"kubectl apply -f %s"</span> buffer-file-name))))

(<span class="org-keyword">defun</span> <span class="org-function-name">my/k8s-delete</span> ()
  <span class="org-doc">"Delete current yaml file to the current kubernetes context."</span>
  (<span class="org-keyword">interactive</span>)
  (<span class="org-keyword">let</span> ((default-directory (file-name-directory buffer-file-name)))
    (compile (format <span class="org-string">"kubectl delete -f %s"</span> buffer-file-name))))

(use-package yaml-ts-mode
  <span class="org-builtin">:straight</span> (<span class="org-builtin">:type</span> built-in)
  <span class="org-builtin">:mode</span> <span class="org-string">"\\.ya?ml\\'"</span>
  <span class="org-builtin">:bind</span> (<span class="org-builtin">:map</span> yaml-ts-mode-map
              (<span class="org-string">"C-c C-c"</span> . 'my/k8s-apply)
              (<span class="org-string">"C-c C-d"</span> . 'my/k8s-delete)))

(use-package flymake-yamllint
  <span class="org-builtin">:ensure</span> t
  <span class="org-builtin">:defer</span> t
  <span class="org-builtin">:hook</span>
  (yaml-ts-mode . flymake-mode)
  (yaml-ts-mode . flymake-yamllint-setup))

(use-package yaml-pro
  <span class="org-builtin">:ensure</span> t
  <span class="org-builtin">:defer</span> t
  <span class="org-builtin">:hook</span>
  (yaml-ts-mode . yaml-pro-ts-mode)
  <span class="org-builtin">:config</span>
  (define-key yaml-pro-ts-mode-map (kbd <span class="org-string">"C-c C-f"</span>) 'yaml-pro-format)
  <span class="org-comment-delimiter">;; </span><span class="org-comment">this binding conflicts with org indirect mode</span>
  (define-key yaml-pro-ts-mode-map (kbd <span class="org-string">"C-c '"</span>) nil))

(use-package hcl-mode
  <span class="org-builtin">:ensure</span> t)

<span class="org-comment-delimiter">;; </span><span class="org-comment">Used for gherkin files (.feature)</span>
(use-package feature-mode
  <span class="org-builtin">:ensure</span> t
  <span class="org-builtin">:defer</span> t)

(use-package toml-ts-mode
  <span class="org-builtin">:straight</span> (<span class="org-builtin">:type</span> built-in)
  <span class="org-builtin">:mode</span> <span class="org-string">"\\.toml\\'"</span>
  <span class="org-builtin">:defer</span> t)

(use-package nix-mode
  <span class="org-builtin">:ensure</span> t
  <span class="org-builtin">:defer</span> t
  <span class="org-builtin">:mode</span> <span class="org-string">"\\.nix\\'"</span>)

(use-package d2-mode
  <span class="org-builtin">:ensure</span> t
  <span class="org-builtin">:defer</span> t
  <span class="org-builtin">:mode</span> <span class="org-string">"\\.d2\\'"</span>)

(use-package ob-d2
  <span class="org-builtin">:defer</span> t
  <span class="org-builtin">:ensure</span> t
  <span class="org-builtin">:config</span>
  (<span class="org-keyword">with-eval-after-load</span> 'org
    (org-babel-do-load-languages
     'org-babel-load-languages
     '((d2 . t)))))

(use-package mermaid-mode
  <span class="org-builtin">:ensure</span> t
  <span class="org-builtin">:defer</span> t)

(<span class="org-keyword">defun</span> <span class="org-function-name">my/preview-mermaid</span> ()
  <span class="org-doc">"Render region inside a webit embebed browser."</span>
  (<span class="org-keyword">interactive</span>)
  (<span class="org-keyword">unless</span> (region-active-p)
    (<span class="org-warning">user-error</span> <span class="org-string">"Select a region first"</span>))
  (<span class="org-keyword">let*</span> ((path (concat (make-temp-file (temporary-file-directory)) <span class="org-string">".html"</span>))
         (mermaid-code (buffer-substring-no-properties (region-beginning) (region-end))))
    (<span class="org-keyword">save-excursion</span>
      (<span class="org-keyword">with-temp-buffer</span>
        (insert <span class="org-string">"&lt;body&gt;</span>
<span class="org-string">  &lt;pre class=\"mermaid\"&gt;"</span>)
        (insert mermaid-code)
        <span class="org-comment-delimiter">;; </span><span class="org-comment">js script copied from mermaid documentation</span>
        (insert <span class="org-string">"&lt;/pre&gt;</span>
<span class="org-string">  &lt;script type=\"module\"&gt;</span>
<span class="org-string">    import mermaid from 'https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.esm.min.mjs';</span>
<span class="org-string">    mermaid.initialize({ startOnLoad: true });</span>
<span class="org-string">  &lt;/script&gt;</span>
<span class="org-string">&lt;/body&gt;"</span>)
        (write-file path)))
    (xwidget-webkit-browse-url (format <span class="org-string">"file://%s"</span> path))))

(use-package markdown-mode
  <span class="org-builtin">:ensure</span> t
  <span class="org-builtin">:defer</span> t
  <span class="org-builtin">:config</span>
  (add-hook 'markdown-mode-hook #'(lambda ()
                                    (<span class="org-keyword">setq-local</span> fill-column 120)
                                    (auto-fill-mode 1))))

(use-package edit-indirect
  <span class="org-builtin">:ensure</span> t
  <span class="org-builtin">:defer</span> t)

(use-package dockerfile-ts-mode
  <span class="org-builtin">:straight</span> (<span class="org-builtin">:type</span> built-in)
  <span class="org-builtin">:defer</span> t
  <span class="org-builtin">:mode</span> ((<span class="org-string">"\\Dockerfile\\'"</span> . dockerfile-ts-mode)
         (<span class="org-string">"\\.dockerignore\\'"</span> . dockerfile-ts-mode)))

(use-package dumb-jump
  <span class="org-builtin">:ensure</span> t
  <span class="org-builtin">:defer</span> t
  <span class="org-builtin">:custom</span>
  (dumb-jump-force-searcher 'rg)
  (dumb-jump-selector 'completing-read))
</pre>
</div>

<p>
helpful, enhance help functions
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package helpful
  <span class="org-builtin">:ensure</span> t
  <span class="org-builtin">:defer</span> t)

<span class="org-comment-delimiter">;; </span><span class="org-comment">these function have autoload annotation so they will load `</span><span class="org-comment"><span class="org-constant">helpful</span></span><span class="org-comment">' package when they are called</span>
<span class="org-comment-delimiter">;; </span><span class="org-comment">because we're defined just keybindings we can just use the symbol even the function is not loaded yet</span>
(global-set-key (kbd <span class="org-string">"C-h f"</span>) #'helpful-callable)
(global-set-key (kbd <span class="org-string">"C-h v"</span>) #'helpful-variable)
(global-set-key (kbd <span class="org-string">"C-h k"</span>) #'helpful-key)
</pre>
</div>

<p>
Use ESC key instead C-g to close and abort
</p>

<p>
Copied from somewhere
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span class="org-keyword">defun</span> <span class="org-function-name">minibuffer-keyboard-quit</span> ()
  <span class="org-doc">"Abort recursive edit.</span>
<span class="org-doc">  In Delete Selection mode, if the mark is active, just deactivate it;</span>
<span class="org-doc">  then it takes a second \\[</span><span class="org-doc"><span class="org-constant">keyboard-quit</span></span><span class="org-doc">] to abort the minibuffer."</span>
  (<span class="org-keyword">interactive</span>)
  (<span class="org-keyword">if</span> (<span class="org-keyword">and</span> delete-selection-mode transient-mark-mode mark-active)
      (<span class="org-keyword">setq</span> deactivate-mark  t)
    (<span class="org-keyword">when</span> (get-buffer <span class="org-string">"*Completions*"</span>) (delete-windows-on <span class="org-string">"*Completions*"</span>))
    (abort-recursive-edit)))

(<span class="org-keyword">with-eval-after-load</span> 'evil
  (define-key evil-normal-state-map [escape] 'keyboard-quit)
  (define-key evil-visual-state-map [escape] 'keyboard-quit))

(define-key minibuffer-local-map [escape] 'minibuffer-keyboard-quit)
(define-key minibuffer-local-ns-map [escape] 'minibuffer-keyboard-quit)
(define-key minibuffer-local-completion-map [escape] 'minibuffer-keyboard-quit)
(define-key minibuffer-local-must-match-map [escape] 'minibuffer-keyboard-quit)
(define-key minibuffer-local-isearch-map [escape] 'minibuffer-keyboard-quit)
(global-set-key [escape] 'evil-exit-emacs-state)
</pre>
</div>

<p>
Emacs Start Up Profiler
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package esup
  <span class="org-builtin">:ensure</span> t)
</pre>
</div>

<p>
websockets client
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package websocket
  <span class="org-builtin">:ensure</span> t
  <span class="org-builtin">:defer</span> t)
</pre>
</div>
</div>
</div>

<div id="outline-container-org0bf77c1" class="outline-2">
<h2 id="org0bf77c1">LSP</h2>
<div class="outline-text-2" id="text-org0bf77c1">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package eglot
  <span class="org-builtin">:ensure</span> nil
  <span class="org-builtin">:defer</span> t
  <span class="org-builtin">:straight</span> (<span class="org-builtin">:type</span> built-in)
  <span class="org-builtin">:bind</span> (<span class="org-builtin">:map</span> eglot-mode-map
              (<span class="org-string">"C-c C-d"</span> . 'eldoc-doc-buffer)
              (<span class="org-string">"&lt;M-return&gt;"</span> . 'eglot-code-actions)
              (<span class="org-string">"C-c C-s"</span> . 'xref-find-references))
  <span class="org-builtin">:config</span>
  <span class="org-comment-delimiter">;; </span><span class="org-comment">elixir LSP server</span>
  (<span class="org-keyword">setf</span> (alist-get 'elixir-ts-mode eglot-server-programs) `(,(expand-file-name <span class="org-string">"~/Code/oss/lexical/release/bin/start_lexical.sh"</span>))))
</pre>
</div>

<p>
In case we don't have eglot running we can relay on dump-jump
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span class="org-keyword">defun</span> <span class="org-function-name">my/goto-definition-dumb-jump-fallback</span> ()
  <span class="org-doc">"Go to definition using eglot when is active otherwise use dumb-jump."</span>
  (<span class="org-keyword">interactive</span>)
  (<span class="org-keyword">if</span> (<span class="org-keyword">and</span> (<span class="org-keyword">featurep</span> '<span class="org-constant">eglot</span>) (eglot-managed-p))
      (xref-find-definitions (thing-at-point 'symbol))
    (dumb-jump-go)))
</pre>
</div>
</div>
</div>

<div id="outline-container-org7f9e5b6" class="outline-2">
<h2 id="org7f9e5b6">Programming languages</h2>
<div class="outline-text-2" id="text-org7f9e5b6">
</div>
<div id="outline-container-orga437e46" class="outline-3">
<h3 id="orga437e46">Shell scripts</h3>
<div class="outline-text-3" id="text-orga437e46">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package flymake-shellcheck
  <span class="org-builtin">:ensure</span> t
  <span class="org-builtin">:defer</span> t
  <span class="org-builtin">:if</span> (executable-find <span class="org-string">"shellcheck"</span>)
  <span class="org-builtin">:commands</span> flymake-shellcheck-load
  <span class="org-builtin">:init</span>
  (add-hook 'sh-mode-hook 'flymake-shellcheck-load))
</pre>
</div>

<p>
Bash formatter using <code>shfmt</code>
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(reformatter-define sh-format
  <span class="org-builtin">:program</span> <span class="org-string">"shfmt"</span>
  <span class="org-builtin">:args</span> '(<span class="org-string">"-i"</span> <span class="org-string">"2"</span> <span class="org-string">"-"</span>)
  <span class="org-builtin">:group</span> 'sh)

(<span class="org-keyword">with-eval-after-load</span> 'sh-script
  (define-key sh-mode-map (kbd <span class="org-string">"C-c C-f"</span>) 'sh-format-buffer))
</pre>
</div>
</div>
</div>

<div id="outline-container-org6ca0d61" class="outline-3">
<h3 id="org6ca0d61">C</h3>
<div class="outline-text-3" id="text-org6ca0d61">
<p>
<code>clang-format</code> is required for this, we can install it with <code>brew install clang-format</code>
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(reformatter-define c-format
  <span class="org-builtin">:program</span> <span class="org-string">"clang-format"</span>)

(<span class="org-keyword">with-eval-after-load</span> 'cc-mode
  (define-key c-mode-map (kbd <span class="org-string">"C-c C-f"</span>) 'c-format-buffer))
</pre>
</div>
</div>
</div>

<div id="outline-container-org4719b8c" class="outline-3">
<h3 id="org4719b8c">Python</h3>
<div class="outline-text-3" id="text-org4719b8c">
<p>
For LSP support <code>pyright</code> is required
</p>

<div class="org-src-container">
<pre class="src src-sh">brew install pyright
</pre>
</div>

<p>
Install <code>flymake-ruff</code>
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package flymake-ruff
  <span class="org-builtin">:ensure</span> t)
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(reformatter-define python-ruff-format
  <span class="org-builtin">:program</span> <span class="org-string">"ruff"</span>
  <span class="org-builtin">:args</span> '(<span class="org-string">"format"</span> <span class="org-string">"-"</span>)
  <span class="org-builtin">:group</span> 'python)

(reformatter-define python-sort-imports
  <span class="org-builtin">:program</span> <span class="org-string">"ruff"</span>
  <span class="org-builtin">:args</span> '(<span class="org-string">"--fix"</span> <span class="org-string">"--select"</span> <span class="org-string">"I001"</span> <span class="org-string">"-"</span>)
  <span class="org-builtin">:group</span> 'python)

(<span class="org-keyword">setq</span> python-shell-completion-native-enable nil)

(use-package python-ts-mode
  <span class="org-builtin">:straight</span> (<span class="org-builtin">:type</span> built-in)
  <span class="org-builtin">:defer</span> t
  <span class="org-builtin">:mode</span> <span class="org-string">"\\.py\\'"</span>
  <span class="org-builtin">:bind</span>
  (<span class="org-builtin">:map</span> python-ts-mode-map
        (<span class="org-string">"C-c C-f"</span> . python-ruff-format-buffer)
        (<span class="org-string">"C-c C-i"</span> . python-sort-imports-region)
        (<span class="org-string">"C-c C-t"</span> . pythontest-test-at-point))
  <span class="org-builtin">:hook</span> (python-ts-mode . flymake-ruff-load))
</pre>
</div>

<p>
Testing package
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package pythontest
  <span class="org-builtin">:ensure</span> t
  <span class="org-builtin">:defer</span> t
  <span class="org-builtin">:custom</span>
  (pythontest-pytest-command <span class="org-string">"pytest -s -vv"</span>))
</pre>
</div>

<p>
Show a list of the available django commands and run the selected one using a compilation buffer.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span class="org-keyword">defun</span> <span class="org-function-name">my/run-django-command</span> ()
  <span class="org-doc">"Run a django command."</span>
  (<span class="org-keyword">interactive</span>)
  (<span class="org-keyword">let*</span> ((python-bin (concat (getenv <span class="org-string">"VIRTUAL_ENV"</span>) <span class="org-string">"/bin/python"</span>))
         (manage-py-file (concat (my/project-root) <span class="org-string">"manage.py"</span>))
         (default-directory (my/project-root))
         (raw-help (shell-command-to-string (concat python-bin <span class="org-string">" "</span> manage-py-file <span class="org-string">" help"</span>)))
         (splited-lines (split-string raw-help <span class="org-string">"\n"</span>))
         (options (seq-filter #'(lambda (line) (cl-search <span class="org-string">"    "</span> line)) splited-lines))
         (selection (completing-read <span class="org-string">"Pick django command: "</span> (mapcar 'string-trim options)))
         (command (concat python-bin <span class="org-string">" "</span> manage-py-file <span class="org-string">" "</span> selection)))
    (compile command)))
</pre>
</div>
</div>
</div>

<div id="outline-container-org74c7a76" class="outline-3">
<h3 id="org74c7a76">Erlang</h3>
<div class="outline-text-3" id="text-org74c7a76">
<p>
Clone erlang source code into <code>~/Code/erlang/src/</code>
</p>

<div class="org-src-container">
<pre class="src src-sh">git clone https://github.com/erlang/otp.git ~/Code/erlang/src/
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package erlang
  <span class="org-builtin">:ensure</span> t
  <span class="org-builtin">:defer</span> t
  <span class="org-builtin">:if</span> (executable-find <span class="org-string">"erl"</span>)
  <span class="org-builtin">:config</span>
  (<span class="org-keyword">setq</span> erlang-root-dir (expand-file-name <span class="org-string">"~/Code/erlang/src"</span>))
  (<span class="org-keyword">require</span> '<span class="org-constant">erlang-start</span>))
</pre>
</div>
</div>
</div>

<div id="outline-container-org3db802f" class="outline-3">
<h3 id="org3db802f">Elixir</h3>
<div class="outline-text-3" id="text-org3db802f">
</div>
<div id="outline-container-orgf1778e7" class="outline-4">
<h4 id="orgf1778e7">LSP server building</h4>
<div class="outline-text-4" id="text-orgf1778e7">
<p>
To have support for LSP we need to compile <a href="https://github.com/lexical-lsp/lexical">lexical</a> and setup the generated release into <code>eglot-server-programs</code>. lexical must use minimal versions so it can be used by more types of projects, recommended versions are:
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">elixir: 1.13.4-otp-24
erlang: 24.3.4.12
</pre>
</div>

<p>
Prepare release of <code>lexical</code>
</p>

<div class="org-src-container">
<pre class="src src-shell"><span class="org-variable-name">MIX_ENV</span>=prod mix package --path release
</pre>
</div>
</div>
</div>

<div id="outline-container-orgd87de67" class="outline-4">
<h4 id="orgd87de67">Config</h4>
<div class="outline-text-4" id="text-orgd87de67">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(reformatter-define elixir-format
  <span class="org-builtin">:program</span> <span class="org-string">"mix"</span>
  <span class="org-builtin">:args</span> '(<span class="org-string">"format"</span> <span class="org-string">"-"</span>)
  <span class="org-builtin">:group</span> 'elixir)

(<span class="org-keyword">defun</span> <span class="org-function-name">my/elixir-format-buffer</span> ()
  <span class="org-doc">"Format elixir buffers using eglot when is active otherwise use reformatter function."</span>
  (<span class="org-keyword">interactive</span>)
  <span class="org-comment-delimiter">;; </span><span class="org-comment">eglot formatter is preferred because it will use project .formatter.exs file</span>
  <span class="org-comment-delimiter">;; </span><span class="org-comment">regular formatter generated by reformatted will ignore that file</span>
  (<span class="org-keyword">if</span> (<span class="org-keyword">and</span> (<span class="org-keyword">featurep</span> '<span class="org-constant">eglot</span>) (eglot-managed-p))
      (eglot-format-buffer)
    (elixir-format-buffer)))

(use-package elixir-ts-mode
  <span class="org-builtin">:straight</span> (<span class="org-builtin">:type</span> built-in)
  <span class="org-builtin">:mode</span> ((<span class="org-string">"\\.ex\\'"</span> . elixir-ts-mode)
         (<span class="org-string">"\\.exs\\'"</span> . elixir-ts-mode)
         (<span class="org-string">"\\mix.lock\\'"</span> . elixir-ts-mode))
  <span class="org-builtin">:mode-hydra</span>
  ((<span class="org-builtin">:title</span> (concat (nerd-icons-icon-for-buffer) <span class="org-string">" Elixir Commands"</span>))
   (<span class="org-string">"Format"</span>
    ((<span class="org-string">"f"</span> my/elixir-format-buffer))
    <span class="org-string">"Testing"</span>
    ((<span class="org-string">"tt"</span> my/mix-run-test-at-point)
     (<span class="org-string">"tf"</span> my/mix-run-test-file)
     (<span class="org-string">"ta"</span> my/mix-run-test-all)))))
</pre>
</div>

<p>
<code>heex</code> templates support
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package heex-ts-mode
  <span class="org-builtin">:ensure</span> t
  <span class="org-builtin">:hook</span> (heex-ts-mode . emmet-mode))
</pre>
</div>

<p>
Custom functions to run elixir tests.
</p>

<p>
<code>elixir-extra-test-env</code> can be set up on <code>.dir-locals.el</code>
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span class="org-keyword">defun</span> <span class="org-function-name">my/mix-run-test</span> (<span class="org-type">&amp;optional</span> scope)
  <span class="org-doc">"Run elixir test for the given SCOPE."</span>
  (<span class="org-keyword">interactive</span>)
  (<span class="org-keyword">let*</span> ((current-file (buffer-file-name))
         (current-line (line-number-at-pos))
         (mix-file (expand-file-name (concat (locate-dominating-file (buffer-file-name) <span class="org-string">"mix.exs"</span>) <span class="org-string">"mix.exs"</span>)))
         (default-directory (file-name-directory mix-file))
         (extra-env (<span class="org-keyword">if</span> (boundp 'elixir-extra-test-env) elixir-extra-test-env <span class="org-string">""</span>))
         (mix-env (concat <span class="org-string">"MIX_ENV=test "</span> extra-env)))

    (<span class="org-keyword">cond</span>
     ((string-equal scope <span class="org-string">"file"</span>)
      (compile (format <span class="org-string">"%s mix test %s"</span> mix-env current-file)))

     ((string-equal scope <span class="org-string">"at-point"</span>)
      (compile (format <span class="org-string">"%s mix test %s:%s"</span> mix-env current-file current-line)))

     (t
      (compile (format <span class="org-string">"%s mix test"</span> mix-env))))))


(<span class="org-keyword">defun</span> <span class="org-function-name">my/mix-run-test-file</span> ()
  <span class="org-doc">"Run mix test over the current file."</span>
  (<span class="org-keyword">interactive</span>)
  (my/mix-run-test <span class="org-string">"file"</span>))

(<span class="org-keyword">defun</span> <span class="org-function-name">my/mix-run-test-at-point</span> ()
  <span class="org-doc">"Run mix test at point."</span>
  (<span class="org-keyword">interactive</span>)
  (my/mix-run-test <span class="org-string">"at-point"</span>))

(<span class="org-keyword">defun</span> <span class="org-function-name">my/mix-run-test-all</span> ()
  <span class="org-doc">"Run mix test at point."</span>
  (<span class="org-keyword">interactive</span>)
  (my/mix-run-test))
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org523c53e" class="outline-3">
<h3 id="org523c53e">LFE</h3>
<div class="outline-text-3" id="text-org523c53e">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package lfe-mode
  <span class="org-builtin">:ensure</span> t
  <span class="org-builtin">:if</span> (executable-find <span class="org-string">"lfe"</span>)
  <span class="org-builtin">:bind</span> (<span class="org-builtin">:map</span> lfe-mode-map
              (<span class="org-string">"C-c C-c"</span> . lfe-eval-buffer))
  <span class="org-builtin">:init</span>
  (<span class="org-keyword">defun</span> <span class="org-function-name">lfe-eval-buffer</span> ()
    <span class="org-doc">"Send current buffer to inferior LFE process."</span>
    (<span class="org-keyword">interactive</span>)
    (<span class="org-keyword">if</span> (eq (get-buffer-window <span class="org-string">"*inferior-lfe*"</span>) nil)
        (run-lfe nil))
    (lfe-eval-region (point-min) (point-max) nil)))
</pre>
</div>
</div>
</div>

<div id="outline-container-orgd7d37ad" class="outline-3">
<h3 id="orgd7d37ad">Elm</h3>
<div class="outline-text-3" id="text-orgd7d37ad">
<p>
Install Elm
</p>

<div class="org-src-container">
<pre class="src src-sh">npm -g install elm elm-format elm-oracle
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">
(use-package elm-mode
  <span class="org-builtin">:ensure</span> t
  <span class="org-builtin">:if</span> (executable-find <span class="org-string">"elm"</span>)
  <span class="org-builtin">:bind</span> (<span class="org-builtin">:map</span> elm-mode-map
              (<span class="org-string">"C-c C-d"</span> . elm-oracle-doc-at-point))
  <span class="org-builtin">:config</span>
  (add-hook 'elm-mode-hook #'elm-oracle-setup-completion)
  (add-to-list 'company-backends 'company-elm))

</pre>
</div>
</div>
</div>

<div id="outline-container-org6ec2079" class="outline-3">
<h3 id="org6ec2079">Haskell</h3>
<div class="outline-text-3" id="text-org6ec2079">
<p>
Install haskell binaries <code>hlint</code> and <code>hindent</code> and make sure <code>~/.local/bin/</code> is loaded in <code>PATH</code>.
</p>

<div class="org-src-container">
<pre class="src src-shell">stack install hlint
stack install hindent
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(reformatter-define haskell-format
  <span class="org-builtin">:program</span> <span class="org-string">"hindent"</span>
  <span class="org-builtin">:group</span> 'haskell)

(use-package haskell-mode
  <span class="org-builtin">:ensure</span> t
  <span class="org-builtin">:bind</span> (<span class="org-builtin">:map</span> haskell-mode-map
              (<span class="org-string">"C-c C-f"</span> . haskell-format-buffer)
              (<span class="org-string">"C-c C-l"</span> . haskell-process-load-file)))

(<span class="org-keyword">defun</span> <span class="org-function-name">my/run-hlint</span> ()
  <span class="org-doc">"Run  hlint over the current project."</span>
  (<span class="org-keyword">interactive</span>)
  (<span class="org-keyword">let</span> ((default-directory (my/project-root)))
    (compile <span class="org-string">"hlint ."</span>)))

(<span class="org-keyword">defun</span> <span class="org-function-name">my/run-hlint-buffer</span> ()
  <span class="org-doc">"Run  hlint over the current buffer."</span>
  (<span class="org-keyword">interactive</span>)
  (<span class="org-keyword">let*</span> ((current-file (buffer-file-name))
         (default-directory (my/project-root)))
    (compile (concat <span class="org-string">"hlint "</span> current-file))))
</pre>
</div>
</div>
</div>

<div id="outline-container-org87cdd2d" class="outline-3">
<h3 id="org87cdd2d">Lua</h3>
<div class="outline-text-3" id="text-org87cdd2d">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package lua-mode
  <span class="org-builtin">:ensure</span> t
  <span class="org-builtin">:bind</span> (<span class="org-builtin">:map</span> lua-mode-map
              (<span class="org-string">"C-c C-b"</span> . compile)
              (<span class="org-string">"C-c C-f"</span> . lua-format-buffer)))
</pre>
</div>

<p>
Define formatter using <a href="https://github.com/JohnnyMorganz/StyLua">StyLua</a>
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(reformatter-define lua-format
  <span class="org-builtin">:program</span> <span class="org-string">"stylua"</span>
  <span class="org-builtin">:args</span> '(<span class="org-string">"-"</span>)
  <span class="org-builtin">:group</span> 'lua)
</pre>
</div>
</div>
</div>

<div id="outline-container-org437e31c" class="outline-3">
<h3 id="org437e31c">Javascript</h3>
<div class="outline-text-3" id="text-org437e31c">
<p>
We use default <code>js-mode</code> because it has been improved in emacs 27.
</p>
</div>

<div id="outline-container-orgca1894a" class="outline-4">
<h4 id="orgca1894a">Formattter</h4>
<div class="outline-text-4" id="text-orgca1894a">
<p>
We need to use <code>--stdin-filepath a.js</code> to tell <code>prettier</code> to use js parser.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(reformatter-define js-format
  <span class="org-builtin">:program</span> <span class="org-string">"npx"</span>
  <span class="org-builtin">:args</span> '(<span class="org-string">"prettier"</span> <span class="org-string">"--stdin-filepath"</span> <span class="org-string">"a.js"</span>))

(<span class="org-keyword">with-eval-after-load</span> 'js
  (define-key js-mode-map (kbd <span class="org-string">"C-c C-f"</span>) 'js-format-buffer))
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org0129c27" class="outline-3">
<h3 id="org0129c27">Typescript</h3>
<div class="outline-text-3" id="text-org0129c27">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package typescript-ts-mode
  <span class="org-builtin">:straight</span> (<span class="org-builtin">:type</span> built-in)
  <span class="org-builtin">:defer</span> t
  <span class="org-builtin">:mode</span> <span class="org-string">"\\.tsx?\\'"</span>)
</pre>
</div>
</div>
</div>

<div id="outline-container-org27cc10e" class="outline-3">
<h3 id="org27cc10e">Rust</h3>
<div class="outline-text-3" id="text-org27cc10e">
<p>
Install rust analyzer, this should be installed when <code>rustup-init</code> is executed but in case is not we can execute:
</p>

<div class="org-src-container">
<pre class="src src-sh">rustup component add rust-analyzer
</pre>
</div>

<p>
Install rust source code, it is required by <code>rust-analyzer</code>, in case it's not installed automatically
</p>

<div class="org-src-container">
<pre class="src src-shell">rustup component add rust-src
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package rust-mode
  <span class="org-builtin">:ensure</span> t
  <span class="org-builtin">:if</span> (executable-find <span class="org-string">"rustc"</span>))
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span class="org-keyword">defun</span> <span class="org-function-name">my/rust-run-file</span> ()
  <span class="org-doc">"Compile and rust current file."</span>
  (<span class="org-keyword">interactive</span>)
  (<span class="org-keyword">unless</span> (buffer-file-name)
    (<span class="org-warning">user-error</span> <span class="org-string">"Save file before"</span>))
  (<span class="org-keyword">let*</span> ((path (buffer-file-name))
         (default-directory (file-name-directory path))
         (filename (buffer-name))
         (command (format <span class="org-string">"rustc %s &amp;&amp; ./%s"</span> filename (string-replace <span class="org-string">".rs"</span> <span class="org-string">""</span> filename))))
    (compile command)))
</pre>
</div>
</div>
</div>

<div id="outline-container-org90e088b" class="outline-3">
<h3 id="org90e088b">Golang</h3>
<div class="outline-text-3" id="text-org90e088b">
<p>
Install dependencies: goimports
</p>

<div class="org-src-container">
<pre class="src src-sh">go install golang.org/x/tools/cmd/goimports@latest
</pre>
</div>

<p>
Install <code>gopls</code> to have LSP support using eglot
</p>

<div class="org-src-container">
<pre class="src src-shell">brew install gopls
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package go-mode
  <span class="org-builtin">:ensure</span> t
  <span class="org-builtin">:if</span> (executable-find <span class="org-string">"go"</span>)
  <span class="org-builtin">:hook</span> (go-mode . eglot-ensure)
  <span class="org-builtin">:mode-hydra</span>
  ((<span class="org-builtin">:title</span> (concat (nerd-icons-icon-for-buffer) <span class="org-string">" Go Commands"</span>))
   (<span class="org-string">"Format"</span>
    ((<span class="org-string">"f"</span> gofmt))
    <span class="org-string">"Execute"</span>
    ((<span class="org-string">"r"</span> go-run))
    <span class="org-string">"Testing"</span>
    ((<span class="org-string">"tt"</span> go-test-current-test)
     (<span class="org-string">"tf"</span> go-test-current-file)
     (<span class="org-string">"ta"</span> go-test-current-project))))
  <span class="org-builtin">:config</span>
  <span class="org-comment-delimiter">;; </span><span class="org-comment">by default tab width is 8, that's too much space so we define 4</span>
  <span class="org-comment-delimiter">;; </span><span class="org-comment">only for go buffers</span>
  (add-hook 'go-mode-hook #'(lambda ()
                              (<span class="org-keyword">setq-local</span> tab-width 4)))
  (<span class="org-keyword">setq</span> gofmt-command <span class="org-string">"goimports"</span>))

(use-package go-playground
  <span class="org-builtin">:ensure</span> t
  <span class="org-builtin">:if</span> (executable-find <span class="org-string">"go"</span>)
  <span class="org-builtin">:after</span> go-mode
  <span class="org-builtin">:config</span>
  (<span class="org-keyword">setq</span> go-playground-basedir (expand-file-name <span class="org-string">"~/Code/golang/playgrounds"</span>)))
</pre>
</div>
</div>
</div>

<div id="outline-container-org4eb4537" class="outline-3">
<h3 id="org4eb4537">Common lisp</h3>
<div class="outline-text-3" id="text-org4eb4537">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span class="org-keyword">defconst</span> <span class="org-variable-name">inferior-lisp-program</span> (executable-find <span class="org-string">"sbcl"</span>))

(use-package sly
  <span class="org-builtin">:ensure</span> t
  <span class="org-builtin">:defer</span> t)
</pre>
</div>
</div>
</div>

<div id="outline-container-org0ae709c" class="outline-3">
<h3 id="org0ae709c">Clojure</h3>
<div class="outline-text-3" id="text-org0ae709c">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span class="org-keyword">defun</span> <span class="org-function-name">my/clj-format-code</span> ()
  <span class="org-doc">"Format clojure code using cider commands."</span>
  (<span class="org-keyword">interactive</span>)
  (<span class="org-keyword">if</span> (region-active-p)
      (cider-format-region (region-beginning) (region-end))
    (cider-format-buffer)))

(<span class="org-keyword">defun</span> <span class="org-function-name">my/cider-repl-reset</span> ()
  <span class="org-doc">"Call (reset) in the active repl and return to the position where was called."</span>
  (<span class="org-keyword">interactive</span>)
  (<span class="org-keyword">save-window-excursion</span>
    (cider-insert-in-repl <span class="org-string">"(reset)"</span> t)))

(use-package cider
  <span class="org-builtin">:ensure</span> t
  <span class="org-builtin">:bind</span> (<span class="org-builtin">:map</span> cider-mode-map
              (<span class="org-string">"C-c C-f"</span> . my/clj-format-code)
              (<span class="org-string">"C-c C-r"</span> . my/cider-repl-reset)))

(evil-define-key nil clojure-mode-map (kbd <span class="org-string">"&lt;leader&gt;d"</span>) 'cider-find-var)

(<span class="org-keyword">with-eval-after-load</span> 'evil
  (evil-set-initial-state 'cider-stacktrace-mode 'emacs))
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package clj-refactor
  <span class="org-builtin">:ensure</span> t
  <span class="org-builtin">:after</span> cider
  <span class="org-builtin">:bind</span> (<span class="org-builtin">:map</span> clojure-mode-map
              (<span class="org-string">"C-c C-a"</span> . cljr-add-project-dependency))
  <span class="org-builtin">:hook</span> (clojure . clj-refactor))
</pre>
</div>
</div>
</div>

<div id="outline-container-org9fd60a3" class="outline-3">
<h3 id="org9fd60a3">Emacs lisp</h3>
<div class="outline-text-3" id="text-org9fd60a3">
<p>
Enable go to definition with \ d keybinding
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(evil-define-key nil emacs-lisp-mode-map (kbd <span class="org-string">"&lt;leader&gt;d"</span>) 'xref-find-definitions)
(evil-define-key nil lisp-interaction-mode-map (kbd <span class="org-string">"&lt;leader&gt;d"</span>) 'xref-find-definitions)
</pre>
</div>

<p>
Disable indentation with tabs for <code>emacs-lisp-mode</code>
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span class="org-keyword">defun</span> <span class="org-function-name">my/emacs-lisp-hook-setup</span> ()
  (<span class="org-keyword">setq</span> indent-tabs-mode nil))

(add-hook 'emacs-lisp-mode-hook 'my/emacs-lisp-hook-setup)
</pre>
</div>

<p>
Enable flymake
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(add-hook 'emacs-lisp-mode-hook 'flymake-mode-on)
</pre>
</div>

<p>
<code>package-lint</code>, used for packages development
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package package-lint
  <span class="org-builtin">:ensure</span> t
  <span class="org-builtin">:defer</span> t)
</pre>
</div>
</div>
</div>

<div id="outline-container-org3ea631a" class="outline-3">
<h3 id="org3ea631a">OCaml</h3>
<div class="outline-text-3" id="text-org3ea631a">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package tuareg
  <span class="org-builtin">:ensure</span> t
  <span class="org-builtin">:defer</span> t)

(use-package merlin
  <span class="org-builtin">:ensure</span> t
  <span class="org-builtin">:hook</span> ((tuareg-mode caml-mode) . merlin-mode))

(use-package merlin-eldoc
  <span class="org-builtin">:ensure</span> t
  <span class="org-builtin">:hook</span> ((reason-mode tuareg-mode caml-mode) . merlin-eldoc-setup))
</pre>
</div>
</div>
</div>

<div id="outline-container-org658ce14" class="outline-3">
<h3 id="org658ce14">Dart</h3>
<div class="outline-text-3" id="text-org658ce14">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(reformatter-define dart-format
  <span class="org-builtin">:program</span> <span class="org-string">"dart"</span>
  <span class="org-builtin">:args</span> '(<span class="org-string">"format"</span>)
  <span class="org-builtin">:group</span> 'dart)

(<span class="org-keyword">defun</span> <span class="org-function-name">my/dart-run-file</span> ()
  <span class="org-doc">"Execute the code of the current file."</span>
  (<span class="org-keyword">interactive</span>)
  (compile (format <span class="org-string">"dart %s"</span> (buffer-file-name))))

(use-package dart-mode
  <span class="org-builtin">:ensure</span> t
  <span class="org-builtin">:if</span> (<span class="org-keyword">or</span> (executable-find <span class="org-string">"dart"</span>) (executable-find <span class="org-string">"flutter"</span>))
  <span class="org-builtin">:bind</span> (<span class="org-builtin">:map</span> dart-mode-map
              (<span class="org-string">"C-c C-f"</span> . dart-format-buffer)
              (<span class="org-string">"C-c C-c"</span> . my/dart-run-file))
  <span class="org-builtin">:config</span>
  (evil-define-key nil dart-mode-map (kbd <span class="org-string">"&lt;leader&gt;d"</span>) 'xref-find-definitions))
</pre>
</div>
</div>

<div id="outline-container-orgc868e99" class="outline-4">
<h4 id="orgc868e99">Flutter</h4>
<div class="outline-text-4" id="text-orgc868e99">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span class="org-keyword">defun</span> <span class="org-function-name">my/flutter-goto-logs-buffer</span>()
  <span class="org-doc">"Go to buffer logs buffer."</span>
  (<span class="org-keyword">interactive</span>)
  (<span class="org-keyword">let</span> ((buffer (get-buffer flutter-buffer-name)))
    (<span class="org-keyword">unless</span> buffer
      (<span class="org-warning">user-error</span> <span class="org-string">"flutter is not running."</span>))
    (switch-to-buffer buffer)
    (goto-line (point-max))))

(use-package flutter
  <span class="org-builtin">:ensure</span> t
  <span class="org-builtin">:after</span> dart-mode
  <span class="org-builtin">:bind</span> (<span class="org-builtin">:map</span> dart-mode-map
              (<span class="org-string">"C-c C-r"</span> . #'flutter-run-or-hot-reload)
              (<span class="org-string">"C-c C-l"</span> . #'my/flutter-goto-logs-buffer))
  <span class="org-builtin">:hook</span> (dart-mode . flutter-test-mode)
  <span class="org-builtin">:custom</span>
  <span class="org-comment-delimiter">;; </span><span class="org-comment">sdk path will be the parent-parent directory of flutter cli</span>
  (flutter-sdk-path (directory-file-name
                     (file-name-directory
                      (directory-file-name
                       (file-name-directory (executable-find <span class="org-string">"flutter"</span>)))))))
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-orgc2efaca" class="outline-3">
<h3 id="orgc2efaca">F-sharp</h3>
<div class="outline-text-3" id="text-orgc2efaca">
<div class="org-src-container">
<pre class="src src-emacs-lisp">(use-package fsharp-mode
  <span class="org-builtin">:ensure</span> t
  <span class="org-builtin">:defer</span> t
  <span class="org-builtin">:if</span> (executable-find <span class="org-string">"dotnet"</span>)
  <span class="org-builtin">:config</span>
  (evil-define-key nil fsharp-mode-map (kbd <span class="org-string">"&lt;leader&gt;d"</span>) 'fsharp-ac/gotodefn-at-point))
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-orgbe279d0" class="outline-2">
<h2 id="orgbe279d0">Writing</h2>
<div class="outline-text-2" id="text-orgbe279d0">
<p>
Custom functions to speed up writing process
</p>
</div>

<div id="outline-container-orgde5dd7b" class="outline-3">
<h3 id="orgde5dd7b">Hugo</h3>
<div class="outline-text-3" id="text-orgde5dd7b">
<p>
Insert <code>org-link</code> image using clipboard value, if the current file is <code>blog/demo.org</code> it will place the resulting image into <code>static/images/blog/demo/image.png</code>.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span class="org-keyword">defun</span> <span class="org-function-name">my/hugo-insert-image-from-clipboard</span> ()
  <span class="org-doc">"Use clipoard image and put it in a generated images folder for the current file."</span>
  (<span class="org-keyword">interactive</span>)
  (<span class="org-keyword">let*</span> ((absolute-path (buffer-file-name))
         (splitted (reverse (split-string absolute-path <span class="org-string">"/"</span>)))
         (filename (replace-regexp-in-string <span class="org-string">".org"</span> <span class="org-string">""</span> (car splitted)))
         (dir (nth 1 splitted))
         (base-image-path (concat (my/project-root) <span class="org-string">"static/images"</span>))
         (result-image-dir (format <span class="org-string">"%s/%s/%s"</span> base-image-path dir filename))
         (result-image-name (read-string <span class="org-string">"Filename: "</span> <span class="org-string">"image.png"</span>))
         (full-path-result-image (format <span class="org-string">"%s/%s"</span> result-image-dir result-image-name)))

    (shell-command (format <span class="org-string">"mkdir -p %s"</span> result-image-dir))
    (shell-command (format <span class="org-string">"pngpaste %s"</span> full-path-result-image))
    (insert (format <span class="org-string">"[[file:%s]]"</span> (car (cdr (split-string full-path-result-image <span class="org-string">"static"</span>)))))))
</pre>
</div>

<p>
Insert docsy link
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span class="org-keyword">defun</span> <span class="org-function-name">my/docsy-insert-ref</span> ()
  <span class="org-doc">"Insert a link using docsy ref helper."</span>
  (<span class="org-keyword">interactive</span>)
  (<span class="org-keyword">let*</span> ((filename (read-file-name <span class="org-string">"Select file: "</span> (my/project-root)))
         (prefix-to-remove (concat (my/project-root) <span class="org-string">"content/"</span>))
         (relative-path (string-replace prefix-to-remove <span class="org-string">""</span> filename)))
    (insert (format <span class="org-string">"{{&lt; ref \"%s\" &gt;}}"</span> relative-path))))
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-orgc4e4813" class="outline-2">
<h2 id="orgc4e4813">Custom functions</h2>
<div class="outline-text-2" id="text-orgc4e4813">
<p>
Simple bookmarks management
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span class="org-keyword">defvar</span> <span class="org-variable-name">my/bookmarks</span> (make-hash-table <span class="org-builtin">:test</span> 'equal))

(<span class="org-keyword">defun</span> <span class="org-function-name">my/bookmark-switch</span> ()
  <span class="org-doc">"Switch to selected bookmark."</span>
  (<span class="org-keyword">interactive</span>)
  (<span class="org-keyword">let*</span> ((key (my/project-name))
         (items (gethash key my/bookmarks (make-hash-table <span class="org-builtin">:test</span> 'equal)))
         (options (hash-table-keys items))
         (selected (completing-read <span class="org-string">"Pick buffer: "</span> options))
         (selected-buffer (gethash selected items)))
    (<span class="org-keyword">when</span> selected-buffer

      (switch-to-buffer selected-buffer))))

(<span class="org-keyword">defun</span> <span class="org-function-name">my/add-bookmark</span> ()
  <span class="org-doc">"Add current buffer to bookmark list."</span>
  (<span class="org-keyword">interactive</span>)
  (<span class="org-keyword">let*</span> ((project-key (my/project-name))
         (buffer-key (buffer-name))
         (items (gethash project-key my/bookmarks (make-hash-table <span class="org-builtin">:test</span> 'equal))))
    (puthash buffer-key (current-buffer) items)
    (puthash project-key items my/bookmarks)
    (message <span class="org-string">"%s added to bookmarks"</span> buffer-key)))
</pre>
</div>

<p>
Manage window configurations, allows to save a "snapshot" of the current windows configuration. Also allows to restore a saved "snapshot".
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span class="org-keyword">defvar</span> <span class="org-variable-name">my/window-snapshots</span> '())

(<span class="org-keyword">defun</span> <span class="org-function-name">my/save-window-snapshot</span> ()
  <span class="org-doc">"Save the current window configuration into `window-snapshots` alist."</span>
  (<span class="org-keyword">interactive</span>)
  (<span class="org-keyword">let</span> ((key (read-string <span class="org-string">"Enter a name for the snapshot: "</span>)))
    (<span class="org-keyword">setf</span> (alist-get key my/window-snapshots) (current-window-configuration))
    (message <span class="org-string">"%s window snapshot saved!"</span> key)))

(<span class="org-keyword">defun</span> <span class="org-function-name">my/get-window-snapshot</span> (key)
  <span class="org-doc">"Given a KEY return the saved value in `window-snapshots` alist."</span>
  (<span class="org-keyword">let</span> ((value (assoc key my/window-snapshots)))
    (cdr value)))

(<span class="org-keyword">defun</span> <span class="org-function-name">my/restore-window-snapshot</span> ()
  <span class="org-doc">"Restore a window snapshot from the window-snapshots alist."</span>
  (<span class="org-keyword">interactive</span>)
  (<span class="org-keyword">let*</span> ((snapshot-name (completing-read <span class="org-string">"Choose snapshot: "</span> (mapcar #'car my/window-snapshots)))
         (snapshot (my/get-window-snapshot snapshot-name)))
    (<span class="org-keyword">if</span> snapshot
        (set-window-configuration snapshot)
      (message <span class="org-string">"Snapshot %s not found"</span> snapshot-name))))
</pre>
</div>

<p>
Manipulate frame font height.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span class="org-keyword">defun</span> <span class="org-function-name">my/change-font-height</span> (delta)
  <span class="org-doc">"Use DELTA to increase/decrease the frame font height."</span>
  (<span class="org-keyword">let*</span> ((current-height (face-attribute 'default <span class="org-builtin">:height</span>))
         (new-height (+ current-height delta)))
    (set-face-attribute 'default nil <span class="org-builtin">:height</span> new-height)))

(<span class="org-keyword">defun</span> <span class="org-function-name">my/decrease-font-height</span> ()
  <span class="org-doc">"Decrease font height by 10."</span>
  (<span class="org-keyword">interactive</span>)
  (my/change-font-height -10))

(<span class="org-keyword">defun</span> <span class="org-function-name">my/increase-font-height</span> ()
  <span class="org-doc">"Increase font height by 10."</span>
  (<span class="org-keyword">interactive</span>)
  (my/change-font-height +10))
</pre>
</div>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span class="org-keyword">defun</span> <span class="org-function-name">my/find-file-in-project</span> ()
  <span class="org-doc">"Custom find file function."</span>
  (<span class="org-keyword">interactive</span>)
  (<span class="org-keyword">if</span> (my/project-p)
      (project-find-file)
    (call-interactively #'find-file)))

(<span class="org-keyword">defun</span> <span class="org-function-name">my/fold-buffer-when-is-too-big</span> (max-lines)
  <span class="org-doc">"Fold buffer is max lines if grater than as MAX-LINES."</span>
  (<span class="org-keyword">if</span> (&gt; (count-lines (point-min) (point-max)) max-lines)
      (hs-hide-all)))

(<span class="org-keyword">defun</span> <span class="org-function-name">my/toggle-maximize</span> ()
  <span class="org-doc">"Toggle maximization of current window."</span>
  (<span class="org-keyword">interactive</span>)
  (<span class="org-keyword">let</span> ((register ?w))
    (<span class="org-keyword">if</span> (eq (get-register register) nil)
        (<span class="org-keyword">progn</span>
          (set-register register (current-window-configuration))
          (delete-other-windows))
      (<span class="org-keyword">progn</span>
        (set-window-configuration (get-register register))
        (set-register register nil)))))

(<span class="org-keyword">defun</span> <span class="org-function-name">my/venv-workon</span> (name)
  <span class="org-doc">"Active virtualenv NAME only is not setup yet."</span>
  (<span class="org-keyword">unless</span> pyvenv-virtual-env
    (pyvenv-workon name)))

(<span class="org-keyword">defun</span> <span class="org-function-name">my/config-file</span> ()
  <span class="org-doc">"Open config file."</span>
  (<span class="org-keyword">interactive</span>)
  (find-file (expand-file-name <span class="org-string">"~/.emacs.d/bootstrap.org"</span>)))

(<span class="org-keyword">defun</span> <span class="org-function-name">my/toggle-spanish-characters</span> ()
  <span class="org-doc">"Enable/disable alt key to allow insert spanish characters."</span>
  (<span class="org-keyword">interactive</span>)
  (<span class="org-keyword">if</span> (eq ns-alternate-modifier 'meta)
      (<span class="org-keyword">setq</span> ns-alternate-modifier nil)
    (<span class="org-keyword">setq</span> ns-alternate-modifier 'meta)))

(<span class="org-keyword">defun</span> <span class="org-function-name">my/change-font-size</span>()
  <span class="org-doc">"Change frame font size."</span>
  (<span class="org-keyword">interactive</span>)
  (<span class="org-keyword">let*</span> ((size (read-number <span class="org-string">"New size: "</span>)))
    (set-face-attribute 'default nil <span class="org-builtin">:font</span> (format <span class="org-string">"%s %d"</span> my/font-family size))))
</pre>
</div>

<p>
Function to extract clocks from org buffer and filter them by month
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span class="org-keyword">defun</span> <span class="org-function-name">my/collect-clocks</span> ()
  <span class="org-doc">"Collect all the clocks of current buffer."</span>
  (org-element-map (org-element-parse-buffer) 'clock #'(lambda (clock) clock)))

(<span class="org-keyword">defun</span> <span class="org-function-name">my/filter-clocks-by-month</span> (clocks month)
  <span class="org-doc">"Filter CLOCKS using MONTH value."</span>
  (seq-filter #'(lambda (clock)
                  (eq (org-element-property <span class="org-builtin">:month-end</span> (org-element-property <span class="org-builtin">:value</span> clock)) month)) <span class="org-warning">clocks))</span>

(<span class="org-keyword">defun</span> <span class="org-function-name">my/org-filter-clocks-report</span> ()
  <span class="org-doc">"Create a buffer with the tasks filtered by month."</span>
  (<span class="org-keyword">interactive</span>)
  (<span class="org-keyword">let*</span> ((month (read-number <span class="org-string">"Insert month: "</span>))
         (clocks (my/collect-clocks))
         (filtered-clocks (my/filter-clocks-by-month clocks month))
         (buffer (get-buffer-create <span class="org-string">"*clocks report*"</span>)))
    (switch-to-buffer buffer)
    (org-mode)
    (insert <span class="org-string">"* Report\n"</span>)
    (seq-map #'(lambda (clock)
                 (insert (format <span class="org-string">"CLOCK: %s\n"</span> (org-element-property <span class="org-builtin">:raw-value</span> (org-element-property <span class="org-builtin">:value</span> clock))))) <span class="org-warning">filtered-clocks)</span>
    (org-clock-display)))
</pre>
</div>

<p>
Copy absolute and relative path to clipboard
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span class="org-keyword">defun</span> <span class="org-function-name">my/copy-abs-path</span> ()
  <span class="org-doc">"Copy absolute path of the buffer to clipboard"</span>
  (<span class="org-keyword">interactive</span>)
  (<span class="org-keyword">if</span> buffer-file-name
      (<span class="org-keyword">progn</span>
        (kill-new buffer-file-name)
        (message (format <span class="org-string">"%s copied to clipboard"</span> buffer-file-name)))
    (message <span class="org-string">"File not saved yet"</span>)))

(<span class="org-keyword">defun</span> <span class="org-function-name">my/copy-relative-path</span> ()
  <span class="org-doc">"Copy relative path of the buffer to clipboard"</span>
  (<span class="org-keyword">interactive</span>)
  (<span class="org-keyword">if</span> (<span class="org-keyword">and</span> (my/project-p) buffer-file-name)
      (<span class="org-keyword">let</span> ((path (file-relative-name buffer-file-name (my/project-root))))
        (kill-new path)
        (message (format <span class="org-string">"%s copied to clipboard"</span> path)))
    (message <span class="org-string">"File not saved yet or not inside project"</span>)))
</pre>
</div>

<p>
Create a temp file with the current buffer content and render it with <code>eww</code>.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span class="org-keyword">defun</span> <span class="org-function-name">my/preview-buffer-in-eww</span> ()
  <span class="org-doc">"Preview buffer content in EWW."</span>
  (<span class="org-keyword">interactive</span>)
  (<span class="org-keyword">let*</span> ((temp-file (make-temp-name (temporary-file-directory)))
         (path (concat temp-file <span class="org-string">".html"</span>)))
    (write-file path)
    (kill-buffer)
    (eww-open-file path)))

(<span class="org-keyword">defun</span> <span class="org-function-name">my/preview-buffer-in-xwidget-browser</span> ()
  <span class="org-doc">"Preview buffer content in EWW."</span>
  (<span class="org-keyword">interactive</span>)
  (<span class="org-keyword">let*</span> ((temp-file (make-temp-name (temporary-file-directory)))
         (path (concat temp-file <span class="org-string">".html"</span>)))
    (write-file path)
    (kill-buffer)
    (xwidget-webkit-browse-url (format <span class="org-string">"file://%s"</span> path))))
</pre>
</div>

<p>
Resize window: allow create a "resize mode" and use hjkl to increase/decrease width/height of the current window
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span class="org-keyword">defun</span> <span class="org-function-name">my/resize-window</span> ()
  <span class="org-doc">"Resize window using j k h l keys."</span>
  (<span class="org-keyword">interactive</span>)
  (<span class="org-keyword">let</span> ((keys-map '((?h . evil-window-decrease-width)
                    (?j . evil-window-decrease-height)
                    (?k . evil-window-increase-height)
                    (?l . evil-window-increase-width)))
        (overlay (make-overlay (point-min) (point-max) (window-buffer))))
    (<span class="org-keyword">let</span> ((is-reading t))
      (overlay-put overlay 'face '((t (<span class="org-builtin">:foreground</span> <span class="org-string">"gray40"</span>))))
      (<span class="org-keyword">while</span> is-reading
        (<span class="org-keyword">let</span> ((action (alist-get (read-key) keys-map)))
          (<span class="org-keyword">if</span> action
              (apply action '(1))
            (<span class="org-keyword">setq</span> is-reading nil)
            (delete-overlay overlay)))))))
</pre>
</div>

<p>
Kill the current buffer and delete the related file
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span class="org-keyword">defun</span> <span class="org-function-name">my/delete-close-file</span> ()
  <span class="org-doc">"Delete the current file and kill its buffer."</span>
  (<span class="org-keyword">interactive</span>)
  (<span class="org-keyword">when</span> buffer-file-name
    (delete-file buffer-file-name)
    (kill-buffer)))
</pre>
</div>

<p>
Copy json text from clipboard in a new buffer and format it
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span class="org-keyword">defun</span> <span class="org-function-name">my/copy-and-format-json-from-clipboard</span> ()
  <span class="org-doc">"Copy content from clipboard and format it in a new buffer."</span>
  (<span class="org-keyword">interactive</span>)
  (<span class="org-keyword">let</span> ((buffer (generate-new-buffer <span class="org-string">"tmp.json"</span>)))
    (<span class="org-keyword">with-current-buffer</span> buffer
      (yank)
      (jsonian-mode)
      (jsonian-format-region (point-min) (point-max)))
    (set-window-buffer nil buffer)))
</pre>
</div>
</div>

<div id="outline-container-org559f475" class="outline-3">
<h3 id="org559f475">MacOS</h3>
<div class="outline-text-3" id="text-org559f475">
<p>
Functions to open Finder using current file or current project.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span class="org-keyword">defun</span> <span class="org-function-name">my/open-finder-at</span> (path)
  <span class="org-doc">"Open Finder app with the given PATH."</span>
  (<span class="org-keyword">let*</span> ((finder (executable-find <span class="org-string">"open"</span>))
         (command (format <span class="org-string">"%s %s"</span> finder path)))
    (shell-command command)))

(<span class="org-keyword">defun</span> <span class="org-function-name">my/open-project-in-finder</span> ()
  <span class="org-doc">"Open current project in Finder app."</span>
  (<span class="org-keyword">interactive</span>)
  (<span class="org-keyword">if</span> (my/project-p)
      (my/open-finder-at (my/project-root))
    (message <span class="org-string">"There is no active project."</span>)))

(<span class="org-keyword">defun</span> <span class="org-function-name">my/open-current-file-in-finder</span> ()
  <span class="org-doc">"Open current file in Finder."</span>
  (<span class="org-keyword">interactive</span>)
  (<span class="org-keyword">let</span> ((file (buffer-file-name)))
    (<span class="org-keyword">if</span> file
        (my/open-finder-at (file-name-directory file))
      (message <span class="org-string">"Buffer has not been saved yet!"</span>))))
</pre>
</div>

<p>
Open current file with an macOS app. Installed macOS apps will be listed using <code>completing-read</code>
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span class="org-keyword">defun</span> <span class="org-function-name">my/macos-open-file-with</span> ()
  <span class="org-doc">"Open current file with and macOS installed app."</span>
  (<span class="org-keyword">interactive</span>)
  (<span class="org-keyword">let*</span> ((apps-list (directory-files <span class="org-string">"/Applications"</span> nil <span class="org-string">"\\.app$"</span>))
         (selected-app (completing-read <span class="org-string">"Choose an application: "</span> apps-list)))
    (shell-command (format <span class="org-string">"open %s -a '%s'"</span> (buffer-file-name) selected-app))))
</pre>
</div>

<p>
Open the current file with macOS <code>open</code> command. This will open the file with the default app configured for the type of file.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span class="org-keyword">defun</span> <span class="org-function-name">my/macos-open-current-file</span> ()
  (<span class="org-keyword">interactive</span>)
  (shell-command (format <span class="org-string">"open %s"</span> (buffer-file-name))))
</pre>
</div>

<p>
Save image from clipboard to path.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">(<span class="org-keyword">defun</span> <span class="org-function-name">my/save-image-from-clipboard</span> ()
  <span class="org-doc">"Save image from clipboard to the given path."</span>
  (<span class="org-keyword">interactive</span>)
  (<span class="org-keyword">unless</span> (executable-find <span class="org-string">"pngpaste"</span>)
    (<span class="org-warning">user-error</span> <span class="org-string">"Install pngpaste to continue"</span>))
  (<span class="org-keyword">let*</span> ((path (read-file-name <span class="org-string">""</span>))
         (command (format <span class="org-string">"pngpaste %s"</span> path)))
    (shell-command command)
    (kill-new path)))
</pre>
</div>
</div>
</div>
</div>
</div>
<div id="postamble" class="status">
<p class="author">Author: Erick Navarro</p>
<p class="date">Created: 2024-07-14 Sun 22:43</p>
<p class="validation"><a href="http://validator.w3.org/check?uri=referer">Validate</a></p>
</div>
</body>
</html>
